# MODULE src/app/App.jsx
import React from "react";
import styles from "./App.module.css";
import RoutesRoot from "../routes/routes.jsx";
import { ThemeProvider } from "./providers/ThemeProvider.jsx";
import Header from "../components/common/Header/Header.jsx";
import Footer from "../components/common/Footer/Footer.jsx";

export default function App() {
  return (
    <ThemeProvider>
      <div className={styles.app}>
        <Header />
        <div className={styles.content}>
          <RoutesRoot />
        </div>
        <Footer />
      </div>
    </ThemeProvider>
  );
}



# MODULE src/app/providers/ThemeProvider.jsx
import React, { createContext, useMemo, useState } from "react";

export const ThemeContext = createContext({
  theme: "light",
  setTheme: () => {},
});

export function ThemeProvider({ children }) {
  const [theme, setTheme] = useState("light");
  const value = useMemo(() => ({ theme, setTheme }), [theme]);
  return (
    <ThemeContext.Provider value={value}>
      <div data-theme={theme}>{children}</div>
    </ThemeContext.Provider>
  );
}



# MODULE src/components/common/Footer/Footer.jsx
import React from "react";
import styles from "./Footer.module.css";

export default function Footer() {
  return (
    <footer className={styles.footer}>
      <div className="container">
        <div className={styles.inner}>
          <div className={styles.copy}>© 2025 Govnary Gang</div>
          <div className={styles.socials}>
            <a
              href="https://www.dungeonsanddragons.ru/bookfull/5ed/5e%20Players%20Handbook%20-%20Книга%20игрока%20RUS.pdf"
              target="_blank"
              aria-label="Книга игрока"
              className={styles.icon}
            >
              ◈
            </a>
            <a
              href="https://www.dungeonsanddragons.ru/bookfull/Tasha's%20Cauldron%20of%20Everything%20RUS.pdf"
              target="_blank"
              aria-label="Книга Таши"
              className={styles.icon}
            >
              ✦
            </a>
            <a href="#" aria-label="YouTube" className={styles.icon}>
              ▶
            </a>
          </div>
        </div>
      </div>
    </footer>
  );
}



# MODULE src/components/common/Header/Header.jsx
import React, { useState } from "react";
import { Link, useNavigate } from "react-router-dom";
import styles from "./Header.module.css";
import Navbar from "../Navigation/Navbar.jsx";
import logo from "./favicon.ico"; // Импортируйте вашу картинку

export default function Header() {
  const [q, setQ] = useState("");
  const navigate = useNavigate();

  function onSubmit(e) {
    e.preventDefault();
    const query = q.trim();
    navigate(`/search?q=${encodeURIComponent(query)}`);
  }

  return (
    <header className={styles.header}>
      <div className={styles.inner}>
        <Link to="/" className={styles.logo} aria-label="Главная">
          <img src={logo} alt="Govnary Gang Logo" className={styles.logoMark} />
          <span className={styles.logoText}>Govnary Gang</span>
        </Link>

        <Navbar />

        <div className={styles.actions}>
          <form className={styles.search} onSubmit={onSubmit} role="search">
            <input
              type="text"
              placeholder="Поиск"
              aria-label="Поиск"
              value={q}
              onChange={(e) => setQ(e.target.value)}
            />
          </form>
          <button className={styles.themeToggle} aria-label="Переключить тему">
            ★
          </button>
        </div>
      </div>
    </header>
  );
}



# MODULE src/components/common/Hero/Hero.jsx
import React from "react";
import styles from "./Hero.module.css";

export default function Hero({
  title,
  subtitle,
  height = 600,
  backgroundImage = "/assets/hero.jpg",
  ctaLabel,
  onCta,
}) {
  return (
    <section
      className={styles.hero}
      style={{
        minHeight: height,
        backgroundImage: `linear-gradient(to bottom, rgba(26,26,26,0.3), rgba(26,26,26,0.8)), url('${backgroundImage}')`,
      }}
    >
      <div className={styles.content}>
        {title ? <h1 className={styles.title}>{title}</h1> : null}
        {subtitle ? <p className={styles.subtitle}>{subtitle}</p> : null}
        {ctaLabel ? (
          <button className="btn btn-primary" onClick={onCta}>
            {ctaLabel}
          </button>
        ) : null}
      </div>
    </section>
  );
}



# MODULE src/components/common/Navigation/Navbar.jsx
import React from "react";
import { Link } from "react-router-dom";
import styles from "./Navigation.module.css";
import NavDropdown from "./NavDropdown.jsx";
import navigation from "../../../config/navigation";

export default function Navbar() {
  return (
    <nav className={styles.nav}>
      {navigation.map((item) => (
        <div key={item.path} className={styles.item}>
          <Link to={item.path}>{item.label}</Link>
          {item.children?.length ? <NavDropdown items={item.children} /> : null}
        </div>
      ))}
    </nav>
  );
}



# MODULE src/components/common/Navigation/NavDropdown.jsx
import React from "react";
import { Link } from "react-router-dom";
import styles from "./Navigation.module.css";

export default function NavDropdown({ items = [] }) {
  return (
    <div className={styles.dropdown}>
      {items.map((it) => (
        <Link key={it.path} to={it.path} className={styles.dropdownItem}>
          {it.label}
        </Link>
      ))}
    </div>
  );
}



# MODULE src/config/navigation.js
const navigation = [
  {
    label: "Персонажи",
    path: "/characters",
    children: [
      { label: "Игровые персонажи", path: "/characters/players" },
      { label: "НПС", path: "/characters/npcs" },
      { label: "Союзники", path: "/characters/allies" },
      { label: "Враги", path: "/characters/enemies" },
      { label: "Павшие", path: "/characters/deceased" },
    ],
  },
  {
    label: "Мир",
    path: "/world",
    children: [
      { label: "Города", path: "/world/cities" },
      { label: "География", path: "/world/geography" },
      { label: "Подземелья", path: "/world/dungeons" },
      { label: "Карты", path: "/world/maps" },
    ],
  },
  {
    label: "Хроники",
    path: "/chronicles",
    children: [
      { label: "Сессии", path: "/chronicles/sessions" },
      { label: "Ключевые события", path: "/chronicles/key-events" },
      { label: "Временная шкала", path: "/chronicles/timeline" },
      { label: "Цитаты", path: "/chronicles/quotes" },
    ],
  },
  {
    label: "Лор",
    path: "/lore",
    children: [
      { label: "Фракции", path: "/lore/fractions" },
      { label: "Боги", path: "/lore/gods" },
      { label: "История", path: "/lore/history" },
      { label: "Легенды", path: "/lore/legends" },
    ],
  },
  {
    label: "Правила",
    path: "/rules",
    children: [
      { label: "Хоумбрю", path: "/rules/homebrew" },
      { label: "Механики", path: "/rules/mechanics" },
    ],
  },
  {
    label: "Медиа",
    path: "/media",
    children: [
      { label: "Галерея", path: "/media/gallery" },
      { label: "Музыка", path: "/media/music" },
    ],
  },
];

export default navigation;



# MODULE src/data/characters/allies.js
export const allies = [
  {
    id: "ally-fry-goblfak",
    name: "Фрай Гоблфак",
    role: 'Молодой дерзкий хозяин таверны "Гоблинский Пунш"',
    city: "Фонт",
    portrait: "/assets/images/chars/fry_goblfak.jpg",
  },
  {
    id: "ally-peil",
    name: "Пейл",
    role: 'Гоблин-пивовар, творец "Гоблинского пряника"',
    city: "Фонт",
    portrait: "/assets/images/chars/peil_portrait.jpg",
  },
  {
    id: "ally-magnus-chizelbang",
    name: "Магнус Чизелбэнг",
    role: 'Старый карикатурный маг и хозяин таверны "Сырный маг"',
    city: "Фонт",
    portrait: "/assets/images/chars/magnus_chizelbang.jpg",
  },
  {
    id: "ally-topor",
    name: "Топор",
    role: 'Одноглазый бугай, хозяин таверны "Три топора"',
    city: "Фонт",
    portrait: "/assets/images/chars/topor_portrait.jpg",
  },
  {
    id: "ally-dezmal-eyson",
    name: "Дезмал Эйсон",
    role: "Союзник",
    city: "Фонт",
    portrait: "/assets/images/chars/dezmal_eyson.jpg",
    fractions: [
      {
        id: "f-eyson-family",
        name: "Род Эйсонов",
        icon: "/assets/images/icons/fraction-eyson-manticore.png",
      },
    ],
  },
];

export default allies;



# MODULE src/data/characters/deceased.js
export const deceased = [
  {
    id: "deceased-tolvi",
    name: "Тольви",
    role: "Полурослик-плут",
    banner: "/assets/images/chars/tolvi-banner.jpg",
    symbol: "/assets/images/icons/rogue-icon.png",
    quote: "",
    death:
      "После смерти Тольви несколько недель думали, что её просто никто не видит, но она рядом. В катке номер 7 узнали, что она всё-таки умерла.",
    legacy:
      "Тольви была полуросликом-плутом с рыжими волосами. Её исчезновение было настолько незаметным, что товарищи долгое время не могли понять, что произошло. Только спустя время, в седьмой сессии, истина открылась — Тольви больше нет среди живых.",
  },
];

export default deceased;



# MODULE src/data/characters/enemies.js
export const enemies = [
  {
    id: "enemy-tristan-waters",
    name: "Тристан Уотерс",
    role: "Бывший глава стражи города Фонт",
    city: "Фонт",
    portrait: "/assets/images/chars/tristan_waters.jpg",
  },
];

export default enemies;



# MODULE src/data/characters/npcs.js
export const npcs = [
  {
    id: "npc-estelar-vitretin",
    name: "Эстелар Витретин",
    role: "Эльф-кузнец",
    city: "Фонт",
    fractions: [],
  },
  {
    id: "npc-darion-eyson",
    name: "Дарион Эйсон",
    symbol: "/assets/images/icons/fraction-eyson-manticore.png",
    role: "Мэр города Фонт",
    city: "Фонт",
    fractions: [
      {
        id: "f-eyson-family",
        name: "Род Эйсонов",
        icon: "/assets/images/icons/fraction-eyson-manticore.png",
      },
    ],
  },
  {
    id: "npc-stefania",
    name: "Стефания",
    role: "Жена Дезмала Эйсона",
    city: "Фонт",
    fractions: [],
  },
];

export default npcs;



# MODULE src/data/characters/playerCharacters.js
export const playerCharacters = [];

export default playerCharacters;



# MODULE src/data/chronicles/keyEvents.js
export const keyEvents = [];



# MODULE src/data/chronicles/quotes.js
export const quotes = [
  {
    id: "q1",
    text: "Кто сказал, что дверь закрыта, если у нас есть песня?",
    character: {
      id: "pc-lyria",
      name: "Лирия",
      portrait: "/assets/images/chars/lyria_portrait.jpg",
    },
    context: "Перед взломом зачарованной двери",
    reaction: "Смеялись",
    type: "funny",
  },
];

export default quotes;



# MODULE src/data/chronicles/sessions.js
const rawSessions = [
  {
    num: 1,
    title: "Чёрный ритуал",
    realDate: "",
    gameDate: "",
    heroImage: "/assets/images/chronicles/sessions/session-1-hero.jpg",
    summary:
      'Отдых героев в таверне "Коровий вздох" был прерван раненым торговцем Лоуренсом, кричавшим о похищении его жены Хлои. Группа авантюристов отправилась спасать девушку из лап гоблинов, совершающих тёмный ритуал в древнем склепе.',

    chapters: [
      {
        title: "Глава 1: Встреча в таверне",
        content:
          'В небольшой деревне [Чекерпоинт](/world/cities/checkerpoint) наши герои - [Доктор Гранж](/characters/players/pc-dr-grange), [Шарлотт](/characters/players/pc-charlotte), [Хермахан](/characters/players/pc-hermakhan), [Золтар](/characters/players/pc-zoltar) и [Тольви](/characters/players/pc-tolvi) - отдыхали в таверне ["Коровий вздох"](/world/establishments/tavern-cow-sigh). Внезапно дверь распахнулась, и на пол упал раненый странствующий торговец [Лоуренс](/characters/npcs/npc-lawrence). Из его плеча торчал обломок стрелы, на теле виднелись порезы. "Хлоя... Они забрали мою Хлою. Мы шли по северному тракту, как вдруг в меня выстрелили. Я пытался... Но они были слишком сильны... Прошу, спасите её. Я отдам всё, что у меня есть!" - прокричал он перед тем, как потерять сознание.',
      },
      {
        title: "Глава 2: По следам похитителей",
        content:
          "Герои отправились на северный тракт. На месте нападения земля была сильно вытоптана, повсюду запёкшаяся кровь. [Доктор Гранж](/characters/players/pc-dr-grange) нашёл обломок стрелы и заметил следы, ведущие в лес. [Тольви](/characters/players/pc-tolvi) успешно выследил гоблинов по едва заметным следам, которые те пытались замести. После нескольких часов пути группа вышла на небольшую опушку с обветшалым заросшим склепом - древней усыпальницей забытого рыцарского ордена. Около входа стояли две повозки, одна с лошадью, валялись коробки и бочки.",
      },
      {
        title: "Глава 3: Освобождение Пейла",
        content:
          'Осмотревшись, герои заметили, что в купольной части склепа гоблины издевались над пленником. [Хермахан](/characters/players/pc-hermakhan) и [Шарлотт](/characters/players/pc-charlotte) скрытно проникли наверх по лестнице. Там 2-3 гоблина-лучника балбесничали, один играл с обломком щита: "Ха-ха, смотрите, я рыцарь!". Рядом в кандалах сидел почти без сознания [гоблин Пейл](/characters/npcs/npc-pale) - глава мирных гоблинов-пивоваров, на руке которого была выжжена метка пивной кружки. После короткого боя герои освободили Пейла. Он рассказал, что злые гоблины захватили его соплеменников для какого-то тёмного ритуала, для которого нужны... экскременты.',
      },
      {
        title: "Глава 4: Засада в коридоре",
        content:
          "Спустившись в склеп, на первом этаже герои подслушали разговор двух гоблинов - [Скарга](/characters/npcs/npc-skarg) в кожаном доспехе с мечом и связкой ключей, и [Нарзуга](/characters/npcs/npc-narzug) в кожаном костюме с кнутом. Они обсуждали подготовку к ритуалу их предводителя. Когда Скарг ушёл вниз, герои атаковали. [Нарзуг](/characters/npcs/npc-narzug) пытался заставить гоблинов-рабочих сражаться кнутом, но [Золтар](/characters/players/pc-zoltar) быстро расправился с надсмотрщиком своей магией. Испуганные рабочие гоблины с метками пивной кружки разбежались.",
      },
      {
        title: "Глава 5: Ловушки подземелья",
        content:
          "Спустившись на минус первый этаж, группа двигалась по длинному коридору. [Тольви](/characters/players/pc-tolvi) заметил растяжку ловушки и обезвредил её воровскими инструментами. В боковых комнатах герои нашли склад провизии с сундуком (537 мм, 112 см, 12 зм, два зелья лечения, яд) и комнату со зловонным складом навоза. В одном из гробов [Шарлотт](/characters/players/pc-charlotte) обнаружила второй обломок щита. Собирая части щита по всему подземелью, герои понимали, что это ключ к чему-то важному.",
      },
      {
        title: "Глава 6: Прерванный ритуал",
        content:
          "В большом зале с четырьмя колоннами героев ждала засада. [Скарг](/characters/npcs/npc-skarg) и четыре гоблина с отравленным оружием атаковали из-за колонн. Но главная угроза была впереди - на постаменте перед алтарём, залитым экскрементами, стоял [гоблин Пуп](/characters/npcs/npc-pup) в балахоне и шкуре медвежатника. В руках у него были чёрная книга и волшебная палочка. Рядом в деревянном туалете была связана [Хлоя](/characters/npcs/npc-chloe). Пуп активно читал заклинание призыва! [Доктор Гранж](/characters/players/pc-dr-grange) метким выстрелом прервал ритуал, после чего завязался жестокий бой. Герои одолели Скарга и его приспешников, а затем сразились с разъярённым Пупом, не успевшим призвать демона.",
      },
      {
        title: "Глава 7: Секреты рыцарей",
        content:
          'Собрав все три части щита, найденные по всему склепу, герои вставили его в руки центральной статуи. Статуя отодвинулась, открыв секретный проход. В тайной комнате за круглым столом два скелета вцепились в серебряный кувшин стоимостью 25 золотых. Когда [Хермахан](/characters/players/pc-hermakhan) попытался взять кубок, скелеты ожили. Короткая схватка закончилась победой героев. В дневнике рыцаря была найдена последняя запись: "Сей моя последняя запись. Мы верили не тому Богу. Сим пусть мои братья будут вечно гнить в гневе и жадности".',
      },
      {
        title: "Глава 8: Триумф и расставание",
        content:
          'Освобождённая [Хлоя](/characters/npcs/npc-chloe) была благодарна спасителям. Гоблины-пивовары, включая [Пейла](/characters/npcs/npc-pale), также выражали признательность и пригласили героев в город [Фонт](/world/cities/font), где обещали угостить лучшим пивом. Выйдя из склепа, группа заметила тёмную фигуру в плаще на лошади, наблюдавшую за ними. Завидев героев, всадник ускакал - это был культист, следивший за выполнением ритуала. В [Чекерпоинте](/world/cities/checkerpoint) торговец [Лоуренс](/characters/npcs/npc-lawrence) радостно встретил жену и вручил героям мешочек с 35 золотыми: "Знаю, это немного, но это всё, что у меня сейчас есть. Если вам понадобится помощь с провизией или материалами, я буду к вашим услугам". Празднуя победу в таверне, уставший [Золтар](/characters/players/pc-zoltar) незаметно задремал прямо за столом. Когда остальные засобирались на ночлег, они не смогли его найти. Оказалось, сонный маг неудачно опёрся на подоконник, вывалился на улицу и упал прямо в торговую телегу, гружённую мешками с зерном. Возчик, не заметив нового "груза", тронулся в путь. Когда [Золтар](/characters/players/pc-zoltar) проснулся на следующее утро, он обнаружил себя в совершенно незнакомом месте, уезжающим в неизвестном направлении...',
      },
    ],

    participants: [
      "pc-dr-grange",
      "pc-charlotte",
      "pc-hermakhan",
      "pc-zoltar",
      "pc-tolvi",
    ],

    keyMoments: [
      "Драматичное появление раненого торговца Лоуренса в таверне",
      "Успешное выслеживание гоблинов до их логова",
      "Освобождение гоблина Пейла из купольной части склепа",
      "Подслушанный разговор Скарга и Нарзуга о ритуале",
      "Победа над Нарзугом и побег гоблинов-рабочих",
      "Обезвреживание ловушки в коридоре",
      "Прерывание тёмного ритуала призыва демона",
      "Финальная битва со Скаргом и Пупом",
      "Спасение Хлои",
      "Открытие тайной комнаты с помощью собранного щита",
      "Битва с ожившими скелетами",
      "Обнаружение таинственного культиста-наблюдателя",
      "Неожиданное исчезновение Золтара в торговой телеге",
    ],

    decisions: [
      "Принять просьбу Лоуренса спасти его жену",
      "Идти по следам гоблинов в лес",
      "Скрытно проникнуть в купольную часть склепа",
      "Освободить гоблина Пейла и выслушать его историю",
      "Атаковать Нарзуга после подслушанного разговора",
      "Обезвредить ловушку вместо активации",
      "Прервать ритуал Пупа до призыва демона",
      "Исследовать склеп и собрать части щита",
      "Открыть секретную комнату",
      "Преследовать таинственного всадника (не удалось)",
      "Отпраздновать победу в таверне",
    ],

    consequences: [
      "Хлоя спасена и воссоединилась с мужем",
      "Гоблины-пивовары освобождены от плена",
      "Тёмный ритуал призыва демона был предотвращён",
      "Злые гоблины во главе с Пупом уничтожены",
      "Обнаружена связь инцидента с тайным культом",
      "Получено приглашение посетить город Фонт",
      "Установлены дружеские отношения с торговцем Лоуренсом",
      "Золтар таинственно исчез, уехав в неизвестном направлении",
    ],

    mvp: "Доктор Гранж за прерывание ритуала призыва демона метким выстрелом",

    bestQuote: "Хлоя... Они забрали мою Хлою... Прошу, спасите её!",

    rewards: [
      "35 золотых от торговца Лоуренса",
      "537 медных монет",
      "112 серебряных монет",
      "12 золотых монет из сундука",
      "Два зелья лечения (2к4+2)",
      "Яд из навоза (говнояд)",
      "Волшебная палочка Пупа",
      "Ритуальный кинжал с гравировкой (50 ЗМ)",
      "Чёрная книга с тёмными ритуалами на языке бездны",
      "Серебряный кувшин (25 ЗМ)",
      "Три части щита от статуй",
      "Ключи Скарга",
      "Деревянный жетон на бесплатное пиво в городе Фонт",
      "Опыт: 120-150 очков опыта (в зависимости от действий)",
    ],
  },
  {
    num: 3,
    title: "Большой переполох в маленькой пивоварне",
    realDate: "",
    gameDate: "",
    heroImage: "/assets/images/chronicles/sessions/session-3-hero.jpg",
    summary:
      'Герои получили задание от гнома Уэсли Грандуса - владельца пивоварни "Магический переполох". В его погребе появились гигантские крысы после того, как рабочие пробили стену старой башни мага.',

    // Разделение на главы
    chapters: [
      {
        title: "Глава 1: Встреча с Уэсли Грандусом",
        content:
          '[Магнус Чизлбэнг](/characters/allies/ally-magnus-chizelbang), хозяин таверны ["Сырный маг"](/world/establishments/tavern-cheese-mage), подзывает героев и просит помочь его другу - гному Уэсли Грандусу. Уэсли - стильный гном с закрученными усами и деловым видом, владелец пивоварни "Магический переполох". Он рассказывает о передряге: при расширении погреба рабочие наткнулись на старую стену башни мага и пробили в ней дыру. Оттуда выползли чёрные крысы размером с большую собаку и атаковали работников. Условия контракта: убить всех крыс, найти источник и предотвратить подобное в будущем. Награда - 25 золотых каждому плюс всё найденное добро.',
      },
      {
        title: "Глава 2: Пивоварня под осадой",
        content:
          "После суточного пути на повозке герои прибывают к пивоварне на холме. Над дверью висит табличка с символом уточки. Все сотрудники - гномы, полурослики и полуорки - стоят снаружи, двое полуорков держат дверь. Крысы снова пробрались наверх и убили орка по имени Сор. Внутри пахнет хмелем с ягодными нотками, стоит мертвецкая тишина, только слышно царапанье когтей. Труп Сора активно обгладывают крысы. Герои побеждают трёх гигантских крыс.",
      },
      {
        title: "Глава 3: Загадки древней башни",
        content:
          "Герои спускаются в тёмный погреб и проходят через дыру в стену. Справа на стене золотом выгравирована светящаяся надпись - четыре загадочных стиха о временах суток. Путь приводит к мозаике на полу, изображающей сельскую местность с солнцем, небом, холмом и рекой. На ней лежат разрубленные пополам крысы - это ловушка! Безопасный путь связан с четырьмя элементами из стихов: Воздух (небо), Земля (холм), Вода (река) и Огонь. Неправильный шаг активирует лезвие.",
      },
      {
        title: "Глава 4: Комната с колодцем",
        content:
          "В центре небольшой комнаты стоит обветшалый каменный колодец для гнома. У стены - пыльный стол со старой посудой. При осмотре герои находят потускневшие серебряные тарелки (стоимостью 50 золотых). Любой шум привлекает из колодца трёх гигантских многоножек, которые пытаются оглушить и затащить жертв в 50-футовый колодец. [Хермахан](/characters/players/pc-hermakhan) и [Шарлотт](/characters/players/pc-charlotte) остались биться с многоножками, пока остальные ушли исследовать лабораторию. На дне колодца в стоячей воде лежит чёрный ониксовый жезл - ключ к тайному сундуку.",
      },
      {
        title: "Глава 5: Обожжённая лаборатория",
        content:
          'Дверь ведёт в лабораторию с осколками алхимических колб, книжными шкафами и отметинами огня. Воздух пропитан запахом гари и жжёного мяса. На стене висит большая картина импозантного голого гнома на кровати-сердце с красным покрывалом, частично обожжённая. Рядом золотая надпись: "Просто добавь воды". На полу хрустят обугленные останки гигантских крыс. С потолка свисают обгоревшие остатки паутины. Из теней атакует восьмифутовый гигантский паук преисподней - результат пролитых зелий. Он использует горящую паутину. [Доктор Грандж](/characters/players/pc-dr-grange) и [Икатни](/characters/players/pc-ikatni) справились с пауками, затем к ним присоединились остальные, добив последних врагов.',
      },
      {
        title: "Глава 6: Склад алхимика",
        content:
          'Комната заставлена полками с разбитыми бутылками и стеклянными осколками. Среди обломков маленькая чёрная крыса пьёт остатки из сосуда с этикеткой "-лье увеличе-". Если её не остановить, она превратится в гигантскую крысу. Другая разбитая бутыль помечена "Эссенция огненного-". Среди уцелевших находок: два зелья лечения (2к4+2) и зелье невидимости.',
      },
      {
        title: "Глава 7: Секретная комната",
        content:
          'Разгадав подсказку "Просто добавь воды" и обрызгав картину, герои открывают магически скрытый проход. За ним - комната с потускневшей кроватью-сердцем, к которой прикован маленький скелет с раздробленной тазобедренной костью. Рядом пентаграмма с инфернальным именем "Лилит" и пустой бутылёк. В углу - железный сундук с необычной замочной скважиной диаметром 4 см. [Хермахан](/characters/players/pc-hermakhan) проявляет смекалку и открывает сундук нестандартным способом. Внутри: серебряные шарики (25 ЗМ), кругляшки из овечьей кишки, лисий хвост с металлическим шариком, два кожаных фаллоса (один с надписью "для сдерживания суккуб" на инфернальном), стеклянная сфера с разрядами молнии, 5 чёрных свечей, духи, масла, кандалы и зелье "Конской силы +1".',
      },
      {
        title: "Глава 8: Триумфальное возвращение",
        content:
          "Уэсли Грандус радостно встречает героев у входа в погреб. Работники уже возобновили производство. Гном благодарит авантюристов, выплачивает обещанную награду и предлагает остаться на вечер отметить победу. После празднования Уэсли отвозит героев обратно в [Фонт](/world/cities/font). Впереди их ждут новые приключения...",
      },
    ],

    participants: ["pc-dr-granzh", "pc-hermakhan", "pc-charlotte", "pc-ikatni"],

    keyMoments: [
      "Первая встреча с Уэсли Грандусом и принятие контракта",
      "Смерть полуорка Сора от нападения крыс",
      "Разгадка загадок золотых надписей",
      "Успешное прохождение мозаики-ловушки",
      "Разделение партии: Хермахан и Шарлотт сражались с многоножками у колодца",
      "Доктор Грандж и Икатни победили пауков преисподней в лаборатории",
      "Воссоединение группы для добивания последних врагов",
      "Находка ониксового жезла на дне колодца",
      "Обнаружение секретной комнаты с пикантным содержимым",
      "Хермахан открывает сундук нестандартным способом",
    ],

    decisions: [
      "Принять контракт Уэсли Грандуса за 25 золотых с каждого",
      "Разделиться на две группы при исследовании подземелья",
      "Взять серебряные тарелки из комнаты с колодцем",
      "Исследовать дно колодца и найти ониксовый ключ",
      "Разгадать загадку с картиной и открыть секретный проход",
      "Забрать всё содержимое тайного сундука",
    ],

    consequences: [
      'Пивоварня "Магический переполох" спасена и возобновила работу',
      "Гибель полуорка Сора от нападения крыс",
      "Обнаружена старая башня мага под пивоварней",
      "Найдены ценные предметы и зелья на значительную сумму",
      "Раскрыты тёмные секреты прошлого владельца башни",
      "Установлены дружеские отношения с Уэсли Грандусом",
    ],

    mvp: "Хермахан за креативный подход к открытию сундука",

    bestQuote:
      "Чёрные крысы размером с собаку! Большую собаку, а не пуделя, понимаете?",

    rewards: [
      "25 золотых каждому от Уэсли Грандуса",
      "Серебряные тарелки (50 ЗМ)",
      "Серебряные шарики (25 ЗМ)",
      "Ониксовый жезл (100 ЗМ)",
      "2 зелья лечения (2к4+2)",
      "Зелье невидимости",
      'Зелье "Конской силы +1" (+1 к силе, -1 к телосложению навсегда)',
      "Стеклянная сфера с разрядами молнии",
      "Различные пикантные предметы из тайного сундука",
    ],
  },
];

function normalizeSession(entry) {
  const numberText = entry.num !== undefined ? String(entry.num) : "";
  const sanitizedNumber = numberText.trim();
  const slugPart = sanitizedNumber
    .toLowerCase()
    .replace(/[^0-9a-z]+/gi, "-")
    .replace(/-{2,}/g, "-")
    .replace(/^-+|-+$/g, "");
  const id = entry.id ?? `s-${slugPart || "unnumbered"}`;

  const sequence =
    entry.sequence !== undefined
      ? entry.sequence
      : sanitizedNumber
          .replace(/,/g, ".")
          .split("-")
          .map((part) => Number.parseFloat(part))
          .find((value) => Number.isFinite(value));

  return {
    ...entry,
    id,
    num: sanitizedNumber,
    sequence,
  };
}

export const sessions = rawSessions.map(normalizeSession);

export default sessions;



# MODULE src/data/lore/fractions.js
export const fractions = [
  {
    id: "f-garlic-goblins",
    name: 'Музыкальная группа "Чесночные гоблины"',
    description: "Гоблинский коллектив, известный ароматными концертами.",
  },
  {
    id: "f-eyson-family",
    name: "Род Эйсонов",
    description:
      "Знатный род, члены которого носят медальоны в виде треугольника. Символ рода — двуглавая мантикора.",
    symbol: "/assets/images/icons/fraction-eyson-manticore.png",
  },
];

export default fractions;



# MODULE src/data/lore/gods.js
export const gods = [
  {
    id: "god-aid",
    name: "Аид",
    quote: "Hay-deez nuts",
    domain: "Подземный мир, смерть, мёртвые",
    symbol: "/assets/images/icons/god-aid-symbol.png",
    banner: "/assets/images/lore/gods/aid-banner.jpg",
    description: `
      Бог смерти и богатства, предстает крупным, мощно мускулистым человеком с серой кожей. У него густая черная борода и черные глаза, и он носит золотые украшения, символизирующие его контроль над богатством. В то время как его братья Зевс и Посейдон правят небом и морем соответственно, Аид является правителем подземного мира, а также имеет некоторый контроль над землей.
      Осенью и зимой трудоголик, весной и летом "I miss my wife". Если какая-то большая война происходит - работает в три смены с Танатосом и Гермесом транспортируя души в свой план.
      `,
  },
];

export default gods;



# MODULE src/data/lore/history.js
export const history = [];



# MODULE src/data/world/cities.js
export const cities = [];

export default cities;



# MODULE src/data/world/dungeons.js
export const dungeons = [
  {
    id: "dun-black-keep",
    name: "Чёрный Замок",
    headerImage: "/assets/images/world/dungeons/black_keep_entrance.jpg",
    danger: 4, // 1-5
    map: "/assets/images/world/dungeons/black_keep_map.jpg",
    history:
      "Построен некромантом Эрсином. После падения хозяина превратился в логово теней.",
    description: "Холодные залы, эхо шагов. Факелы гаснут сами собой.",
    keyRooms: [
      { num: 3, name: "Зал Эха", desc: "Усиление шёпота до оглушения" },
      {
        num: 7,
        name: "Костяная библиотека",
        desc: "Книги из костяных пластин",
      },
    ],
    inhabitants: [
      { name: "Теневой рыцарь", icon: "/assets/images/icons/skull.png" },
      { name: "Призрачные слуги", icon: "/assets/images/icons/ghost.png" },
    ],
    treasures: ["Клинок Полуночи", "Печать Эрсина"],
    traps: ["Безмолвные руны", "Ловушки-иллюзии"],
    runsHistory: [
      "Осада и героическая оборона ворот",
      "Побег по подземной реке",
    ],
  },
  {
    id: "dun-emerald-depths",
    name: "Изумрудные Глубины",
    headerImage: "/assets/images/world/dungeons/emerald_depths_entrance.jpg",
    danger: 3,
    map: "/assets/images/world/dungeons/emerald_depths_map.jpg",
    history:
      "Древние шахты друидов, оставленные после Великого Зеленого Исхода.",
    description: "Влажные стены, светящиеся мхи, журчание подземных потоков.",
    keyRooms: [
      { num: 2, name: "Зал Корней", desc: "Корни удерживают своды" },
      { num: 8, name: "Грот Песен", desc: "Стены поют от ветра" },
    ],
    inhabitants: [
      { name: "Мшистые тролли", icon: "/assets/images/icons/troll.png" },
      { name: "Пещерные нимфы", icon: "/assets/images/icons/nymph.png" },
    ],
    treasures: ["Друидский жезл", "Кристаллы эха"],
    traps: ["Корневые петли", "Спящие споры"],
    runsHistory: ["Переговоры с нимфами", "Обвал и спасение каравана"],
  },
];

export default dungeons;



# MODULE src/data/world/establishments.js
export const establishments = [
  {
    id: "tavern-goblin-punch",
    name: 'Таверна "Гоблинский Пунш"',
    category: "Таверны",
    type: "Таверна",
    settlement: "Фонт",
    owner: { name: "Фрай Гоблфак", title: "молодой дерзкий хозяин" },
    specialties: [
      'Фирменное пиво "Гоблинский пряник" от гоблина Пейла — тёмное пиво с пряными нотами',
    ],
    menu: [
      "Эль — 3 см",
      "Гоблинский эль — 6 см",
      "Вино — 1 зм (бутылка)",
      "Суп — 3 см",
      "Мясной салат — 5 см",
      "Мясное рагу — 8 см",
      "Пир на весь мир — 2 зм",
      "Проживание — 8 см",
    ],
  },
  {
    id: "tavern-cheese-mage",
    name: 'Таверна "Сырный маг"',
    category: "Таверны",
    type: "Таверна",
    settlement: "Фонт",
    owner: {
      name: "Магнус Чизелбэнг",
      title: "старый карикатурный маг, добродушный, возможно не все дома",
    },
    specialties: [
      'Фирменное кислое пиво от пивоварни "Магический Беспорядок" (черника, брусника, крыжовник)',
    ],
    menu: [
      "Тонкая лепёшка с 4 видами сыра — 3 см",
      "Тонкая лепёшка с сыром, ветчиной и копчёной колбасой — 4 см",
      "Тонкая лепёшка с сыром и морепродуктами — 5 см",
      "Жареная курица в особых специях — 4 см",
      "Маасдам (с большими дырками) — 1 см",
      "Гауда — 1 см",
      "Бри (с плесневой коркой) — 1 см",
      "Дорблю — 1 см",
      "Тильзитер — 1 см",
      "Пармезан — 1 см",
      '"Кислое" пиво — 5 см',
    ],
  },
  {
    id: "tavern-three-axes",
    name: 'Таверна "Три топора" (вывеска 777)',
    category: "Таверны",
    type: "Таверна",
    settlement: "Фонт",
    owner: { name: "Топор", title: "одноглазый добродушный бугай" },
    description:
      "Дешёвый трактир 777, где тусуются местные бомжи и прочий сброд.",
    menu: [
      "Пиво — 4 мм",
      "Вино — 6 мм",
      "Батин суп (состав секрет) — 1 см",
      "Похлёбка из курицы с яблоками — 5 мм",
      "Сухари — 2 мм",
    ],
  },
  {
    id: "forge-vitretin",
    name: "Кузня Эстелара Витретина",
    category: "Кузни",
    type: "Кузня",
    settlement: "Фонт",
    owner: { name: "Эстелар Витретин", title: "эльф" },
  },
  {
    id: "atelier-brinya",
    name: "Ателье Бринья",
    category: "Мастерские",
    type: "Лавка",
    settlement: "Фонт",
    owner: {
      name: "Дурнак и Солья Бринья",
      title: "пожилая пара дворфов",
    },
    description:
      "Уютная лавка, где кожевник Дурнак и портниха Солья создают одежду и снаряжение на заказ.",
    specialties: [
      "Кожаные доспехи и аксессуары ручной работы от Дурнака",
      "Индивидуальные костюмы, камзолы и плащи от Сольи",
    ],
    services: [
      "Ремонт и подгонка кожаного снаряжения",
      "Пошив одежды по меркам клиента",
      "Декорирование и вышивка клановыми узорами",
    ],
  },
];

export default establishments;



# MODULE src/data/world/geography.js
export const regions = [
  {
    id: "reg-northrange",
    name: "Северный Хребет",
    type: "горная гряда",
    panorama: "/assets/images/world/regions/northrange_panorama.jpg",
    bigMap: "/assets/images/world/regions/northrange_map.jpg",
    climate: "Суровый, ветреный, много снегов зимой. Летом — короткое тепло.",
    floraFauna: "Ели, карликовые берёзы, горные козлы, снежные барсы.",
    dangers: "Лавины, трещины в снегу, гнёзда грифонов.",
    locations: ["Перевал Орла", "Пещеры Эха"],
    peoples: "Горцы-рунники, монахи-хранители перевалов.",
    thumbs: [
      "/assets/images/world/regions/northrange_1.jpg",
      "/assets/images/world/regions/northrange_2.jpg",
    ],
  },
  {
    id: "reg-mire",
    name: "Багровые Болота",
    type: "болота",
    panorama: "/assets/images/world/regions/mire_panorama.jpg",
    bigMap: "/assets/images/world/regions/mire_map.jpg",
    climate: "Влажно, туманно. Тёплые зимы, душные лета.",
    floraFauna: "Ивы, камыши, ядовитые цветы, болотные гадюки, светлячки.",
    dangers: "Топи, миазмы, болотные огни, племена троглодитов.",
    locations: ["Затонувшая колокольня", "Тропа Светляков"],
    peoples: "Рыбаки-ловчие, отшельники-знахари.",
    thumbs: [
      "/assets/images/world/regions/mire_1.jpg",
      "/assets/images/world/regions/mire_2.jpg",
    ],
  },
];

export default regions;
export const geography = [];



# MODULE src/data/world/maps.js
export const maps = [
  {
    id: "map-world",
    title: "Карта мира",
    image: "/assets/images/world/maps/world.jpg",
    legend: ["Города", "Горы", "Леса", "Пустыни"],
    download: "/assets/images/world/maps/world_full.jpg",
  },
  {
    id: "map-continent",
    title: "Карта континента",
    image: "/assets/images/world/maps/continent.jpg",
    legend: ["Столицы", "Торговые пути", "Реки"],
    download: "/assets/images/world/maps/continent_full.jpg",
  },
];

export default maps;



# MODULE src/hooks/useData.js
import { useState, useEffect } from "react";
import { dataLoaders } from "../utils/dataLoader";

export function useData(loaderName, ...args) {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    let cancelled = false;

    async function load() {
      try {
        setLoading(true);
        setError(null);

        const loader = dataLoaders[loaderName];
        if (!loader) {
          throw new Error(`Unknown loader: ${loaderName}`);
        }

        const result = await loader(...args);

        if (!cancelled) {
          setData(result);
        }
      } catch (err) {
        if (!cancelled) {
          setError(err);
          console.error(`Error loading ${loaderName}:`, err);
        }
      } finally {
        if (!cancelled) {
          setLoading(false);
        }
      }
    }

    load();

    return () => {
      cancelled = true;
    };
  }, [loaderName, ...args]);

  return { data, loading, error };
}



# MODULE src/hooks/useDropdown.js
import { useCallback, useState } from "react";

export function useDropdown() {
  const [open, setOpen] = useState(false);
  const toggle = useCallback(() => setOpen((o) => !o), []);
  const close = useCallback(() => setOpen(false), []);
  return { open, toggle, close };
}



# MODULE src/hooks/useLocalStorage.js
import { useEffect, useState } from "react";

export function useLocalStorage(key, initialValue) {
  const [value, setValue] = useState(() => {
    try {
      const raw = localStorage.getItem(key);
      return raw ? JSON.parse(raw) : initialValue;
    } catch {
      return initialValue;
    }
  });

  useEffect(() => {
    try {
      localStorage.setItem(key, JSON.stringify(value));
    } catch {}
  }, [key, value]);

  return [value, setValue];
}



# MODULE src/hooks/useSearch.js
import { useMemo } from "react";

export function useSearch(items, query, fields) {
  return useMemo(() => {
    if (!Array.isArray(items)) return [];
    const q = String(query || "")
      .toLowerCase()
      .trim();
    if (!q) return items;
    return items.filter((it) =>
      fields.some((f) =>
        String(it[f] ?? "")
          .toLowerCase()
          .includes(q),
      ),
    );
  }, [items, query, fields]);
}



# MODULE src/hooks/useTheme.js
import { useContext } from "react";
import { ThemeContext } from "../app/providers/ThemeProvider.jsx";

export function useTheme() {
  return useContext(ThemeContext);
}



# MODULE src/index.jsx
import React from "react";
import { createRoot } from "react-dom/client";
import { BrowserRouter } from "react-router-dom";
import App from "./app/App.jsx";
import "./styles/globals.css";

const container = document.getElementById("root");
const root = createRoot(container);
root.render(
  <React.StrictMode>
    <BrowserRouter>
      <App />
    </BrowserRouter>
  </React.StrictMode>,
);



# MODULE src/pages/Characters/Allies/AlliesPage.jsx
import React from "react";
import { Link } from "react-router-dom";
import { useData } from "../../../hooks/useData";

export default function AlliesPage() {
  const { data: allies, loading, error } = useData("characters", "allies");

  if (loading) return <div style={{ padding: 24 }}>Загрузка...</div>;
  if (error) return <div style={{ padding: 24 }}>Ошибка: {error.message}</div>;

  return (
    <main style={{ padding: 24 }}>
      <h2 style={{ marginBottom: 16 }}>Союзники</h2>
      <div
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fill, minmax(220px, 1fr))",
          gap: 16,
        }}
      >
        {allies.map((a) => (
          <Link
            key={a.id}
            to={`/characters/allies/${a.id}`}
            style={{ textDecoration: "none", color: "inherit" }}
          >
            <div
              style={{
                background: "#121212",
                border: "1px solid rgba(255,255,255,0.1)",
                borderRadius: 12,
                overflow: "hidden",
                cursor: "pointer",
                transition: "border-color 0.2s",
              }}
              onMouseEnter={(e) => {
                e.currentTarget.style.borderColor = "rgba(255,255,255,0.3)";
              }}
              onMouseLeave={(e) => {
                e.currentTarget.style.borderColor = "rgba(255,255,255,0.1)";
              }}
            >
              <div
                style={{
                  height: 160,
                  background: `url(${a.portrait}) center/cover no-repeat`,
                }}
              />
              <div style={{ padding: 12 }}>
                <div style={{ fontWeight: 700 }}>{a.name}</div>
                <div style={{ opacity: 0.8 }}>{a.role}</div>
              </div>
            </div>
          </Link>
        ))}
      </div>
    </main>
  );
}



# MODULE src/pages/Characters/Allies/AllyDetail.jsx
import React from "react";
import { useParams, Link } from "react-router-dom";
import { useData } from "../../../hooks/useData";
import { getCharacterPath } from "../../../utils/getCharacterPath";

export default function AllyDetail() {
  const { id } = useParams();
  const { data: ally, loading, error } = useData("characters", "allies", id);

  if (loading) return <div style={{ padding: 24 }}>Загрузка...</div>;
  if (error) return <div style={{ padding: 24 }}>Ошибка: {error.message}</div>;
  if (!ally) return <div style={{ padding: 24 }}>Союзник не найден</div>;

  return (
    <main style={{ minHeight: "100%" }}>
      <section
        style={{
          position: "relative",
          height: "50vh",
          background: `url(${ally.banner || ally.portrait}) center/cover no-repeat`,
        }}
      >
        <div
          style={{
            position: "absolute",
            inset: 0,
            background: "rgba(0,0,0,0.45)",
          }}
        />
        <div
          style={{
            position: "absolute",
            inset: 0,
            display: "flex",
            alignItems: "flex-end",
          }}
        >
          <div
            style={{
              padding: 32,
              width: "100%",
              display: "flex",
              alignItems: "flex-end",
              justifyContent: "space-between",
              gap: 16,
            }}
          >
            <div>
              <h1 style={{ fontSize: 40, margin: 0, color: "#d4af37" }}>
                {ally.name}
              </h1>
              <div style={{ opacity: 0.9, marginTop: 6 }}>{ally.role}</div>
              {ally.quote && (
                <em style={{ display: "block", marginTop: 12, opacity: 0.9 }}>
                  "{ally.quote}"
                </em>
              )}
            </div>
            {ally.symbol && (
              <img
                src={ally.symbol}
                alt="symbol"
                style={{ width: 80, height: 80, objectFit: "contain" }}
              />
            )}
          </div>
        </div>
      </section>

      <section
        style={{
          display: "grid",
          gridTemplateColumns: "minmax(0,1fr) 340px",
          gap: 24,
          padding: 24,
        }}
      >
        <div>
          {ally.appearance && (
            <Block title="Внешность" text={ally.appearance} />
          )}
          {ally.biography && <Block title="Биография" text={ally.biography} />}
          {ally.personality && (
            <Block title="Личность и мотивация" text={ally.personality} />
          )}
          {ally.achievements?.length > 0 && (
            <ListBlock
              title="Достижения"
              items={ally.achievements}
              icon="/assets/images/icons/trophy-gold.png"
            />
          )}
          {ally.campaignMoments?.length > 0 && (
            <ListBlock
              title="Важные моменты в кампании"
              items={ally.campaignMoments}
            />
          )}
          {ally.gallery?.length > 0 && (
            <div style={{ marginTop: 24 }}>
              <h3 style={{ margin: "0 0 12px" }}>Галерея</h3>
              <div
                style={{
                  display: "grid",
                  gridTemplateColumns: "repeat(auto-fill, minmax(180px, 1fr))",
                  gap: 8,
                }}
              >
                {ally.gallery.map((src) => (
                  <img
                    key={src}
                    src={src}
                    alt="art"
                    style={{
                      width: "100%",
                      height: 140,
                      objectFit: "cover",
                      borderRadius: 8,
                    }}
                  />
                ))}
              </div>
            </div>
          )}
        </div>

        <aside>
          {ally.stats && Object.keys(ally.stats).length > 0 && (
            <div
              style={{
                display: "grid",
                gridTemplateColumns: "repeat(3, 1fr)",
                gap: 8,
              }}
            >
              {Object.entries(ally.stats).map(([key, value]) => (
                <div
                  key={key}
                  style={{
                    background: "#111",
                    border: "1px solid rgba(255,255,255,0.08)",
                    borderRadius: 8,
                    padding: 8,
                    textAlign: "center",
                  }}
                >
                  <div style={{ fontSize: 12, opacity: 0.8 }}>
                    {key.toUpperCase()}
                  </div>
                  <div style={{ fontSize: 18, fontWeight: 700 }}>{value}</div>
                </div>
              ))}
            </div>
          )}

          {ally.equipment?.length > 0 && (
            <div style={{ marginTop: 16 }}>
              <h4 style={{ margin: "0 0 8px" }}>Снаряжение</h4>
              <ul
                style={{
                  listStyle: "none",
                  padding: 0,
                  margin: 0,
                  display: "grid",
                  gap: 6,
                }}
              >
                {ally.equipment.map((it) => (
                  <li
                    key={it.name}
                    style={{ display: "flex", alignItems: "center", gap: 8 }}
                  >
                    <img
                      src={it.icon}
                      alt="icon"
                      style={{ width: 18, height: 18 }}
                    />
                    <span>{it.name}</span>
                  </li>
                ))}
              </ul>
            </div>
          )}

          {ally.relations?.length > 0 && (
            <div style={{ marginTop: 16 }}>
              <h4 style={{ margin: "0 0 8px" }}>Связи</h4>
              <div style={{ display: "flex", flexWrap: "wrap", gap: 8 }}>
                {ally.relations.map((r) => (
                  <Link
                    key={r.id}
                    to={getCharacterPath(r.id)}
                    style={{ textDecoration: "none", color: "inherit" }}
                  >
                    <figure style={{ margin: 0, textAlign: "center" }}>
                      <img
                        src={r.portrait}
                        alt={r.label}
                        style={{
                          width: 60,
                          height: 60,
                          objectFit: "cover",
                          borderRadius: 8,
                        }}
                      />
                      <figcaption style={{ fontSize: 12, opacity: 0.85 }}>
                        {r.label}
                      </figcaption>
                    </figure>
                  </Link>
                ))}
              </div>
            </div>
          )}

          {ally.city && (
            <div style={{ marginTop: 16 }}>
              <h4 style={{ margin: "0 0 8px" }}>Город</h4>
              <div>{ally.city}</div>
            </div>
          )}

          {ally.fractions?.length > 0 && (
            <div style={{ marginTop: 16 }}>
              <h4 style={{ margin: "0 0 8px" }}>Фракции</h4>
              <div style={{ display: "flex", gap: 8, flexWrap: "wrap" }}>
                {ally.fractions.map((f) => (
                  <Link
                    key={f.id}
                    to={`/lore/fractions/${f.id}`}
                    style={{ textDecoration: "none", color: "inherit" }}
                  >
                    <div
                      style={{
                        display: "flex",
                        alignItems: "center",
                        gap: 6,
                        background: "#111",
                        padding: "6px 8px",
                        borderRadius: 8,
                        border: "1px solid rgba(255,255,255,0.08)",
                      }}
                    >
                      {f.icon && (
                        <img
                          src={f.icon}
                          alt={f.name}
                          style={{ width: 18, height: 18 }}
                        />
                      )}
                      <span style={{ fontSize: 12 }}>{f.name}</span>
                    </div>
                  </Link>
                ))}
              </div>
            </div>
          )}
        </aside>
      </section>
    </main>
  );
}

function Block({ title, text }) {
  if (!text) return null;
  return (
    <div style={{ marginTop: 16 }}>
      <h3 style={{ margin: "0 0 8px" }}>{title}</h3>
      <p style={{ margin: 0, lineHeight: 1.65 }}>{parseTextWithLinks(text)}</p>
    </div>
  );
}

function parseTextWithLinks(text) {
  if (!text) return text;
  const linkRegex = /\[([^\]]+)\]\(([^)]+)\)/g;
  const parts = [];
  let lastIndex = 0;
  let match;
  let keyCounter = 0;

  while ((match = linkRegex.exec(text)) !== null) {
    if (match.index > lastIndex) {
      parts.push(text.substring(lastIndex, match.index));
    }
    const linkText = match[1];
    const linkPath = match[2];
    parts.push(
      <Link
        key={`link-${keyCounter++}`}
        to={linkPath}
        style={{ color: "#4da3ff", textDecoration: "none", fontWeight: 500 }}
      >
        {linkText}
      </Link>,
    );
    lastIndex = match.index + match[0].length;
  }

  if (lastIndex < text.length) {
    parts.push(text.substring(lastIndex));
  }

  return parts.length > 0 ? parts : text;
}

function ListBlock({ title, items, icon }) {
  if (!items || items.length === 0) return null;
  return (
    <div style={{ marginTop: 16 }}>
      <h3 style={{ margin: "0 0 8px" }}>{title}</h3>
      <ul
        style={{
          listStyle: "none",
          padding: 0,
          margin: 0,
          display: "grid",
          gap: 8,
        }}
      >
        {items.map((it, idx) => (
          <li
            key={idx}
            style={{ display: "flex", alignItems: "center", gap: 8 }}
          >
            {icon ? (
              <img src={icon} alt="icon" style={{ width: 16, height: 16 }} />
            ) : (
              <span
                style={{
                  width: 6,
                  height: 6,
                  borderRadius: 99,
                  background: "#d4af37",
                  display: "inline-block",
                }}
              />
            )}
            <span>{it}</span>
          </li>
        ))}
      </ul>
    </div>
  );
}



# MODULE src/pages/Characters/Deceased/DeceasedPage.jsx
// src/pages/Characters/Deceased/DeceasedPage.jsx
import React from "react";
import { Link } from "react-router-dom";
import { useData } from "../../../hooks/useData";

export default function DeceasedPage() {
  const {
    data: deceased,
    loading,
    error,
  } = useData("characters", "deceased");

  if (loading) {
    return (
      <main style={{ padding: 24, textAlign: "center" }}>
        <div style={{ fontSize: 18 }}>Загрузка...</div>
      </main>
    );
  }

  if (error) {
    return (
      <main style={{ padding: 24 }}>
        <h2>Ошибка загрузки</h2>
        <p>{error.message}</p>
      </main>
    );
  }

  return (
    <main style={{ padding: 24 }}>
      <h2 style={{ marginBottom: 16 }}>Павшие герои</h2>
      <div
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fill, minmax(280px, 1fr))",
          gap: 16,
        }}
      >
        {deceased.map((d) => (
          <Link
            key={d.id}
            to={`/characters/deceased/${d.id}`}
            style={{ textDecoration: "none", color: "inherit" }}
          >
            <div
              style={{
                borderRadius: 12,
                overflow: "hidden",
                border: "1px solid rgba(255,255,255,0.1)",
                background: "#121212",
                cursor: "pointer",
                transition: "border-color 0.2s",
              }}
              onMouseEnter={(e) => {
                e.currentTarget.style.borderColor = "rgba(255,255,255,0.3)";
              }}
              onMouseLeave={(e) => {
                e.currentTarget.style.borderColor = "rgba(255,255,255,0.1)";
              }}
            >
              <div
                style={{
                  position: "relative",
                  height: 180,
                  background: `url(${d.banner}) center/cover no-repeat`,
                  filter: "grayscale(0.8) contrast(1.05)",
                }}
              >
                <div
                  style={{
                    position: "absolute",
                    top: 8,
                    right: 8,
                    padding: "4px 8px",
                    background: "#7a0b0b",
                    color: "#fff",
                    borderRadius: 6,
                    fontWeight: 700,
                    fontSize: 12,
                  }}
                >
                  ПАВШИЙ
                </div>
                <div style={{ position: "absolute", bottom: 8, left: 12 }}>
                  <div style={{ fontWeight: 700, fontSize: 18 }}>{d.name}</div>
                  <div style={{ opacity: 0.85 }}>{d.role}</div>
                </div>
              </div>
              <div
                style={{
                  padding: 12,
                  display: "flex",
                  gap: 8,
                  alignItems: "center",
                }}
              >
                {d.symbol && (
                  <img
                    src={d.symbol}
                    alt="symbol"
                    style={{
                      width: 20,
                      height: 20,
                      objectFit: "contain",
                      opacity: 0.9,
                    }}
                  />
                )}
                {d.quote && (
                  <em style={{ opacity: 0.8, fontSize: 13 }}>"{d.quote}"</em>
                )}
              </div>
            </div>
          </Link>
        ))}
      </div>
    </main>
  );
}



# MODULE src/pages/Characters/Enemies/EnemiesPage.jsx
// src/pages/Characters/Enemies/EnemiesPage.jsx
import React from "react";
import { Link } from "react-router-dom";
import { useData } from "../../../hooks/useData";

export default function EnemiesPage() {
  const {
    data: enemies,
    loading,
    error,
  } = useData("characters", "enemies");

  if (loading) {
    return (
      <main style={{ padding: 24, textAlign: "center" }}>
        <div style={{ fontSize: 18 }}>Загрузка...</div>
      </main>
    );
  }

  if (error) {
    return (
      <main style={{ padding: 24 }}>
        <h2>Ошибка загрузки</h2>
        <p>{error.message}</p>
      </main>
    );
  }

  return (
    <main style={{ padding: 24 }}>
      <h2 style={{ marginBottom: 16 }}>Враги</h2>
      <div
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fill, minmax(220px, 1fr))",
          gap: 16,
        }}
      >
        {enemies.map((e) => (
          <Link
            key={e.id}
            to={`/characters/enemies/${e.id}`}
            style={{ textDecoration: "none", color: "inherit" }}
          >
            <div
              style={{
                background: "#121212",
                border: "1px solid rgba(255,255,255,0.1)",
                borderRadius: 12,
                overflow: "hidden",
                cursor: "pointer",
                transition: "border-color 0.2s",
              }}
              onMouseEnter={(e) => {
                e.currentTarget.style.borderColor = "rgba(255,77,77,0.5)";
              }}
              onMouseLeave={(e) => {
                e.currentTarget.style.borderColor = "rgba(255,255,255,0.1)";
              }}
            >
              <div
                style={{
                  height: 160,
                  background: `url(${e.portrait}) center/cover no-repeat`,
                  filter: "contrast(1.1) saturate(1.2)",
                }}
              />
              <div style={{ padding: 12 }}>
                <div style={{ fontWeight: 700, color: "#ff4d4d" }}>
                  {e.name}
                </div>
                <div style={{ opacity: 0.8 }}>{e.role}</div>
              </div>
            </div>
          </Link>
        ))}
      </div>
    </main>
  );
}



# MODULE src/pages/Characters/Enemies/EnemyDetail.jsx
// src/pages/Characters/Enemies/EnemyDetail.jsx
import React from "react";
import { useParams, Link } from "react-router-dom";
import { useEntity, useData } from "../../../hooks/useData";
import { getCharacterPath } from "../../../utils/getCharacterPath";

export default function EnemyDetail() {
  const { id } = useParams();
  const {
    data: enemy,
    loading,
    error,
  } = useEntity("characters", "enemies", id);
  const { data: cities } = useData("world", "cities");
  const { data: fractions } = useData("lore", "fractions");

  if (loading) {
    return (
      <main style={{ padding: 24, textAlign: "center" }}>
        <div style={{ fontSize: 18 }}>Загрузка...</div>
      </main>
    );
  }

  if (error || !enemy) {
    return (
      <main style={{ padding: 24 }}>
        <h2>Враг не найден</h2>
        <Link to="/characters/enemies">← Назад к врагам</Link>
      </main>
    );
  }

  return (
    <main style={{ minHeight: "100%" }}>
      <section
        style={{
          position: "relative",
          height: "50vh",
          background: `url(${enemy.banner}) center/cover no-repeat`,
        }}
      >
        <div
          style={{
            position: "absolute",
            inset: 0,
            background:
              "linear-gradient(to bottom, rgba(139,0,0,0.3), rgba(0,0,0,0.7))",
          }}
        />
        <div
          style={{
            position: "absolute",
            inset: 0,
            display: "flex",
            alignItems: "flex-end",
          }}
        >
          <div
            style={{
              padding: 32,
              width: "100%",
              display: "flex",
              alignItems: "flex-end",
              justifyContent: "space-between",
              gap: 16,
            }}
          >
            <div>
              <h1 style={{ fontSize: 40, margin: 0, color: "#ff4d4d" }}>
                {enemy.name}
              </h1>
              <div style={{ opacity: 0.9, marginTop: 6 }}>{enemy.role}</div>
              {enemy.quote && (
                <em style={{ display: "block", marginTop: 12, opacity: 0.9 }}>
                  "{enemy.quote}"
                </em>
              )}
            </div>
            {enemy.symbol && (
              <img
                src={enemy.symbol}
                alt="symbol"
                style={{ width: 80, height: 80, objectFit: "contain" }}
              />
            )}
          </div>
        </div>
      </section>

      <section
        style={{
          display: "grid",
          gridTemplateColumns: "minmax(0,1fr) 340px",
          gap: 24,
          padding: 24,
        }}
      >
        <div>
          <Block title="Внешность" text={enemy.appearance} />
          <Block title="Биография" text={enemy.biography} />
          <Block title="Личность и мотивация" text={enemy.personality} />
          <ListBlock
            title="Преступления"
            items={enemy.crimes}
            icon="/assets/images/icons/skull.png"
          />
          <ListBlock title="Известные поражения" items={enemy.defeats} />
        </div>

        <aside>
          {enemy.stats && Object.keys(enemy.stats).length > 0 && (
            <div
              style={{
                display: "grid",
                gridTemplateColumns: "repeat(3, 1fr)",
                gap: 8,
              }}
            >
              {Object.entries(enemy.stats).map(([key, value]) => (
                <div
                  key={key}
                  style={{
                    background: "#111",
                    border: "1px solid rgba(255,77,77,0.2)",
                    borderRadius: 8,
                    padding: 8,
                    textAlign: "center",
                  }}
                >
                  <div style={{ fontSize: 12, opacity: 0.8 }}>
                    {key.toUpperCase()}
                  </div>
                  <div
                    style={{ fontSize: 18, fontWeight: 700, color: "#ff4d4d" }}
                  >
                    {value}
                  </div>
                </div>
              ))}
            </div>
          )}

          {enemy.equipment && enemy.equipment.length > 0 && (
            <div style={{ marginTop: 16 }}>
              <h4 style={{ margin: "0 0 8px" }}>Снаряжение</h4>
              <ul
                style={{
                  listStyle: "none",
                  padding: 0,
                  margin: 0,
                  display: "grid",
                  gap: 6,
                }}
              >
                {enemy.equipment.map((it) => (
                  <li
                    key={it.name}
                    style={{ display: "flex", alignItems: "center", gap: 8 }}
                  >
                    <img
                      src={it.icon}
                      alt="icon"
                      style={{ width: 18, height: 18 }}
                    />
                    <span>{it.name}</span>
                  </li>
                ))}
              </ul>
            </div>
          )}

          {enemy.city && (
            <div style={{ marginTop: 16 }}>
              <h4 style={{ margin: "0 0 8px" }}>Последнее местонахождение</h4>
              {(() => {
                const city = cities.find((c) => c.name === enemy.city);
                return city ? (
                  <Link
                    to={`/world/cities/${city.id}`}
                    style={{ color: "#4da3ff", textDecoration: "none" }}
                  >
                    {enemy.city}
                  </Link>
                ) : (
                  <span>{enemy.city}</span>
                );
              })()}
            </div>
          )}

          {enemy.fractions?.length > 0 && (
            <div style={{ marginTop: 16 }}>
              <h4 style={{ margin: "0 0 8px" }}>Фракции</h4>
              <div style={{ display: "flex", gap: 8, flexWrap: "wrap" }}>
                {enemy.fractions.map((f) => {
                  const fraction = fractions.find((fr) => fr.id === f.id);
                  const content = (
                    <div
                      style={{
                        display: "flex",
                        alignItems: "center",
                        gap: 6,
                        background: "#111",
                        padding: "6px 8px",
                        borderRadius: 8,
                        border: "1px solid rgba(255,77,77,0.2)",
                      }}
                    >
                      {f.icon && (
                        <img
                          src={f.icon}
                          alt={f.name}
                          style={{ width: 18, height: 18 }}
                        />
                      )}
                      <span style={{ fontSize: 12 }}>{f.name}</span>
                    </div>
                  );
                  return fraction ? (
                    <Link
                      key={f.id}
                      to={`/lore/fractions/${f.id}`}
                      style={{ textDecoration: "none", color: "inherit" }}
                    >
                      {content}
                    </Link>
                  ) : (
                    <div key={f.id}>{content}</div>
                  );
                })}
              </div>
            </div>
          )}
        </aside>
      </section>
    </main>
  );
}

function Block({ title, text }) {
  if (!text) return null;
  return (
    <div style={{ marginTop: 16 }}>
      <h3 style={{ margin: "0 0 8px" }}>{title}</h3>
      <p style={{ margin: 0, lineHeight: 1.65 }}>{parseTextWithLinks(text)}</p>
    </div>
  );
}

function parseTextWithLinks(text) {
  if (!text) return text;
  const linkRegex = /\[([^\]]+)\]\(([^)]+)\)/g;
  const parts = [];
  let lastIndex = 0;
  let match;
  let keyCounter = 0;

  while ((match = linkRegex.exec(text)) !== null) {
    if (match.index > lastIndex) {
      parts.push(text.substring(lastIndex, match.index));
    }
    const linkText = match[1];
    const linkPath = match[2];
    parts.push(
      <Link
        key={`link-${keyCounter++}`}
        to={linkPath}
        style={{ color: "#4da3ff", textDecoration: "none", fontWeight: 500 }}
      >
        {linkText}
      </Link>,
    );
    lastIndex = match.index + match[0].length;
  }

  if (lastIndex < text.length) {
    parts.push(text.substring(lastIndex));
  }

  return parts.length > 0 ? parts : text;
}

function ListBlock({ title, items, icon }) {
  if (!items || items.length === 0) return null;
  return (
    <div style={{ marginTop: 16 }}>
      <h3 style={{ margin: "0 0 8px" }}>{title}</h3>
      <ul
        style={{
          listStyle: "none",
          padding: 0,
          margin: 0,
          display: "grid",
          gap: 8,
        }}
      >
        {items.map((it, idx) => (
          <li
            key={idx}
            style={{ display: "flex", alignItems: "center", gap: 8 }}
          >
            {icon ? (
              <img src={icon} alt="icon" style={{ width: 16, height: 16 }} />
            ) : (
              <span
                style={{
                  width: 6,
                  height: 6,
                  borderRadius: 99,
                  background: "#ff4d4d",
                  display: "inline-block",
                }}
              />
            )}
            <span>{it}</span>
          </li>
        ))}
      </ul>
    </div>
  );
}



# MODULE src/pages/Characters/index.jsx
import React from "react";
import { Link } from "react-router-dom";

export default function CharactersIndex() {
  return (
    <main style={{ padding: 24 }}>
      <h2 style={{ marginBottom: 16 }}>Персонажи</h2>
      <div
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fill, minmax(240px, 1fr))",
          gap: 16,
        }}
      >
        {[
          {
            label: "Игровые персонажи",
            to: "/characters/players",
            img: "/assets/images/chars/lyria_hero.jpg",
          },
          {
            label: "НПС",
            to: "/characters/npcs",
            img: "/assets/images/chars/velka_hero.jpg",
          },
          {
            label: "Союзники",
            to: "/characters/allies",
            img: "/assets/images/chars/bron_portrait.jpg",
          },
          {
            label: "Враги",
            to: "/characters/enemies",
            img: "/assets/images/chars/redric_portrait.jpg",
          },
          {
            label: "Павшие",
            to: "/characters/deceased",
            img: "/assets/images/chars/eldric_hero.jpg",
          },
        ].map((x) => (
          <Link
            key={x.to}
            to={x.to}
            style={{
              textDecoration: "none",
              color: "inherit",
              borderRadius: 12,
              overflow: "hidden",
              border: "1px solid rgba(255,255,255,0.1)",
              background: "#121212",
            }}
          >
            <div
              style={{
                height: 140,
                background: `url(${x.img}) center/cover no-repeat`,
              }}
            />
            <div style={{ padding: 12, fontWeight: 700 }}>{x.label}</div>
          </Link>
        ))}
      </div>
    </main>
  );
}



# MODULE src/pages/Characters/NPCs/NPCDetail.jsx
import React from "react";
import { useParams, Link } from "react-router-dom";
import { useData } from "../../../hooks/useData";
import { getCharacterPath } from "../../../utils/getCharacterPath";

export default function NPCDetail() {
  const { id } = useParams();
  const { data: npc, loading, error } = useData("characters", "npcs", id);

  if (loading) return <div style={{ padding: 24 }}>Загрузка...</div>;
  if (error) return <div style={{ padding: 24 }}>Ошибка: {error.message}</div>;
  if (!npc) return <div style={{ padding: 24 }}>НПС не найден</div>;

  return (
    <main style={{ minHeight: "100%" }}>
      <section
        style={{
          position: "relative",
          height: "50vh",
          background: `url(${npc.banner || npc.portrait}) center/cover no-repeat`,
        }}
      >
        <div
          style={{
            position: "absolute",
            inset: 0,
            background: "rgba(0,0,0,0.45)",
          }}
        />
        <div
          style={{
            position: "absolute",
            inset: 0,
            display: "flex",
            alignItems: "flex-end",
          }}
        >
          <div
            style={{
              padding: 32,
              width: "100%",
              display: "flex",
              alignItems: "flex-end",
              justifyContent: "space-between",
              gap: 16,
            }}
          >
            <div>
              <h1 style={{ fontSize: 40, margin: 0, color: "#d4af37" }}>
                {npc.name}
              </h1>
              <div style={{ opacity: 0.9, marginTop: 6 }}>{npc.role}</div>
              {npc.quote && (
                <em style={{ display: "block", marginTop: 12, opacity: 0.9 }}>
                  "{npc.quote}"
                </em>
              )}
            </div>
            {npc.symbol && (
              <img
                src={npc.symbol}
                alt="symbol"
                style={{ width: 80, height: 80, objectFit: "contain" }}
              />
            )}
          </div>
        </div>
      </section>

      <section
        style={{
          display: "grid",
          gridTemplateColumns: "minmax(0,1fr) 340px",
          gap: 24,
          padding: 24,
        }}
      >
        <div>
          {npc.appearance && <Block title="Внешность" text={npc.appearance} />}
          {npc.biography && <Block title="Биография" text={npc.biography} />}
          {npc.personality && (
            <Block title="Личность и мотивация" text={npc.personality} />
          )}
          {npc.achievements?.length > 0 && (
            <ListBlock
              title="Достижения"
              items={npc.achievements}
              icon="/assets/images/icons/trophy-gold.png"
            />
          )}
          {npc.campaignMoments?.length > 0 && (
            <ListBlock
              title="Важные моменты в кампании"
              items={npc.campaignMoments}
            />
          )}
          {npc.gallery?.length > 0 && (
            <div style={{ marginTop: 24 }}>
              <h3 style={{ margin: "0 0 12px" }}>Галерея</h3>
              <div
                style={{
                  display: "grid",
                  gridTemplateColumns: "repeat(auto-fill, minmax(180px, 1fr))",
                  gap: 8,
                }}
              >
                {npc.gallery.map((src) => (
                  <img
                    key={src}
                    src={src}
                    alt="art"
                    style={{
                      width: "100%",
                      height: 140,
                      objectFit: "cover",
                      borderRadius: 8,
                    }}
                  />
                ))}
              </div>
            </div>
          )}
        </div>

        <aside>
          {npc.stats && Object.keys(npc.stats).length > 0 && (
            <div
              style={{
                display: "grid",
                gridTemplateColumns: "repeat(3, 1fr)",
                gap: 8,
              }}
            >
              {Object.entries(npc.stats).map(([key, value]) => (
                <div
                  key={key}
                  style={{
                    background: "#111",
                    border: "1px solid rgba(255,255,255,0.08)",
                    borderRadius: 8,
                    padding: 8,
                    textAlign: "center",
                  }}
                >
                  <div style={{ fontSize: 12, opacity: 0.8 }}>
                    {key.toUpperCase()}
                  </div>
                  <div style={{ fontSize: 18, fontWeight: 700 }}>{value}</div>
                </div>
              ))}
            </div>
          )}

          {npc.equipment?.length > 0 && (
            <div style={{ marginTop: 16 }}>
              <h4 style={{ margin: "0 0 8px" }}>Снаряжение</h4>
              <ul
                style={{
                  listStyle: "none",
                  padding: 0,
                  margin: 0,
                  display: "grid",
                  gap: 6,
                }}
              >
                {npc.equipment.map((it) => (
                  <li
                    key={it.name}
                    style={{ display: "flex", alignItems: "center", gap: 8 }}
                  >
                    <img
                      src={it.icon}
                      alt="icon"
                      style={{ width: 18, height: 18 }}
                    />
                    <span>{it.name}</span>
                  </li>
                ))}
              </ul>
            </div>
          )}

          {npc.relations?.length > 0 && (
            <div style={{ marginTop: 16 }}>
              <h4 style={{ margin: "0 0 8px" }}>Связи</h4>
              <div style={{ display: "flex", flexWrap: "wrap", gap: 8 }}>
                {npc.relations.map((r) => (
                  <Link
                    key={r.id}
                    to={getCharacterPath(r.id)}
                    style={{ textDecoration: "none", color: "inherit" }}
                  >
                    <figure style={{ margin: 0, textAlign: "center" }}>
                      <img
                        src={r.portrait}
                        alt={r.label}
                        style={{
                          width: 60,
                          height: 60,
                          objectFit: "cover",
                          borderRadius: 8,
                        }}
                      />
                      <figcaption style={{ fontSize: 12, opacity: 0.85 }}>
                        {r.label}
                      </figcaption>
                    </figure>
                  </Link>
                ))}
              </div>
            </div>
          )}

          {npc.city && (
            <div style={{ marginTop: 16 }}>
              <h4 style={{ margin: "0 0 8px" }}>Город</h4>
              <div>{npc.city}</div>
            </div>
          )}

          {npc.fractions?.length > 0 && (
            <div style={{ marginTop: 16 }}>
              <h4 style={{ margin: "0 0 8px" }}>Фракции</h4>
              <div style={{ display: "flex", gap: 8, flexWrap: "wrap" }}>
                {npc.fractions.map((f) => (
                  <Link
                    key={f.id}
                    to={`/lore/fractions/${f.id}`}
                    style={{ textDecoration: "none", color: "inherit" }}
                  >
                    <div
                      style={{
                        display: "flex",
                        alignItems: "center",
                        gap: 6,
                        background: "#111",
                        padding: "6px 8px",
                        borderRadius: 8,
                        border: "1px solid rgba(255,255,255,0.08)",
                      }}
                    >
                      {f.icon && (
                        <img
                          src={f.icon}
                          alt={f.name}
                          style={{ width: 18, height: 18 }}
                        />
                      )}
                      <span style={{ fontSize: 12 }}>{f.name}</span>
                    </div>
                  </Link>
                ))}
              </div>
            </div>
          )}
        </aside>
      </section>
    </main>
  );
}

function Block({ title, text }) {
  if (!text) return null;
  return (
    <div style={{ marginTop: 16 }}>
      <h3 style={{ margin: "0 0 8px" }}>{title}</h3>
      <p style={{ margin: 0, lineHeight: 1.65 }}>{parseTextWithLinks(text)}</p>
    </div>
  );
}

function parseTextWithLinks(text) {
  if (!text) return text;
  const linkRegex = /\[([^\]]+)\]\(([^)]+)\)/g;
  const parts = [];
  let lastIndex = 0;
  let match;
  let keyCounter = 0;

  while ((match = linkRegex.exec(text)) !== null) {
    if (match.index > lastIndex) {
      parts.push(text.substring(lastIndex, match.index));
    }
    const linkText = match[1];
    const linkPath = match[2];
    parts.push(
      <Link
        key={`link-${keyCounter++}`}
        to={linkPath}
        style={{ color: "#4da3ff", textDecoration: "none", fontWeight: 500 }}
      >
        {linkText}
      </Link>,
    );
    lastIndex = match.index + match[0].length;
  }

  if (lastIndex < text.length) {
    parts.push(text.substring(lastIndex));
  }

  return parts.length > 0 ? parts : text;
}

function ListBlock({ title, items, icon }) {
  if (!items || items.length === 0) return null;
  return (
    <div style={{ marginTop: 16 }}>
      <h3 style={{ margin: "0 0 8px" }}>{title}</h3>
      <ul
        style={{
          listStyle: "none",
          padding: 0,
          margin: 0,
          display: "grid",
          gap: 8,
        }}
      >
        {items.map((it, idx) => (
          <li
            key={idx}
            style={{ display: "flex", alignItems: "center", gap: 8 }}
          >
            {icon ? (
              <img src={icon} alt="icon" style={{ width: 16, height: 16 }} />
            ) : (
              <span
                style={{
                  width: 6,
                  height: 6,
                  borderRadius: 99,
                  background: "#d4af37",
                  display: "inline-block",
                }}
              />
            )}
            <span>{it}</span>
          </li>
        ))}
      </ul>
    </div>
  );
}



# MODULE src/pages/Characters/NPCs/NPCsPage.jsx
import React from "react";
import { Link } from "react-router-dom";
import { useData } from "../../../hooks/useData";

export default function NPCsPage() {
  const { data: npcs, loading, error } = useData("characters", "npcs");

  if (loading) return <div style={{ padding: 24 }}>Загрузка...</div>;
  if (error) return <div style={{ padding: 24 }}>Ошибка: {error.message}</div>;

  return (
    <main style={{ padding: 24 }}>
      <h2 style={{ marginBottom: 16 }}>НПС</h2>
      <div
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fill, minmax(240px, 1fr))",
          gap: 16,
        }}
      >
        {npcs.map((n) => (
          <Link
            key={n.id}
            to={`/characters/npcs/${n.id}`}
            style={{
              textDecoration: "none",
              color: "inherit",
              borderRadius: 12,
              overflow: "hidden",
              border: "1px solid rgba(255,255,255,0.1)",
              background: "#121212",
              cursor: "pointer",
              transition: "border-color 0.2s",
            }}
            onMouseEnter={(e) => {
              e.currentTarget.style.borderColor = "rgba(255,255,255,0.3)";
            }}
            onMouseLeave={(e) => {
              e.currentTarget.style.borderColor = "rgba(255,255,255,0.1)";
            }}
          >
            <div
              style={{
                position: "relative",
                height: 160,
                background: `url(${n.banner || n.portrait}) center/cover no-repeat`,
              }}
            >
              <div
                style={{
                  position: "absolute",
                  inset: 0,
                  background:
                    "linear-gradient(180deg, rgba(0,0,0,0.0) 30%, rgba(0,0,0,0.7) 100%)",
                }}
              />
              <div style={{ position: "absolute", bottom: 8, left: 12 }}>
                <div style={{ fontWeight: 700, fontSize: 18 }}>{n.name}</div>
                <div style={{ opacity: 0.8, fontSize: 13 }}>{n.role}</div>
              </div>
            </div>
            <div
              style={{
                padding: 12,
                display: "flex",
                gap: 8,
                alignItems: "center",
              }}
            >
              {n.symbol && (
                <img
                  src={n.symbol}
                  alt="symbol"
                  style={{
                    width: 24,
                    height: 24,
                    objectFit: "contain",
                    opacity: 0.9,
                  }}
                />
              )}
              {n.quote && (
                <em style={{ opacity: 0.8, fontSize: 13 }}>"{n.quote}"</em>
              )}
            </div>
          </Link>
        ))}
      </div>
    </main>
  );
}



# MODULE src/pages/Characters/PlayerCharacters/PlayerCharacterDetail.jsx
// src/pages/Characters/PlayerCharacters/PlayerCharacterDetail.jsx
import React, { useState, useEffect } from "react";
import { useParams, Link } from "react-router-dom";
import { getCharacterPath } from "../../../utils/getCharacterPath";

export default function PlayerCharacterDetail() {
  const { id } = useParams();
  const [pc, setPc] = useState(null);
  const [cities, setCities] = useState([]);
  const [fractions, setFractions] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    async function loadData() {
      try {
        // Загружаем данные персонажа
        const pcResponse = await fetch(`/data/characters/players/${id}.json`);
        if (!pcResponse.ok) throw new Error("Персонаж не найден");
        const pcData = await pcResponse.json();
        setPc(pcData);

        // Загружаем города (для ссылок)
        try {
          const citiesIndexResponse = await fetch(
            "/data/world/cities/index.json",
          );
          if (citiesIndexResponse.ok) {
            const cityIds = await citiesIndexResponse.json();
            const citiesData = await Promise.all(
              cityIds.map(async (cityId) => {
                const response = await fetch(
                  `/data/world/cities/${cityId}.json`,
                );
                return response.ok ? response.json() : null;
              }),
            );
            setCities(citiesData.filter(Boolean));
          }
        } catch (err) {
          console.warn("Не удалось загрузить города:", err);
        }

        // Загружаем фракции (для ссылок)
        try {
          const fractionsIndexResponse = await fetch(
            "/data/lore/fractions/index.json",
          );
          if (fractionsIndexResponse.ok) {
            const fractionIds = await fractionsIndexResponse.json();
            const fractionsData = await Promise.all(
              fractionIds.map(async (fractionId) => {
                const response = await fetch(
                  `/data/lore/fractions/${fractionId}.json`,
                );
                return response.ok ? response.json() : null;
              }),
            );
            setFractions(fractionsData.filter(Boolean));
          }
        } catch (err) {
          console.warn("Не удалось загрузить фракции:", err);
        }
      } catch (err) {
        setError(err.message);
        console.error("Ошибка загрузки персонажа:", err);
      } finally {
        setLoading(false);
      }
    }

    loadData();
  }, [id]);

  if (loading) {
    return (
      <main style={{ padding: "24px", textAlign: "center", minHeight: "100%" }}>
        <div style={{ fontSize: 18, opacity: 0.8 }}>Загрузка персонажа...</div>
      </main>
    );
  }

  if (error || !pc) {
    return (
      <main style={{ padding: "24px", minHeight: "100%" }}>
        <div style={{ color: "#ff4d4d", marginBottom: 16 }}>
          <strong>Ошибка:</strong> {error || "Персонаж не найден"}
        </div>
        <Link to="/characters/players" style={{ color: "#4da3ff" }}>
          ← Назад к списку персонажей
        </Link>
      </main>
    );
  }

  return (
    <main style={{ minHeight: "100%" }}>
      {/* Hero */}
      <section
        style={{
          position: "relative",
          height: "60vh",
          background: `url(${pc.banner}) center/cover no-repeat`,
        }}
      >
        <div
          style={{
            position: "absolute",
            inset: 0,
            background: "rgba(0,0,0,0.45)",
          }}
        />
        <div
          style={{
            position: "absolute",
            inset: 0,
            display: "flex",
            alignItems: "flex-end",
          }}
        >
          <div
            style={{
              padding: "32px",
              width: "100%",
              display: "flex",
              alignItems: "flex-end",
              justifyContent: "space-between",
              gap: 16,
            }}
          >
            <div>
              <h1 style={{ fontSize: 48, margin: 0, color: "#d4af37" }}>
                {pc.name}
              </h1>
              <div style={{ opacity: 0.9, marginTop: 8, fontSize: 16 }}>
                {pc.class} • {pc.race} • ур. {pc.level}
              </div>
              {pc.quote && (
                <em style={{ display: "block", marginTop: 12, opacity: 0.9 }}>
                  "{pc.quote}"
                </em>
              )}
            </div>
            {pc.symbol && (
              <img
                src={pc.symbol}
                alt="symbol"
                style={{ width: 96, height: 96, objectFit: "contain" }}
              />
            )}
          </div>
        </div>
      </section>

      {/* Content */}
      <section
        style={{
          display: "grid",
          gridTemplateColumns: "minmax(0,1fr) 360px",
          gap: 24,
          padding: 24,
        }}
      >
        <div>
          <Block title="Внешность" text={pc.appearance} />
          <Block title="Биография" text={pc.biography} />
          <Block title="Личность и мотивация" text={pc.personality} />
          <ListBlock
            title="Достижения"
            items={pc.achievements}
            icon="/assets/images/icons/trophy-gold.png"
          />
          <ListBlock
            title="Важные моменты в кампании"
            items={pc.campaignMoments}
          />
          {pc.gallery?.length > 0 && (
            <div style={{ marginTop: 24 }}>
              <h3 style={{ margin: "0 0 12px" }}>Галерея</h3>
              <div
                style={{
                  display: "grid",
                  gridTemplateColumns: "repeat(auto-fill, minmax(180px, 1fr))",
                  gap: 8,
                }}
              >
                {pc.gallery.map((src, idx) => (
                  <img
                    key={idx}
                    src={src}
                    alt="art"
                    style={{
                      width: "100%",
                      height: 140,
                      objectFit: "cover",
                      borderRadius: 8,
                    }}
                  />
                ))}
              </div>
            </div>
          )}
        </div>

        <aside>
          {pc.stats && Object.keys(pc.stats).length > 0 && (
            <div
              style={{
                display: "grid",
                gridTemplateColumns: "repeat(3, 1fr)",
                gap: 8,
              }}
            >
              {Object.entries(pc.stats).map(([key, value]) => (
                <div
                  key={key}
                  style={{
                    background: "#111",
                    border: "1px solid rgba(255,255,255,0.08)",
                    borderRadius: 8,
                    padding: 8,
                    textAlign: "center",
                  }}
                >
                  <div style={{ fontSize: 12, opacity: 0.8 }}>
                    {key.toUpperCase()}
                  </div>
                  <div style={{ fontSize: 18, fontWeight: 700 }}>{value}</div>
                </div>
              ))}
            </div>
          )}

          {pc.equipment && pc.equipment.length > 0 && (
            <div style={{ marginTop: 16 }}>
              <h4 style={{ margin: "0 0 8px" }}>Снаряжение</h4>
              <ul
                style={{
                  listStyle: "none",
                  padding: 0,
                  margin: 0,
                  display: "grid",
                  gap: 6,
                }}
              >
                {pc.equipment.map((it, idx) => (
                  <li
                    key={idx}
                    style={{ display: "flex", alignItems: "center", gap: 8 }}
                  >
                    {it.icon && (
                      <img
                        src={it.icon}
                        alt="icon"
                        style={{ width: 18, height: 18 }}
                      />
                    )}
                    <span>{it.name}</span>
                  </li>
                ))}
              </ul>
            </div>
          )}

          {pc.relations && pc.relations.length > 0 && (
            <div style={{ marginTop: 16 }}>
              <h4 style={{ margin: "0 0 8px" }}>Связи</h4>
              <div style={{ display: "flex", flexWrap: "wrap", gap: 8 }}>
                {pc.relations.map((r, idx) => {
                  const relationPath = getCharacterPath(r.id);
                  const content = (
                    <figure
                      key={idx}
                      style={{ margin: 0, textAlign: "center" }}
                    >
                      {r.portrait && (
                        <img
                          src={r.portrait}
                          alt={r.label}
                          style={{
                            width: 60,
                            height: 60,
                            objectFit: "cover",
                            borderRadius: 8,
                          }}
                        />
                      )}
                      <figcaption style={{ fontSize: 12, opacity: 0.85 }}>
                        {r.label}
                      </figcaption>
                    </figure>
                  );
                  return relationPath ? (
                    <Link
                      key={idx}
                      to={relationPath}
                      style={{ textDecoration: "none", color: "inherit" }}
                    >
                      {content}
                    </Link>
                  ) : (
                    content
                  );
                })}
              </div>
            </div>
          )}

          {pc.city && (
            <div style={{ marginTop: 16 }}>
              <h4 style={{ margin: "0 0 8px" }}>Город</h4>
              {(() => {
                const city = cities.find((c) => c.name === pc.city);
                return city ? (
                  <Link
                    to={`/world/cities/${city.id}`}
                    style={{
                      display: "inline-block",
                      color: "#4da3ff",
                      textDecoration: "none",
                    }}
                  >
                    {pc.city}
                  </Link>
                ) : (
                  <span>{pc.city}</span>
                );
              })()}
            </div>
          )}

          {pc.fractions && pc.fractions.length > 0 && (
            <div style={{ marginTop: 16 }}>
              <h4 style={{ margin: "0 0 8px" }}>Фракции</h4>
              <div style={{ display: "flex", gap: 8, flexWrap: "wrap" }}>
                {pc.fractions.map((f, idx) => {
                  const fraction = fractions.find((fr) => fr.id === f.id);
                  const content = (
                    <div
                      key={idx}
                      style={{
                        display: "flex",
                        alignItems: "center",
                        gap: 6,
                        background: "#111",
                        padding: "6px 8px",
                        borderRadius: 8,
                        border: "1px solid rgba(255,255,255,0.08)",
                      }}
                    >
                      {f.icon && (
                        <img
                          src={f.icon}
                          alt={f.name}
                          style={{ width: 18, height: 18 }}
                        />
                      )}
                      <span style={{ fontSize: 12 }}>{f.name}</span>
                    </div>
                  );
                  return fraction ? (
                    <Link
                      key={idx}
                      to={`/lore/fractions/${f.id}`}
                      style={{ textDecoration: "none", color: "inherit" }}
                    >
                      {content}
                    </Link>
                  ) : (
                    content
                  );
                })}
              </div>
            </div>
          )}
        </aside>
      </section>
    </main>
  );
}

function Block({ title, text }) {
  if (!text) return null;
  return (
    <div style={{ marginTop: 16 }}>
      <h3 style={{ margin: "0 0 8px" }}>{title}</h3>
      <div style={{ lineHeight: 1.65 }}>
        {text.split("\n").map((para, idx) => (
          <p
            key={idx}
            style={{
              margin: idx > 0 ? "16px 0 0" : 0,
              textIndent: "2em",
              textAlign: "justify",
            }}
          >
            {parseTextWithLinks(para.trim())}
          </p>
        ))}
      </div>
    </div>
  );
}

function parseTextWithLinks(text) {
  if (!text) return text;

  const linkRegex = /\[([^\]]+)\]\(([^)]+)\)/g;
  const parts = [];
  let lastIndex = 0;
  let match;
  let keyCounter = 0;

  while ((match = linkRegex.exec(text)) !== null) {
    if (match.index > lastIndex) {
      parts.push(text.substring(lastIndex, match.index));
    }

    const linkText = match[1];
    const linkPath = match[2];
    parts.push(
      <Link
        key={`link-${keyCounter++}`}
        to={linkPath}
        style={{ color: "#4da3ff", textDecoration: "none", fontWeight: 500 }}
      >
        {linkText}
      </Link>,
    );

    lastIndex = match.index + match[0].length;
  }

  if (lastIndex < text.length) {
    parts.push(text.substring(lastIndex));
  }

  return parts.length > 0 ? parts : text;
}

function ListBlock({ title, items, icon }) {
  if (!items || items.length === 0) return null;
  return (
    <div style={{ marginTop: 16 }}>
      <h3 style={{ margin: "0 0 8px" }}>{title}</h3>
      <ul
        style={{
          listStyle: "none",
          padding: 0,
          margin: 0,
          display: "grid",
          gap: 8,
        }}
      >
        {items.map((it, idx) => (
          <li
            key={idx}
            style={{ display: "flex", alignItems: "center", gap: 8 }}
          >
            {icon ? (
              <img src={icon} alt="icon" style={{ width: 16, height: 16 }} />
            ) : (
              <span
                style={{
                  width: 6,
                  height: 6,
                  borderRadius: 99,
                  background: "#d4af37",
                  display: "inline-block",
                }}
              />
            )}
            <span>{it}</span>
          </li>
        ))}
      </ul>
    </div>
  );
}



# MODULE src/pages/Characters/PlayerCharacters/PlayerCharactersPage.jsx
// src/pages/Characters/PlayerCharacters/PlayerCharactersPage.jsx
import React, { useState, useEffect } from "react";
import { Link } from "react-router-dom";

export default function PlayerCharactersPage() {
  const [characters, setCharacters] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    async function loadCharacters() {
      try {
        // Загружаем список ID персонажей
        const indexResponse = await fetch(
          "/data/characters/players/index.json",
        );
        if (!indexResponse.ok)
          throw new Error("Не удалось загрузить список персонажей");
        const characterIds = await indexResponse.json();

        // Загружаем данные каждого персонажа
        const charactersData = await Promise.all(
          characterIds.map(async (id) => {
            const response = await fetch(`/data/characters/players/${id}.json`);
            if (!response.ok)
              throw new Error(`Не удалось загрузить персонажа ${id}`);
            return response.json();
          }),
        );

        setCharacters(charactersData);
      } catch (err) {
        setError(err.message);
        console.error("Ошибка загрузки персонажей:", err);
      } finally {
        setLoading(false);
      }
    }

    loadCharacters();
  }, []);

  if (loading) {
    return (
      <main style={{ padding: "24px", textAlign: "center" }}>
        <div style={{ fontSize: 18, opacity: 0.8 }}>Загрузка персонажей...</div>
      </main>
    );
  }

  if (error) {
    return (
      <main style={{ padding: "24px" }}>
        <div style={{ color: "#ff4d4d", marginBottom: 16 }}>
          <strong>Ошибка:</strong> {error}
        </div>
        <Link to="/characters" style={{ color: "#4da3ff" }}>
          ← Назад к персонажам
        </Link>
      </main>
    );
  }

  return (
    <main style={{ padding: "24px" }}>
      <h2 style={{ marginBottom: "16px" }}>Игровые персонажи</h2>
      <div
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fill, minmax(240px, 1fr))",
          gap: "16px",
        }}
      >
        {characters.map((pc) => (
          <Link
            key={pc.id}
            to={`/characters/players/${pc.id}`}
            style={{
              textDecoration: "none",
              color: "inherit",
              borderRadius: 12,
              overflow: "hidden",
              border: "1px solid rgba(255,255,255,0.1)",
              background: "#121212",
              cursor: "pointer",
              transition: "border-color 0.2s",
            }}
            onMouseEnter={(e) => {
              e.currentTarget.style.borderColor = "rgba(255,255,255,0.3)";
            }}
            onMouseLeave={(e) => {
              e.currentTarget.style.borderColor = "rgba(255,255,255,0.1)";
            }}
          >
            <div
              style={{
                position: "relative",
                height: 160,
                background: `url(${pc.banner}) center/cover no-repeat`,
                filter: "saturate(0.9)",
              }}
            >
              <div
                style={{
                  position: "absolute",
                  inset: 0,
                  background:
                    "linear-gradient(180deg, rgba(0,0,0,0.0) 30%, rgba(0,0,0,0.7) 100%)",
                }}
              />
              <div style={{ position: "absolute", bottom: 8, left: 12 }}>
                <div style={{ fontWeight: 700, fontSize: 18 }}>{pc.name}</div>
                <div style={{ opacity: 0.8, fontSize: 13 }}>
                  {pc.class} • {pc.race} • ур. {pc.level}
                </div>
              </div>
            </div>
            <div
              style={{
                padding: 12,
                display: "flex",
                gap: 8,
                alignItems: "center",
              }}
            >
              {pc.symbol && (
                <img
                  src={pc.symbol}
                  alt="symbol"
                  style={{
                    width: 24,
                    height: 24,
                    objectFit: "contain",
                    opacity: 0.9,
                  }}
                />
              )}
              <em style={{ opacity: 0.8, fontSize: 13 }}>"{pc.quote}"</em>
            </div>
          </Link>
        ))}
      </div>
    </main>
  );
}



# MODULE src/pages/Chronicles/AllSessions/SessionDetail.jsx
import React, { useState, useEffect } from "react";
import { useParams, Link } from "react-router-dom";
import { getCharacterPath } from "../../../utils/getCharacterPath";

function findCharacter(id, allCharacters) {
  return allCharacters.find((c) => c.id === id);
}

export default function SessionDetail() {
  const { id } = useParams();
  const [session, setSession] = useState(null);
  const [allCharacters, setAllCharacters] = useState([]);
  const [sessions, setSessions] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    async function loadData() {
      try {
        setLoading(true);

        // Загружаем сессию
        const sessionResponse = await fetch(
          `/data/chronicles/sessions/${id}.json`,
        );
        if (!sessionResponse.ok) throw new Error("Failed to load session data");
        const sessionData = await sessionResponse.json();
        setSession(sessionData);

        // Загружаем список всех сессий для навигации
        const sessionsResponse = await fetch(
          "/data/chronicles/sessions/index.json",
        );
        if (sessionsResponse.ok) {
          const sessionsData = await sessionsResponse.json();
          setSessions(sessionsData);
        }

        // Загружаем персонажей для участников
        const characters = [];
        if (sessionData.participants) {
          for (const participantId of sessionData.participants) {
            try {
              let response;
              if (participantId.startsWith("pc-")) {
                response = await fetch(
                  `/data/characters/players/${participantId}.json`,
                );
              } else if (participantId.startsWith("npc-")) {
                response = await fetch(
                  `/data/characters/npcs/${participantId}.json`,
                );
              } else if (participantId.startsWith("ally-")) {
                response = await fetch(
                  `/data/characters/allies/${participantId}.json`,
                );
              }
              if (response && response.ok) {
                const char = await response.json();
                characters.push(char);
              }
            } catch (err) {
              console.warn(`Failed to load character ${participantId}`, err);
            }
          }
        }
        setAllCharacters(characters);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    }
    loadData();
  }, [id]);

  if (loading) {
    return (
      <main style={{ padding: 24, textAlign: "center" }}>
        <div>Загрузка сессии...</div>
      </main>
    );
  }

  if (error) {
    return (
      <main style={{ padding: 24 }}>
        <h2>Ошибка загрузки</h2>
        <p>{error}</p>
        <Link to="/chronicles/sessions">← Назад к сессиям</Link>
      </main>
    );
  }

  if (!session) {
    return (
      <main style={{ padding: 24 }}>
        <h2>Сессия не найдена</h2>
        <Link to="/chronicles/sessions">← Назад к сессиям</Link>
      </main>
    );
  }

  const idx = sessions.findIndex((s) => s.id === id);
  const prev = sessions[idx - 1];
  const next = sessions[idx + 1];

  return (
    <main style={{ minHeight: "100%" }}>
      {/* Top */}
      <section style={{ position: "relative", height: 320 }}>
        <img
          src={session.heroImage}
          alt={session.title}
          style={{ width: "100%", height: "100%", objectFit: "cover" }}
        />
        <div
          style={{
            position: "absolute",
            inset: 0,
            background: "rgba(0,0,0,0.35)",
          }}
        />
        <div
          style={{
            position: "absolute",
            bottom: 12,
            left: 16,
            right: 16,
            display: "flex",
            alignItems: "center",
            justifyContent: "space-between",
          }}
        >
          <div>
            <div style={{ opacity: 0.95 }}>
              {session.realDate} • {session.gameDate} • #{session.num}
            </div>
            <h1 style={{ margin: 0 }}>{session.title}</h1>
          </div>
        </div>
      </section>

      {/* Content */}
      <section
        style={{
          display: "grid",
          gridTemplateColumns: "minmax(0,1fr) 320px",
          gap: 24,
          padding: 24,
        }}
      >
        <div style={{ maxWidth: 900, margin: "0 auto" }}>
          <Block title="Краткое содержание" text={session.summary} />

          {session.participants?.length > 0 && (
            <div style={{ marginTop: 16 }}>
              <div style={{ fontWeight: 700, marginBottom: 8 }}>Участники</div>
              <div style={{ display: "flex", gap: 12, flexWrap: "wrap" }}>
                {session.participants.map((participantId) => {
                  const character = findCharacter(participantId, allCharacters);
                  if (!character) return null;

                  const participantPath = getCharacterPath(participantId);
                  const content = (
                    <figure style={{ margin: 0, textAlign: "center" }}>
                      <img
                        src={
                          character.banner ||
                          character.portrait ||
                          "/assets/images/placeholder.jpg"
                        }
                        alt={character.name}
                        style={{
                          width: 72,
                          height: 72,
                          objectFit: "cover",
                          borderRadius: 12,
                        }}
                      />
                      <figcaption style={{ marginTop: 6 }}>
                        {character.name}
                      </figcaption>
                    </figure>
                  );

                  return participantPath ? (
                    <Link
                      key={participantId}
                      to={participantPath}
                      style={{ textDecoration: "none", color: "inherit" }}
                    >
                      {content}
                    </Link>
                  ) : (
                    <div key={participantId}>{content}</div>
                  );
                })}
              </div>
            </div>
          )}

          {/* Главы */}
          {session.chapters?.length > 0 && (
            <div style={{ marginTop: 24 }}>
              <h2 style={{ margin: "0 0 16px", fontSize: "1.5rem" }}>
                История приключения
              </h2>
              {session.chapters.map((chapter, idx) => (
                <ChapterBlock
                  key={idx}
                  number={idx + 1}
                  title={chapter.title}
                  text={chapter.content}
                />
              ))}
            </div>
          )}

          <ListBlock title="Ключевые моменты" items={session.keyMoments} />
          <ListBlock title="Решения игроков" items={session.decisions} />
          <ListBlock title="Последствия" items={session.consequences} />
        </div>

        <aside>
          <InfoCard title="MVP сессии" value={session.mvp} />
          <InfoCard title="Лучшая цитата" value={`"${session.bestQuote}"`} />
          <ListBlock title="Полученный опыт и лут" items={session.rewards} />
        </aside>
      </section>

      <section
        style={{
          padding: 24,
          display: "flex",
          justifyContent: "space-between",
        }}
      >
        {prev ? (
          <Link
            to={`/chronicles/sessions/${prev.id}`}
            style={{
              textDecoration: "none",
              color: "#fff",
              background: "#1f2a44",
              padding: "8px 12px",
              borderRadius: 8,
            }}
          >
            Предыдущая сессия
          </Link>
        ) : (
          <span />
        )}
        {next ? (
          <Link
            to={`/chronicles/sessions/${next.id}`}
            style={{
              textDecoration: "none",
              color: "#fff",
              background: "#1f2a44",
              padding: "8px 12px",
              borderRadius: 8,
            }}
          >
            Следующая сессия
          </Link>
        ) : (
          <span />
        )}
      </section>
    </main>
  );
}

function Block({ title, text }) {
  if (!text) return null;
  return (
    <div style={{ marginTop: 16 }}>
      <h3 style={{ margin: "0 0 8px" }}>{title}</h3>
      <p style={{ margin: 0, lineHeight: 1.7 }}>{parseTextWithLinks(text)}</p>
    </div>
  );
}

function ChapterBlock({ number, title, text }) {
  if (!text) return null;
  return (
    <div
      style={{
        marginTop: 20,
        padding: 16,
        background: "rgba(255,255,255,0.03)",
        borderRadius: 12,
        border: "1px solid rgba(255,255,255,0.08)",
      }}
    >
      <h3
        style={{
          margin: "0 0 12px",
          color: "#d4af37",
          fontSize: "1.1rem",
          display: "flex",
          alignItems: "center",
          gap: 8,
        }}
      >
        <span
          style={{
            display: "inline-flex",
            alignItems: "center",
            justifyContent: "center",
            width: 28,
            height: 28,
            borderRadius: "50%",
            background: "rgba(212, 175, 55, 0.2)",
            fontSize: "0.9rem",
          }}
        >
          {number}
        </span>
        {title}
      </h3>
      <p style={{ margin: 0, lineHeight: 1.7 }}>{parseTextWithLinks(text)}</p>
    </div>
  );
}

function parseTextWithLinks(text) {
  if (!text) return text;

  const linkRegex = /\[([^\]]+)\]\(([^)]+)\)/g;
  const parts = [];
  let lastIndex = 0;
  let match;
  let keyCounter = 0;

  while ((match = linkRegex.exec(text)) !== null) {
    if (match.index > lastIndex) {
      parts.push(text.substring(lastIndex, match.index));
    }

    const linkText = match[1];
    const linkPath = match[2];
    parts.push(
      <Link
        key={`link-${keyCounter++}`}
        to={linkPath}
        style={{ color: "#4da3ff", textDecoration: "none", fontWeight: 500 }}
      >
        {linkText}
      </Link>,
    );

    lastIndex = match.index + match[0].length;
  }

  if (lastIndex < text.length) {
    parts.push(text.substring(lastIndex));
  }

  return parts.length > 0 ? parts : text;
}

function ListBlock({ title, items }) {
  if (!items || items.length === 0) return null;
  return (
    <div style={{ marginTop: 16 }}>
      <h3 style={{ margin: "0 0 8px" }}>{title}</h3>
      <ul
        style={{
          listStyle: "none",
          padding: 0,
          margin: 0,
          display: "grid",
          gap: 6,
        }}
      >
        {items.map((it, idx) => (
          <li
            key={idx}
            style={{ display: "flex", alignItems: "center", gap: 8 }}
          >
            <span
              style={{
                width: 6,
                height: 6,
                borderRadius: 99,
                background: "#d4af37",
                display: "inline-block",
              }}
            />
            <span>{it}</span>
          </li>
        ))}
      </ul>
    </div>
  );
}

function InfoCard({ title, value }) {
  if (!value) return null;
  return (
    <div
      style={{
        background: "#121212",
        border: "1px solid rgba(255,255,255,0.1)",
        borderRadius: 12,
        padding: 12,
        marginBottom: 12,
      }}
    >
      <div style={{ fontWeight: 700, marginBottom: 6 }}>{title}</div>
      <div>{value}</div>
    </div>
  );
}



# MODULE src/pages/Chronicles/AllSessions/SessionsPage.jsx
import React, { useState, useEffect } from "react";
import { Link } from "react-router-dom";

export default function SessionsPage() {
  const [sessions, setSessions] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    async function loadSessions() {
      try {
        setLoading(true);
        const response = await fetch("/data/chronicles/sessions/index.json");
        if (!response.ok) throw new Error("Failed to load sessions");
        const data = await response.json();
        setSessions(data);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    }
    loadSessions();
  }, []);

  if (loading) {
    return (
      <main style={{ padding: 24, textAlign: "center" }}>
        <div>Загрузка сессий...</div>
      </main>
    );
  }

  if (error) {
    return (
      <main style={{ padding: 24 }}>
        <h2>Ошибка загрузки</h2>
        <p>{error}</p>
      </main>
    );
  }

  return (
    <main style={{ padding: 24, display: "grid", gap: 16 }}>
      <h2>Сессии</h2>
      {sessions.map((s) => (
        <Link
          key={s.id}
          to={`/chronicles/sessions/${s.id}`}
          style={{
            textDecoration: "none",
            color: "inherit",
            borderRadius: 12,
            overflow: "hidden",
            border: "1px solid rgba(255,255,255,0.1)",
            background: "#121212",
            display: "block",
          }}
        >
          <div style={{ position: "relative" }}>
            <img
              src={s.heroImage}
              alt={s.title}
              style={{ width: "100%", height: 260, objectFit: "cover" }}
            />
            <div
              style={{
                position: "absolute",
                inset: 0,
                background:
                  "linear-gradient(180deg, rgba(0,0,0,0.0) 35%, rgba(0,0,0,0.7) 100%)",
              }}
            />
            <div
              style={{
                position: "absolute",
                bottom: 12,
                left: 16,
                right: 16,
                display: "flex",
                alignItems: "center",
                justifyContent: "space-between",
              }}
            >
              <div>
                <div style={{ fontSize: 13, opacity: 0.9 }}>
                  {s.realDate} • {s.gameDate} • #{s.num}
                </div>
                <div style={{ fontWeight: 800, fontSize: 22 }}>{s.title}</div>
              </div>
            </div>
          </div>
          <div style={{ padding: 12 }}>
            <div style={{ opacity: 0.9 }}>{s.summary}</div>
          </div>
        </Link>
      ))}
    </main>
  );
}



# MODULE src/pages/Chronicles/index.jsx
import React from "react";
import { Link } from "react-router-dom";

export default function ChroniclesIndex() {
  return (
    <main style={{ padding: 24 }}>
      <h2 style={{ marginBottom: 16 }}>Хроники</h2>
      <div
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fill, minmax(240px, 1fr))",
          gap: 16,
        }}
      >
        {[
          {
            label: "Сессии",
            to: "/chronicles/sessions",
            img: "/assets/images/chronicles/sessions/15_hero.jpg",
          },
          {
            label: "Ключевые события",
            to: "/chronicles/key-events",
            img: "/assets/images/chronicles/events/event_hero.jpg",
          },
          {
            label: "Временная шкала",
            to: "/chronicles/timeline",
            img: "/assets/images/chronicles/timeline/timeline_hero.jpg",
          },
          {
            label: "Цитаты",
            to: "/chronicles/quotes",
            img: "/assets/images/chronicles/quotes/quotes_hero.jpg",
          },
        ].map((x) => (
          <Link
            key={x.to}
            to={x.to}
            style={{
              textDecoration: "none",
              color: "inherit",
              borderRadius: 12,
              overflow: "hidden",
              border: "1px solid rgba(255,255,255,0.1)",
              background: "#121212",
            }}
          >
            <div
              style={{
                height: 140,
                background: `url(${x.img}) center/cover no-repeat`,
              }}
            />
            <div style={{ padding: 12, fontWeight: 700 }}>{x.label}</div>
          </Link>
        ))}
      </div>
    </main>
  );
}



# MODULE src/pages/Chronicles/KeyEvents/KeyEventsPage.jsx
import React, { useState, useEffect } from "react";
import { Link } from "react-router-dom";

export default function KeyEventsPage() {
  const [events, setEvents] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    async function loadEvents() {
      try {
        const indexResponse = await fetch(
          "/data/chronicles/key-events/index.json",
        );
        const index = await indexResponse.json();

        const eventsData = await Promise.all(
          index.map(async (id) => {
            const response = await fetch(
              `/data/chronicles/key-events/${id}.json`,
            );
            return response.json();
          }),
        );

        setEvents(eventsData);
        setLoading(false);
      } catch (err) {
        console.error("Ошибка загрузки событий:", err);
        setError(err.message);
        setLoading(false);
      }
    }

    loadEvents();
  }, []);

  if (loading) {
    return (
      <main style={{ padding: 24, textAlign: "center" }}>
        <div>Загрузка событий...</div>
      </main>
    );
  }

  if (error) {
    return (
      <main style={{ padding: 24 }}>
        <div style={{ color: "#ff4d4d" }}>Ошибка: {error}</div>
      </main>
    );
  }

  if (events.length === 0) {
    return (
      <main style={{ padding: 24 }}>
        <h2>Ключевые события</h2>
        <p>Пока нет ключевых событий</p>
      </main>
    );
  }

  return (
    <main style={{ padding: 24 }}>
      <h2 style={{ marginBottom: 16 }}>Ключевые события</h2>
      <div style={{ display: "grid", gap: 16 }}>
        {events.map((event) => (
          <article
            key={event.id}
            style={{
              background: "#121212",
              border: "1px solid rgba(255,255,255,0.1)",
              borderRadius: 12,
              padding: 16,
            }}
          >
            <h3 style={{ margin: "0 0 8px" }}>{event.title}</h3>
            <div style={{ fontSize: 13, opacity: 0.7, marginBottom: 12 }}>
              {event.date}
            </div>
            <p style={{ margin: 0, lineHeight: 1.6 }}>{event.description}</p>
            {event.relatedSessions?.length > 0 && (
              <div style={{ marginTop: 12 }}>
                <div style={{ fontSize: 13, opacity: 0.8, marginBottom: 6 }}>
                  Связанные сессии:
                </div>
                <div style={{ display: "flex", gap: 8, flexWrap: "wrap" }}>
                  {event.relatedSessions.map((sessionId, idx) => (
                    <Link
                      key={idx}
                      to={`/chronicles/sessions/${sessionId}`}
                      style={{
                        padding: "4px 8px",
                        background: "#1f2a44",
                        border: "1px solid rgba(255,255,255,0.1)",
                        borderRadius: 6,
                        fontSize: 12,
                        textDecoration: "none",
                        color: "inherit",
                      }}
                    >
                      #{sessionId}
                    </Link>
                  ))}
                </div>
              </div>
            )}
          </article>
        ))}
      </div>
    </main>
  );
}



# MODULE src/pages/Chronicles/Quotes/QuotesPage.jsx
import React, { useState, useEffect } from "react";
import { Link } from "react-router-dom";
import { getCharacterPath } from "../../../utils/getCharacterPath";

export default function QuotesPage() {
  const [quotes, setQuotes] = useState([]);
  const [loading, setLoading] = useState(true);
  const [sort, setSort] = useState("all");

  useEffect(() => {
    loadQuotes();
  }, []);

  async function loadQuotes() {
    try {
      const indexResponse = await fetch("/data/chronicles/quotes/index.json");
      const index = await indexResponse.json();

      const quotesPromises = index.quotes.map(async (id) => {
        const response = await fetch(`/data/chronicles/quotes/${id}.json`);
        return response.json();
      });

      const loadedQuotes = await Promise.all(quotesPromises);
      setQuotes(loadedQuotes);
    } catch (error) {
      console.error("Ошибка загрузки цитат:", error);
    } finally {
      setLoading(false);
    }
  }

  const filtered = quotes.filter((q) =>
    sort === "all" ? true : q.type === sort,
  );

  if (loading) {
    return (
      <main style={{ padding: 24 }}>
        <h2>Загрузка цитат...</h2>
      </main>
    );
  }

  return (
    <main style={{ padding: 24 }}>
      <div
        style={{
          display: "flex",
          alignItems: "center",
          justifyContent: "space-between",
          marginBottom: 16,
        }}
      >
        <h2>Цитаты</h2>
        <select
          value={sort}
          onChange={(e) => setSort(e.target.value)}
          style={{
            background: "#121212",
            color: "#fff",
            border: "1px solid rgba(255,255,255,0.1)",
            borderRadius: 8,
            padding: "6px 8px",
          }}
        >
          <option value="all">Все</option>
          <option value="funny">Самые смешные</option>
          <option value="epic">Самые эпичные</option>
          <option value="silly">Самые глупые</option>
        </select>
      </div>

      <div style={{ display: "grid", gap: 16 }}>
        {filtered.map((q) => (
          <div
            key={q.id}
            style={{
              background: "#121212",
              border: "1px solid rgba(255,255,255,0.1)",
              borderRadius: 12,
              padding: 16,
            }}
          >
            <blockquote style={{ margin: 0, fontSize: 20, lineHeight: 1.6 }}>
              "{q.text}"
            </blockquote>
            <div
              style={{
                marginTop: 12,
                display: "flex",
                alignItems: "center",
                gap: 12,
                flexWrap: "wrap",
              }}
            >
              {q.character && (
                <Link
                  to={getCharacterPath(q.character.id)}
                  style={{
                    display: "inline-flex",
                    alignItems: "center",
                    gap: 8,
                    textDecoration: "none",
                    color: "inherit",
                  }}
                >
                  <img
                    src={q.character.portrait}
                    alt={q.character.name}
                    style={{
                      width: 40,
                      height: 40,
                      borderRadius: 8,
                      objectFit: "cover",
                    }}
                  />
                  <strong>{q.character.name}</strong>
                </Link>
              )}
              {q.context && (
                <span style={{ opacity: 0.9 }}>Контекст: {q.context}</span>
              )}
              {q.reaction && (
                <span style={{ opacity: 0.9 }}>Реакция: {q.reaction}</span>
              )}
            </div>
          </div>
        ))}
      </div>
    </main>
  );
}



# MODULE src/pages/Chronicles/Timeline/TimelinePage.jsx
import React, { useState, useEffect } from "react";
import { Link } from "react-router-dom";
import { getCharacterPath } from "../../../utils/getCharacterPath";

export default function TimelinePage() {
  const [events, setEvents] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadTimeline();
  }, []);

  async function loadTimeline() {
    try {
      const indexResponse = await fetch("/data/chronicles/timeline/index.json");
      const index = await indexResponse.json();

      const eventsPromises = index.events.map(async (id) => {
        const response = await fetch(`/data/chronicles/timeline/${id}.json`);
        return response.json();
      });

      const loadedEvents = await Promise.all(eventsPromises);

      loadedEvents.sort((a, b) => {
        const dateA = new Date(a.date);
        const dateB = new Date(b.date);
        return dateA - dateB;
      });

      setEvents(loadedEvents);
    } catch (error) {
      console.error("Ошибка загрузки временной шкалы:", error);
    } finally {
      setLoading(false);
    }
  }

  if (loading) {
    return (
      <main style={{ padding: 24 }}>
        <h2>Загрузка временной шкалы...</h2>
      </main>
    );
  }

  return (
    <main style={{ padding: 24, maxWidth: 1200, margin: "0 auto" }}>
      <h2 style={{ marginBottom: 32, textAlign: "center" }}>
        Временная шкала событий
      </h2>

      <div style={{ position: "relative", paddingLeft: 40 }}>
        <div
          style={{
            position: "absolute",
            left: 20,
            top: 0,
            bottom: 0,
            width: 2,
            background: "rgba(212, 175, 55, 0.3)",
          }}
        />

        {events.map((event, index) => (
          <TimelineEvent key={event.id} event={event} index={index} />
        ))}
      </div>
    </main>
  );
}

function TimelineEvent({ event, index }) {
  const isLeft = index % 2 === 0;

  return (
    <div
      style={{
        position: "relative",
        marginBottom: 48,
        paddingLeft: isLeft ? 0 : 60,
        paddingRight: isLeft ? 60 : 0,
      }}
    >
      <div
        style={{
          position: "absolute",
          left: 11,
          top: 0,
          width: 18,
          height: 18,
          borderRadius: "50%",
          background: "#d4af37",
          border: "3px solid #0a0a0a",
          zIndex: 1,
        }}
      />

      <div
        style={{
          background: "#121212",
          border: "1px solid rgba(212, 175, 55, 0.3)",
          borderRadius: 12,
          padding: 20,
          position: "relative",
        }}
      >
        <div
          style={{
            position: "absolute",
            top: -12,
            left: 16,
            background: "#d4af37",
            color: "#0a0a0a",
            padding: "4px 12px",
            borderRadius: 6,
            fontSize: 13,
            fontWeight: 700,
          }}
        >
          {formatDate(event.date)}
        </div>

        <h3
          style={{
            margin: "12px 0 8px",
            fontSize: 20,
            color: "#d4af37",
          }}
        >
          {event.title}
        </h3>

        {event.description && (
          <p
            style={{
              margin: "0 0 12px",
              lineHeight: 1.6,
              opacity: 0.9,
            }}
          >
            {event.description}
          </p>
        )}

        <div
          style={{
            display: "flex",
            gap: 12,
            flexWrap: "wrap",
            marginTop: 12,
          }}
        >
          {event.relatedSession && (
            <Link
              to={`/chronicles/sessions/${event.relatedSession}`}
              style={{
                padding: "6px 12px",
                background: "rgba(77, 163, 255, 0.2)",
                border: "1px solid rgba(77, 163, 255, 0.4)",
                borderRadius: 6,
                textDecoration: "none",
                color: "#4da3ff",
                fontSize: 13,
              }}
            >
              📖 Связанная сессия
            </Link>
          )}

          {event.relatedCharacters?.map((charId) => (
            <Link
              key={charId}
              to={getCharacterPath(charId)}
              style={{
                padding: "6px 12px",
                background: "rgba(212, 175, 55, 0.2)",
                border: "1px solid rgba(212, 175, 55, 0.4)",
                borderRadius: 6,
                textDecoration: "none",
                color: "#d4af37",
                fontSize: 13,
              }}
            >
              👤 Персонаж
            </Link>
          ))}

          {event.relatedLocation && (
            <Link
              to={getCityPath(event.relatedLocation)}
              style={{
                padding: "6px 12px",
                background: "rgba(155, 89, 182, 0.2)",
                border: "1px solid rgba(155, 89, 182, 0.4)",
                borderRadius: 6,
                textDecoration: "none",
                color: "#9b59b6",
                fontSize: 13,
              }}
            >
              📍 Локация
            </Link>
          )}
        </div>

        {event.type && (
          <div
            style={{
              position: "absolute",
              top: 16,
              right: 16,
              padding: "4px 8px",
              background: getEventTypeColor(event.type),
              borderRadius: 6,
              fontSize: 11,
              textTransform: "uppercase",
              fontWeight: 700,
              letterSpacing: "0.5px",
            }}
          >
            {getEventTypeName(event.type)}
          </div>
        )}
      </div>
    </div>
  );
}

function formatDate(dateStr) {
  const date = new Date(dateStr);
  return date.toLocaleDateString("ru-RU", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });
}

function getCityPath(id) {
  if (!id) return "#";
  return `/world/cities/${id}`;
}

function getEventTypeColor(type) {
  const colors = {
    battle: "rgba(231, 76, 60, 0.3)",
    discovery: "rgba(52, 152, 219, 0.3)",
    political: "rgba(155, 89, 182, 0.3)",
    personal: "rgba(46, 204, 113, 0.3)",
    death: "rgba(52, 73, 94, 0.3)",
    birth: "rgba(241, 196, 15, 0.3)",
  };
  return colors[type] || "rgba(149, 165, 166, 0.3)";
}

function getEventTypeName(type) {
  const names = {
    battle: "Битва",
    discovery: "Открытие",
    political: "Политика",
    personal: "Личное",
    death: "Смерть",
    birth: "Рождение",
  };
  return names[type] || "Событие";
}



# MODULE src/pages/Home/HomePage.jsx
import React from "react";
import { Link, useNavigate } from "react-router-dom";
import Hero from "../../components/common/Hero/Hero.jsx";
import styles from "./HomePage.module.css";

export default function HomePage() {
  const navigate = useNavigate();
  return (
    <>
      <Hero
        title="Приветствую вас, Говнари!"
        subtitle="Хроники мира меча и магии. Легенды героев, тайны древних богов и города под звездами."
        height={600}
        backgroundImage="/assets/hero.jpg"
        ctaLabel="Начать путешествие"
        onCta={() => navigate("/chronicles/sessions")}
      />

      <main>
        <section className="section">
          <h2 className="section-title">Последние события</h2>
          <div className="grid-3">
            {[1, 2, 3].map((i) => (
              <article className={`card ${styles.eventCard}`} key={i}>
                <div className={styles.eventImage} />
                <div className={styles.eventBody}>
                  <h3 className={styles.eventTitle}>Битва у Старого моста</h3>
                  <div className={styles.eventDate}>12 Марта, 1492 DR</div>
                  <p className={styles.eventDesc}>
                    Короткое описание произошедшего. Без деталей и данных,
                    только макет текста на две строки.
                  </p>
                </div>
              </article>
            ))}
          </div>
        </section>

        <section className={styles.quickLinksSection}>
          <div className="container">
            <div className={styles.quickGrid}>
              {[
                {
                  title: "Персонажи",
                  desc: "Герои и их истории",
                  path: "/characters",
                },
                {
                  title: "Мир",
                  desc: "Города, локации, легенды",
                  path: "/world",
                },
                {
                  title: "Хроники",
                  desc: "Сессии и ключевые события",
                  path: "/chronicles",
                },
                {
                  title: "Знания",
                  desc: "Боги, фракции, история",
                  path: "/lore",
                },
              ].map((x) => (
                <Link to={x.path} className={styles.quickItem} key={x.title}>
                  <div className={styles.quickIcon}>⚜</div>
                  <div className={styles.quickTitle}>{x.title}</div>
                  <div className={styles.quickDesc}>{x.desc}</div>
                </Link>
              ))}
            </div>
          </div>
        </section>
      </main>
    </>
  );
}



# MODULE src/pages/Lore/Fractions/FractionDetail.jsx
import React, { useState, useEffect } from "react";
import { useParams, Link } from "react-router-dom";

export default function FractionDetail() {
  const { id } = useParams();
  const [fraction, setFraction] = useState(null);
  const [members, setMembers] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    async function loadData() {
      try {
        setLoading(true);

        // Загружаем данные фракции
        const fractionResponse = await fetch("/data/lore/fractions.json");
        if (!fractionResponse.ok) {
          throw new Error("Не удалось загрузить данные фракций");
        }
        const fractionsData = await fractionResponse.json();
        const currentFraction = fractionsData.find((f) => f.id === id);

        if (!currentFraction) {
          throw new Error("Фракция не найдена");
        }

        setFraction(currentFraction);

        // Загружаем данные персонажей для поиска членов фракции
        const [pcResponse, npcResponse, alliesResponse] = await Promise.all([
          fetch("/data/characters/playerCharacters.json"),
          fetch("/data/characters/npcs.json"),
          fetch("/data/characters/allies.json"),
        ]);

        const [playerCharacters, npcs, allies] = await Promise.all([
          pcResponse.json(),
          npcResponse.json(),
          alliesResponse.json(),
        ]);

        // Находим всех персонажей, связанных с этой фракцией
        const allMembers = [
          ...playerCharacters.filter((pc) =>
            pc.fractions?.some((f) => f.id === id),
          ),
          ...npcs.filter((npc) => npc.fractions?.some((f) => f.id === id)),
          ...allies.filter((ally) => ally.fractions?.some((f) => f.id === id)),
        ];

        setMembers(allMembers);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    }

    loadData();
  }, [id]);

  if (loading) {
    return (
      <main style={{ padding: 24, textAlign: "center" }}>
        <div>Загрузка данных фракции...</div>
      </main>
    );
  }

  if (error) {
    return (
      <main style={{ padding: 24 }}>
        <div style={{ color: "#ff4d4d", marginBottom: 16 }}>
          Ошибка: {error}
        </div>
        <Link
          to="/lore/fractions"
          style={{ color: "#4da3ff", textDecoration: "none" }}
        >
          ← Назад ко всем фракциям
        </Link>
      </main>
    );
  }

  if (!fraction) {
    return (
      <main style={{ padding: 24 }}>
        <h2 style={{ marginBottom: 12 }}>Фракция не найдена</h2>
        <Link to="/lore/fractions" style={{ color: "#4da3ff" }}>
          Назад к фракциям
        </Link>
      </main>
    );
  }

  return (
    <main style={{ padding: 24 }}>
      <div style={{ marginBottom: 24 }}>
        <Link
          to="/lore/fractions"
          style={{ color: "#4da3ff", textDecoration: "none" }}
        >
          ← Назад ко всем фракциям
        </Link>
      </div>
      <h1 style={{ marginBottom: 12 }}>{fraction.name}</h1>
      {fraction.symbol && (
        <img
          src={fraction.symbol}
          alt={fraction.name}
          style={{
            width: 64,
            height: 64,
            objectFit: "contain",
            marginBottom: 16,
          }}
        />
      )}
      {fraction.description ? (
        <div style={{ maxWidth: 800, lineHeight: 1.7, marginBottom: 24 }}>
          {parseTextWithLinks(fraction.description)}
        </div>
      ) : null}
      {members.length > 0 && (
        <div style={{ marginTop: 32 }}>
          <h3 style={{ marginBottom: 16 }}>Члены фракции</h3>
          <div
            style={{
              display: "grid",
              gridTemplateColumns: "repeat(auto-fill, minmax(200px, 1fr))",
              gap: 16,
            }}
          >
            {members.map((char) => {
              let charPath = "";
              if (char.id.startsWith("pc-")) {
                charPath = `/characters/players/${char.id}`;
              } else if (char.id.startsWith("npc-")) {
                charPath = `/characters/npcs/${char.id}`;
              } else if (char.id.startsWith("ally-")) {
                charPath = `/characters/allies/${char.id}`;
              }
              return charPath ? (
                <Link
                  key={char.id}
                  to={charPath}
                  style={{
                    textDecoration: "none",
                    color: "inherit",
                    background: "#121212",
                    border: "1px solid rgba(255,255,255,0.1)",
                    borderRadius: 12,
                    padding: 16,
                    display: "block",
                  }}
                >
                  <div style={{ fontWeight: 700 }}>{char.name}</div>
                  <div style={{ opacity: 0.8, fontSize: 14, marginTop: 4 }}>
                    {char.class || char.role}
                  </div>
                </Link>
              ) : (
                <div
                  key={char.id}
                  style={{
                    background: "#121212",
                    border: "1px solid rgba(255,255,255,0.1)",
                    borderRadius: 12,
                    padding: 16,
                  }}
                >
                  <div style={{ fontWeight: 700 }}>{char.name}</div>
                  <div style={{ opacity: 0.8, fontSize: 14, marginTop: 4 }}>
                    {char.class || char.role}
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      )}
    </main>
  );
}

function parseTextWithLinks(text) {
  if (!text) return text;

  const linkRegex = /\[([^\]]+)\]\(([^)]+)\)/g;
  const parts = [];
  let lastIndex = 0;
  let match;
  let keyCounter = 0;

  while ((match = linkRegex.exec(text)) !== null) {
    if (match.index > lastIndex) {
      parts.push(text.substring(lastIndex, match.index));
    }

    const linkText = match[1];
    const linkPath = match[2];
    parts.push(
      <Link
        key={`link-${keyCounter++}`}
        to={linkPath}
        style={{ color: "#4da3ff", textDecoration: "none", fontWeight: 500 }}
      >
        {linkText}
      </Link>,
    );

    lastIndex = match.index + match[0].length;
  }

  if (lastIndex < text.length) {
    parts.push(text.substring(lastIndex));
  }

  return parts.length > 0 ? parts : text;
}



# MODULE src/pages/Lore/Fractions/FractionsPage.jsx
import React, { useState, useEffect } from "react";
import { Link } from "react-router-dom";

export default function FractionsPage() {
  const [fractions, setFractions] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    async function loadFractions() {
      try {
        setLoading(true);
        const response = await fetch("/data/lore/fractions.json");
        if (!response.ok) {
          throw new Error("Не удалось загрузить фракции");
        }
        const data = await response.json();
        setFractions(data);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    }

    loadFractions();
  }, []);

  if (loading) {
    return (
      <main style={{ padding: 24, textAlign: "center" }}>
        <div>Загрузка фракций...</div>
      </main>
    );
  }

  if (error) {
    return (
      <main style={{ padding: 24 }}>
        <div style={{ color: "#ff4d4d" }}>Ошибка: {error}</div>
        <Link
          to="/lore"
          style={{ color: "#4da3ff", marginTop: 16, display: "inline-block" }}
        >
          Вернуться к разделу "Знания"
        </Link>
      </main>
    );
  }

  return (
    <main style={{ padding: 24 }}>
      <h2 style={{ marginBottom: 16 }}>Фракции</h2>
      <div
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fill, minmax(240px, 1fr))",
          gap: 16,
        }}
      >
        {fractions.map((fraction) => (
          <Link
            key={fraction.id}
            to={`/lore/fractions/${fraction.id}`}
            style={{
              textDecoration: "none",
              color: "inherit",
              borderRadius: 12,
              overflow: "hidden",
              border: "1px solid rgba(255,255,255,0.1)",
              background: "#121212",
              padding: 16,
              display: "flex",
              flexDirection: "column",
              gap: 8,
              minHeight: 140,
            }}
          >
            <div style={{ fontWeight: 700, fontSize: 18 }}>{fraction.name}</div>
            {fraction.description ? (
              <div style={{ opacity: 0.8, fontSize: 14 }}>
                {fraction.description}
              </div>
            ) : null}
          </Link>
        ))}
      </div>
    </main>
  );
}



# MODULE src/pages/Lore/Gods/GodDetail.jsx
import React, { useState, useEffect } from "react";
import { useParams, Link } from "react-router-dom";

export default function GodDetail() {
  const { id } = useParams();
  const [god, setGod] = useState(null);
  const [worshippers, setWorshippers] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    async function loadData() {
      try {
        setLoading(true);

        // Загружаем данные бога
        const godsResponse = await fetch("/data/lore/gods.json");
        if (!godsResponse.ok) {
          throw new Error("Не удалось загрузить данные богов");
        }
        const godsData = await godsResponse.json();
        const currentGod = godsData.find((g) => g.id === id);

        if (!currentGod) {
          throw new Error("Бог не найден");
        }

        setGod(currentGod);

        // Загружаем данные персонажей для поиска поклонников
        const [pcResponse, npcResponse] = await Promise.all([
          fetch("/data/characters/playerCharacters.json"),
          fetch("/data/characters/npcs.json"),
        ]);

        const [playerCharacters, npcs] = await Promise.all([
          pcResponse.json(),
          npcResponse.json(),
        ]);

        // Находим персонажей, поклоняющихся этому богу
        const allWorshippers = [
          ...playerCharacters.filter((pc) =>
            pc.biography?.toLowerCase().includes(currentGod.name.toLowerCase()),
          ),
          ...npcs.filter((npc) =>
            npc.biography
              ?.toLowerCase()
              .includes(currentGod.name.toLowerCase()),
          ),
        ];

        setWorshippers(allWorshippers);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    }

    loadData();
  }, [id]);

  if (loading) {
    return (
      <main style={{ padding: 24, textAlign: "center" }}>
        <div>Загрузка данных бога...</div>
      </main>
    );
  }

  if (error) {
    return (
      <main style={{ padding: 24 }}>
        <div style={{ color: "#ff4d4d", marginBottom: 16 }}>
          Ошибка: {error}
        </div>
        <Link
          to="/lore/gods"
          style={{ color: "#4da3ff", textDecoration: "none" }}
        >
          ← Назад к богам
        </Link>
      </main>
    );
  }

  if (!god) {
    return (
      <main style={{ padding: 24 }}>
        <h2 style={{ marginBottom: 12 }}>Бог не найден</h2>
        <Link to="/lore/gods" style={{ color: "#4da3ff" }}>
          Назад к богам
        </Link>
      </main>
    );
  }

  return (
    <main style={{ padding: 24 }}>
      <div style={{ marginBottom: 24, marginLeft: -40 }}>
        <Link
          to="/lore/gods"
          style={{ color: "#4da3ff", textDecoration: "none" }}
        >
          ← Назад к богам
        </Link>
      </div>
      <h1 style={{ marginBottom: 10, marginLeft: 5 }}>{god.name}</h1>
      {god.domain && (
        <div style={{ opacity: 0.8, marginBottom: 16, marginLeft: 15 }}>
          {god.domain}
        </div>
      )}
      {god.description && (
        <div style={{ lineHeight: 1.7, marginBottom: 24 }}>
          {god.banner && (
            <img
              src={god.banner}
              alt={god.name}
              style={{
                float: "right",
                width: "300px",
                maxWidth: "40%",
                minHeight: "300px",
                height: "auto",
                objectFit: "cover",
                borderRadius: 12,
                marginLeft: 24,
                marginBottom: 16,
              }}
            />
          )}
          {god.description.split("\n").map((para, idx) => (
            <p
              key={idx}
              style={{
                margin: idx > 0 ? "16px 0 0" : 0,
                textIndent: "2em",
                textAlign: "justify",
              }}
            >
              {parseTextWithLinks(para.trim())}
            </p>
          ))}
        </div>
      )}

      {worshippers.length > 0 && (
        <div style={{ marginTop: 32 }}>
          <h3 style={{ marginBottom: 16, marginLeft: 5 }}>Поклонники</h3>
          <div
            style={{
              display: "grid",
              gridTemplateColumns: "repeat(auto-fill, minmax(200px, 1fr))",
              gap: 16,
            }}
          >
            {worshippers.map((char) => {
              const charPath = char.id.startsWith("pc-")
                ? `/characters/players/${char.id}`
                : `/characters/npcs/${char.id}`;
              return (
                <Link
                  key={char.id}
                  to={charPath}
                  style={{
                    textDecoration: "none",
                    color: "inherit",
                    background: "#121212",
                    border: "1px solid rgba(255,255,255,0.1)",
                    borderRadius: 12,
                    padding: 16,
                    display: "block",
                  }}
                >
                  <div style={{ fontWeight: 700 }}>{char.name}</div>
                  <div style={{ opacity: 0.8, fontSize: 14, marginTop: 4 }}>
                    {char.class || char.role}
                  </div>
                </Link>
              );
            })}
          </div>
        </div>
      )}
    </main>
  );
}

function parseTextWithLinks(text) {
  if (!text) return text;

  const linkRegex = /\[([^\]]+)\]\(([^)]+)\)/g;
  const parts = [];
  let lastIndex = 0;
  let match;
  let keyCounter = 0;

  while ((match = linkRegex.exec(text)) !== null) {
    if (match.index > lastIndex) {
      parts.push(text.substring(lastIndex, match.index));
    }

    const linkText = match[1];
    const linkPath = match[2];
    parts.push(
      <Link
        key={`link-${keyCounter++}`}
        to={linkPath}
        style={{ color: "#4da3ff", textDecoration: "none", fontWeight: 500 }}
      >
        {linkText}
      </Link>,
    );

    lastIndex = match.index + match[0].length;
  }

  if (lastIndex < text.length) {
    parts.push(text.substring(lastIndex));
  }

  return parts.length > 0 ? parts : text;
}



# MODULE src/pages/Lore/Gods/GodsPage.jsx
import React, { useState, useEffect } from "react";
import { Link } from "react-router-dom";

export default function GodsPage() {
  const [gods, setGods] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    async function loadGods() {
      try {
        setLoading(true);
        const response = await fetch("/data/lore/gods.json");
        if (!response.ok) {
          throw new Error("Не удалось загрузить богов");
        }
        const data = await response.json();
        setGods(data);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    }

    loadGods();
  }, []);

  if (loading) {
    return (
      <main style={{ padding: "24px", textAlign: "center" }}>
        <div>Загрузка богов...</div>
      </main>
    );
  }

  if (error) {
    return (
      <main style={{ padding: "24px" }}>
        <div style={{ color: "#ff4d4d" }}>Ошибка: {error}</div>
        <Link
          to="/lore"
          style={{ color: "#4da3ff", marginTop: 16, display: "inline-block" }}
        >
          Вернуться к разделу "Знания"
        </Link>
      </main>
    );
  }

  return (
    <main style={{ padding: "24px" }}>
      <h2 style={{ marginBottom: "16px" }}>Боги</h2>
      <div
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fill, minmax(240px, 1fr))",
          gap: "16px",
        }}
      >
        {gods.map((gd) => (
          <Link
            key={gd.id}
            to={`/lore/gods/${gd.id}`}
            style={{
              textDecoration: "none",
              color: "inherit",
              borderRadius: 12,
              overflow: "hidden",
              border: "1px solid rgba(255,255,255,0.1)",
              background: "#121212",
            }}
          >
            <div
              style={{
                position: "relative",
                height: 160,
                background: `url(${gd.banner}) center/cover no-repeat`,
                filter: "saturate(0.9)",
              }}
            >
              <div
                style={{
                  position: "absolute",
                  inset: 0,
                  background:
                    "linear-gradient(180deg, rgba(0,0,0,0.0) 30%, rgba(0,0,0,0.7) 100%)",
                }}
              />
              <div style={{ position: "absolute", bottom: 8, left: 12 }}>
                <div style={{ fontWeight: 700, fontSize: 18 }}>{gd.name}</div>
              </div>
            </div>
            <div
              style={{
                padding: 12,
                display: "flex",
                gap: 8,
                alignItems: "center",
              }}
            >
              <img
                src={gd.symbol}
                alt="symbol"
                style={{
                  width: 24,
                  height: 24,
                  objectFit: "contain",
                  opacity: 0.9,
                }}
              />
              <em style={{ opacity: 0.8, fontSize: 13 }}>"{gd.quote}"</em>
            </div>
          </Link>
        ))}
      </div>
    </main>
  );
}



# MODULE src/pages/Lore/History/HistoryPage.jsx
import React, { useState, useEffect } from "react";
import { Link } from "react-router-dom";

export default function HistoryPage() {
  const [historyItems, setHistoryItems] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    async function loadHistory() {
      try {
        setLoading(true);
        const response = await fetch("/data/lore/history.json");
        if (!response.ok) {
          throw new Error("Не удалось загрузить историю");
        }
        const data = await response.json();
        setHistoryItems(data);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    }

    loadHistory();
  }, []);

  if (loading) {
    return (
      <main style={{ padding: 24, textAlign: "center" }}>
        <div>Загрузка исторических записей...</div>
      </main>
    );
  }

  if (error) {
    return (
      <main style={{ padding: 24 }}>
        <div style={{ color: "#ff4d4d", marginBottom: 16 }}>
          Ошибка: {error}
        </div>
        <Link to="/lore" style={{ color: "#4da3ff", textDecoration: "none" }}>
          ← Вернуться к разделу "Знания"
        </Link>
      </main>
    );
  }

  if (historyItems.length === 0) {
    return (
      <main style={{ padding: 24 }}>
        <h2 style={{ marginBottom: 16 }}>История</h2>
        <div
          style={{
            padding: 32,
            textAlign: "center",
            background: "rgba(255,255,255,0.03)",
            borderRadius: 12,
            border: "1px solid rgba(255,255,255,0.08)",
          }}
        >
          <div style={{ fontSize: 48, marginBottom: 16, opacity: 0.5 }}>📜</div>
          <p style={{ opacity: 0.7 }}>
            Исторические записи ещё не добавлены в базу данных.
          </p>
          <Link
            to="/lore"
            style={{
              color: "#4da3ff",
              textDecoration: "none",
              marginTop: 16,
              display: "inline-block",
            }}
          >
            ← Вернуться к разделу "Знания"
          </Link>
        </div>
      </main>
    );
  }

  return (
    <main style={{ padding: 24 }}>
      <h2 style={{ marginBottom: 16 }}>История</h2>
      <p
        style={{
          marginBottom: 24,
          maxWidth: 720,
          lineHeight: 1.6,
          opacity: 0.9,
        }}
      >
        Хроники прошлого, события, изменившие мир, и забытые истории древних
        цивилизаций.
      </p>

      <div style={{ display: "grid", gap: 24 }}>
        {historyItems.map((item) => (
          <article
            key={item.id}
            style={{
              background: "#121212",
              border: "1px solid rgba(255,255,255,0.1)",
              borderRadius: 12,
              overflow: "hidden",
              display: "grid",
              gridTemplateColumns: item.image ? "300px 1fr" : "1fr",
              transition: "border-color 0.2s",
            }}
            onMouseEnter={(e) => {
              e.currentTarget.style.borderColor = "rgba(255,255,255,0.3)";
            }}
            onMouseLeave={(e) => {
              e.currentTarget.style.borderColor = "rgba(255,255,255,0.1)";
            }}
          >
            {item.image && (
              <div
                style={{
                  background: `url(${item.image}) center/cover no-repeat`,
                  minHeight: 200,
                }}
              />
            )}
            <div style={{ padding: 24 }}>
              <div
                style={{
                  fontSize: 14,
                  color: "#d4af37",
                  marginBottom: 8,
                  fontWeight: 600,
                }}
              >
                {item.period}
              </div>
              <h3
                style={{
                  margin: "0 0 12px",
                  fontSize: 24,
                  color: "#fff",
                }}
              >
                {item.title}
              </h3>
              <p
                style={{
                  margin: 0,
                  lineHeight: 1.7,
                  opacity: 0.9,
                }}
              >
                {parseTextWithLinks(item.description)}
              </p>
            </div>
          </article>
        ))}
      </div>
    </main>
  );
}

function parseTextWithLinks(text) {
  if (!text) return text;

  const linkRegex = /\[([^\]]+)\]\(([^)]+)\)/g;
  const parts = [];
  let lastIndex = 0;
  let match;
  let keyCounter = 0;

  while ((match = linkRegex.exec(text)) !== null) {
    if (match.index > lastIndex) {
      parts.push(text.substring(lastIndex, match.index));
    }

    const linkText = match[1];
    const linkPath = match[2];
    parts.push(
      <Link
        key={`link-${keyCounter++}`}
        to={linkPath}
        style={{ color: "#4da3ff", textDecoration: "none", fontWeight: 500 }}
      >
        {linkText}
      </Link>,
    );

    lastIndex = match.index + match[0].length;
  }

  if (lastIndex < text.length) {
    parts.push(text.substring(lastIndex));
  }

  return parts.length > 0 ? parts : text;
}



# MODULE src/pages/Lore/index.jsx
import React from "react";
import { Link } from "react-router-dom";

export default function LoreIndex() {
  return (
    <main style={{ padding: 24 }}>
      <h2 style={{ marginBottom: 16 }}>Знания</h2>
      <div
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fill, minmax(240px, 1fr))",
          gap: 16,
        }}
      >
        {[
          {
            label: "Фракции",
            to: "/lore/fractions",
            img: "/assets/images/lore/fractions/fraction_hero.jpg",
          },
          {
            label: "Боги",
            to: "/lore/gods",
            img: "/assets/images/lore/gods/god_hero.jpg",
          },
          {
            label: "История",
            to: "/lore/history",
            img: "/assets/images/lore/history/history_hero.jpg",
          },
          {
            label: "Легенды",
            to: "/lore/legends",
            img: "/assets/images/lore/legends/legends_hero.jpg",
          },
        ].map((x) => (
          <Link
            key={x.to}
            to={x.to}
            style={{
              textDecoration: "none",
              color: "inherit",
              borderRadius: 12,
              overflow: "hidden",
              border: "1px solid rgba(255,255,255,0.1)",
              background: "#121212",
            }}
          >
            <div
              style={{
                height: 140,
                background: `url(${x.img}) center/cover no-repeat`,
              }}
            />
            <div style={{ padding: 12, fontWeight: 700 }}>{x.label}</div>
          </Link>
        ))}
      </div>
    </main>
  );
}



# MODULE src/pages/Lore/Legends/LegendsPage.jsx
import React, { useState, useEffect } from "react";
import { Link } from "react-router-dom";

export default function LegendsPage() {
  const [legends, setLegends] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [filter, setFilter] = useState("all");

  useEffect(() => {
    async function loadLegends() {
      try {
        setLoading(true);
        const response = await fetch("/data/lore/legends.json");
        if (!response.ok) {
          throw new Error("Не удалось загрузить легенды");
        }
        const data = await response.json();
        setLegends(data);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    }

    loadLegends();
  }, []);

  if (loading) {
    return (
      <main style={{ padding: 24, textAlign: "center" }}>
        <div>Загрузка легенд...</div>
      </main>
    );
  }

  if (error) {
    return (
      <main style={{ padding: 24 }}>
        <div style={{ color: "#ff4d4d", marginBottom: 16 }}>
          Ошибка: {error}
        </div>
        <Link to="/lore" style={{ color: "#4da3ff", textDecoration: "none" }}>
          ← Вернуться к разделу "Знания"
        </Link>
      </main>
    );
  }

  if (legends.length === 0) {
    return (
      <main style={{ padding: 24 }}>
        <h2 style={{ marginBottom: 16 }}>Легенды</h2>
        <div
          style={{
            padding: 32,
            textAlign: "center",
            background: "rgba(255,255,255,0.03)",
            borderRadius: 12,
            border: "1px solid rgba(255,255,255,0.08)",
          }}
        >
          <div style={{ fontSize: 48, marginBottom: 16, opacity: 0.5 }}>✨</div>
          <p style={{ opacity: 0.7 }}>
            Легенды и мифы ещё не добавлены в базу данных.
          </p>
          <Link
            to="/lore"
            style={{
              color: "#4da3ff",
              textDecoration: "none",
              marginTop: 16,
              display: "inline-block",
            }}
          >
            ← Вернуться к разделу "Знания"
          </Link>
        </div>
      </main>
    );
  }

  // Получаем уникальные типы легенд для фильтра
  const types = ["all", ...new Set(legends.map((l) => l.type).filter(Boolean))];

  // Фильтруем легенды
  const filteredLegends =
    filter === "all" ? legends : legends.filter((l) => l.type === filter);

  return (
    <main style={{ padding: 24 }}>
      <div
        style={{
          display: "flex",
          justifyContent: "space-between",
          alignItems: "center",
          marginBottom: 16,
          flexWrap: "wrap",
          gap: 16,
        }}
      >
        <div>
          <h2 style={{ margin: 0 }}>Легенды</h2>
          <p
            style={{
              marginTop: 8,
              maxWidth: 720,
              lineHeight: 1.6,
              opacity: 0.9,
            }}
          >
            Древние сказания, мифы и предания, передающиеся из поколения в
            поколение.
          </p>
        </div>

        {types.length > 1 && (
          <select
            value={filter}
            onChange={(e) => setFilter(e.target.value)}
            style={{
              background: "#121212",
              color: "#fff",
              border: "1px solid rgba(255,255,255,0.1)",
              borderRadius: 8,
              padding: "8px 12px",
              cursor: "pointer",
            }}
          >
            <option value="all">Все типы</option>
            {types
              .filter((t) => t !== "all")
              .map((type) => (
                <option key={type} value={type}>
                  {type}
                </option>
              ))}
          </select>
        )}
      </div>

      <div
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fill, minmax(320px, 1fr))",
          gap: 16,
        }}
      >
        {filteredLegends.map((legend) => (
          <article
            key={legend.id}
            style={{
              background: "#121212",
              border: "1px solid rgba(255,255,255,0.1)",
              borderRadius: 12,
              overflow: "hidden",
              display: "flex",
              flexDirection: "column",
              transition: "border-color 0.2s",
              cursor: "pointer",
            }}
            onMouseEnter={(e) => {
              e.currentTarget.style.borderColor = "rgba(255,255,255,0.3)";
            }}
            onMouseLeave={(e) => {
              e.currentTarget.style.borderColor = "rgba(255,255,255,0.1)";
            }}
          >
            {legend.image && (
              <div
                style={{
                  height: 180,
                  background: `url(${legend.image}) center/cover no-repeat`,
                  position: "relative",
                }}
              >
                {legend.type && (
                  <div
                    style={{
                      position: "absolute",
                      top: 12,
                      right: 12,
                      padding: "4px 10px",
                      borderRadius: 999,
                      background: "rgba(0,0,0,0.7)",
                      border: "1px solid rgba(212,175,55,0.5)",
                      fontSize: 12,
                      letterSpacing: "0.08em",
                      textTransform: "uppercase",
                      color: "#d4af37",
                    }}
                  >
                    {legend.type}
                  </div>
                )}
              </div>
            )}
            <div
              style={{
                padding: 16,
                flexGrow: 1,
                display: "flex",
                flexDirection: "column",
              }}
            >
              <h3
                style={{
                  margin: "0 0 12px",
                  fontSize: 20,
                  color: "#d4af37",
                }}
              >
                {legend.title}
              </h3>
              <p
                style={{
                  margin: 0,
                  lineHeight: 1.6,
                  opacity: 0.9,
                  flexGrow: 1,
                }}
              >
                {parseTextWithLinks(legend.description)}
              </p>
              {legend.origin && (
                <div
                  style={{
                    marginTop: 12,
                    paddingTop: 12,
                    borderTop: "1px solid rgba(255,255,255,0.08)",
                    fontSize: 13,
                    opacity: 0.7,
                  }}
                >
                  Происхождение: {legend.origin}
                </div>
              )}
            </div>
          </article>
        ))}
      </div>

      {filteredLegends.length === 0 && (
        <div
          style={{
            padding: 32,
            textAlign: "center",
            background: "rgba(255,255,255,0.03)",
            borderRadius: 12,
            border: "1px solid rgba(255,255,255,0.08)",
          }}
        >
          <p style={{ opacity: 0.7 }}>Легенды типа "{filter}" не найдены.</p>
        </div>
      )}
    </main>
  );
}

function parseTextWithLinks(text) {
  if (!text) return text;

  const linkRegex = /\[([^\]]+)\]\(([^)]+)\)/g;
  const parts = [];
  let lastIndex = 0;
  let match;
  let keyCounter = 0;

  while ((match = linkRegex.exec(text)) !== null) {
    if (match.index > lastIndex) {
      parts.push(text.substring(lastIndex, match.index));
    }

    const linkText = match[1];
    const linkPath = match[2];
    parts.push(
      <Link
        key={`link-${keyCounter++}`}
        to={linkPath}
        style={{ color: "#4da3ff", textDecoration: "none", fontWeight: 500 }}
      >
        {linkText}
      </Link>,
    );

    lastIndex = match.index + match[0].length;
  }

  if (lastIndex < text.length) {
    parts.push(text.substring(lastIndex));
  }

  return parts.length > 0 ? parts : text;
}



# MODULE src/pages/Media/Gallery/GalleryPage.jsx
import React from "react";

export default function GalleryPage() {
  return (
    <main>
      <h2>GalleryPage</h2>
    </main>
  );
}



# MODULE src/pages/Media/index.jsx
import React from "react";
import { Link } from "react-router-dom";

export default function MediaIndex() {
  return (
    <main style={{ padding: 24 }}>
      <h2 style={{ marginBottom: 16 }}>Медиа</h2>
      <div
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fill, minmax(240px, 1fr))",
          gap: 16,
        }}
      >
        {[
          {
            label: "Галерея",
            to: "/media/gallery",
            img: "/assets/images/media/gallery_hero.jpg",
          },
          {
            label: "Музыка",
            to: "/media/music",
            img: "/assets/images/media/music_hero.jpg",
          },
        ].map((x) => (
          <Link
            key={x.to}
            to={x.to}
            style={{
              textDecoration: "none",
              color: "inherit",
              borderRadius: 12,
              overflow: "hidden",
              border: "1px solid rgba(255,255,255,0.1)",
              background: "#121212",
            }}
          >
            <div
              style={{
                height: 140,
                background: `url(${x.img}) center/cover no-repeat`,
              }}
            />
            <div style={{ padding: 12, fontWeight: 700 }}>{x.label}</div>
          </Link>
        ))}
      </div>
    </main>
  );
}



# MODULE src/pages/Media/Music/MusicPage.jsx
import React from "react";

export default function MusicPage() {
  return (
    <main>
      <h2>MusicPage</h2>
    </main>
  );
}



# MODULE src/pages/Rules/Homebrew/HomebrewPage.jsx
import React from "react";

export default function HomebrewPage() {
  return (
    <main>
      <h2>HomebrewPage</h2>
    </main>
  );
}



# MODULE src/pages/Rules/index.jsx
import React from "react";
import { Link } from "react-router-dom";

export default function RulesIndex() {
  return (
    <main style={{ padding: 24 }}>
      <h2 style={{ marginBottom: 16 }}>Правила</h2>
      <div
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fill, minmax(240px, 1fr))",
          gap: 16,
        }}
      >
        {[
          {
            label: "Хоумбрю",
            to: "/rules/homebrew",
            img: "/assets/images/rules/homebrew_hero.jpg",
          },
          {
            label: "Механики",
            to: "/rules/mechanics",
            img: "/assets/images/rules/mechanics_hero.jpg",
          },
        ].map((x) => (
          <Link
            key={x.to}
            to={x.to}
            style={{
              textDecoration: "none",
              color: "inherit",
              borderRadius: 12,
              overflow: "hidden",
              border: "1px solid rgba(255,255,255,0.1)",
              background: "#121212",
            }}
          >
            <div
              style={{
                height: 140,
                background: `url(${x.img}) center/cover no-repeat`,
              }}
            />
            <div style={{ padding: 12, fontWeight: 700 }}>{x.label}</div>
          </Link>
        ))}
      </div>
    </main>
  );
}



# MODULE src/pages/Rules/Mechanics/MechanicsPage.jsx
import React from "react";

export default function MechanicsPage() {
  return (
    <main>
      <h2>MechanicsPage</h2>
    </main>
  );
}



# MODULE src/pages/Search/SearchResultsPage.jsx
import React, { useMemo } from "react";
import { Link, useLocation } from "react-router-dom";
import { getDocuments } from "../../search/sources.js";
import { buildSnippet, searchDocuments } from "../../search/index.js";

function useQueryParam(name) {
  const { search } = useLocation();
  return useMemo(
    () => new URLSearchParams(search).get(name) || "",
    [search, name],
  );
}

export default function SearchResultsPage() {
  const q = useQueryParam("q");
  const docs = useMemo(() => getDocuments(), []);
  const results = useMemo(() => searchDocuments(docs, q), [docs, q]);

  return (
    <main className="container" style={{ paddingTop: 24, paddingBottom: 48 }}>
      <h1 style={{ marginBottom: 8 }}>Результаты поиска</h1>
      <div style={{ color: "var(--muted)", marginBottom: 24 }}>
        По запросу “{q}” найдено: {results.length}
      </div>

      {results.map((r) => {
        const snippet = buildSnippet(r.text || r.description || "", q, {
          radius: 90,
        });
        return (
          <article key={r.id} style={{ marginBottom: 24 }}>
            <div style={{ fontSize: 14, color: "#0b57d0" }}>
              <Link to={r.route}>{r.route}</Link>
            </div>
            <h3 style={{ margin: "4px 0" }}>
              <Link to={r.route}>{r.title}</Link>
            </h3>
            <p style={{ margin: 0, color: "var(--text-secondary)" }}>
              {snippet}
            </p>
          </article>
        );
      })}

      {!results.length && (
        <div>Ничего не найдено. Попробуйте изменить запрос.</div>
      )}
    </main>
  );
}



# MODULE src/pages/World/Cities/CitiesPage.jsx
import React from "react";
import { Link } from "react-router-dom";
import { cities } from "../../../data/world/cities";

export default function CitiesPage() {
  return (
    <main style={{ padding: 24 }}>
      <h2 style={{ marginBottom: 16 }}>Города</h2>
      <div
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fill, minmax(280px, 1fr))",
          gap: 16,
        }}
      >
        {cities.map((c) => (
          <Link
            key={c.id}
            to={`/world/cities/${c.id}`}
            style={{
              textDecoration: "none",
              color: "inherit",
              borderRadius: 12,
              overflow: "hidden",
              border: "1px solid rgba(255,255,255,0.1)",
              background: "#121212",
              cursor: "pointer",
              transition: "border-color 0.2s",
            }}
            onMouseEnter={(e) => {
              e.currentTarget.style.borderColor = "rgba(255,255,255,0.3)";
            }}
            onMouseLeave={(e) => {
              e.currentTarget.style.borderColor = "rgba(255,255,255,0.1)";
            }}
          >
            <div
              style={{
                position: "relative",
                height: 160,
                background: `url(${c.panorama}) center/cover no-repeat`,
              }}
            >
              <div
                style={{
                  position: "absolute",
                  inset: 0,
                  background:
                    "linear-gradient(180deg, rgba(0,0,0,0.0) 30%, rgba(0,0,0,0.7) 100%)",
                }}
              />
              <div
                style={{
                  position: "absolute",
                  bottom: 8,
                  left: 12,
                  right: 12,
                  display: "flex",
                  alignItems: "center",
                  gap: 8,
                }}
              >
                <img
                  src={c.flag}
                  alt="flag"
                  style={{ width: 28, height: 28, objectFit: "contain" }}
                />
                <div>
                  <div style={{ fontWeight: 700, fontSize: 18 }}>{c.name}</div>
                  <div style={{ opacity: 0.85, fontSize: 13 }}>{c.motto}</div>
                </div>
              </div>
            </div>
          </Link>
        ))}
      </div>
    </main>
  );
}



# MODULE src/pages/World/Cities/CityDetail.jsx
import React from "react";
import { useParams, Link } from "react-router-dom";
import { cities } from "../../../data/world/cities";
import { playerCharacters } from "../../../data/characters/playerCharacters";
import { npcs } from "../../../data/characters/npcs";
import { allies } from "../../../data/characters/allies";
import { enemies } from "../../../data/characters/enemies";
import { fractions } from "../../../data/lore/fractions";
import { gods } from "../../../data/lore/gods";
import { getCharacterPath } from "../../../utils/getCharacterPath";

export default function CityDetail() {
  const { id } = useParams();
  const city = cities.find((c) => c.id === id) || cities[0];

  // Фильтруем союзников и противников по городу
  const cityAllies = allies.filter((a) => a.city === city.name);
  const cityEnemies = enemies.filter((e) => e.city === city.name);

  return (
    <main style={{ minHeight: "100%" }}>
      {/* Hero Section */}
      <section
        style={{
          position: "relative",
          height: "60vh",
          background: `url(${city.panorama}) center/cover no-repeat`,
        }}
      >
        {/* Флаг в правом верхнем углу */}
        <img
          src={city.flag}
          alt="flag"
          style={{
            position: "absolute",
            top: 24,
            right: 24,
            width: 120,
            height: 80,
            objectFit: "contain",
            background: "rgba(0, 0, 0, 0.5)",
            padding: 12,
            borderRadius: 8,
            backdropFilter: "blur(10px)",
            border: "1px solid rgba(212,175,55,0.3)",
            boxShadow: "0 4px 12px rgba(0,0,0,0.3)",
          }}
        />

        {/* Градиент */}
        <div
          style={{
            position: "absolute",
            inset: 0,
            background:
              "linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.7))",
          }}
        />

        {/* Название города */}
        <div
          style={{
            position: "absolute",
            bottom: 40,
            left: 0,
            right: 0,
            textAlign: "center",
          }}
        >
          <h1
            style={{
              margin: 0,
              fontSize: 56,
              textShadow: "0 2px 8px rgba(0,0,0,0.5)",
            }}
          >
            {city.name}
          </h1>
          <div
            style={{
              fontSize: 20,
              opacity: 0.95,
              marginTop: 8,
              fontStyle: "italic",
            }}
          >
            «{city.motto}»
          </div>
        </div>
      </section>

      {/* Main Content */}
      <div style={{ maxWidth: 1200, margin: "0 auto", padding: "48px 24px" }}>
        {/* Quick Info Cards */}
        <section
          style={{
            display: "grid",
            gridTemplateColumns: "repeat(auto-fit, minmax(200px, 1fr))",
            gap: 16,
            marginBottom: 48,
          }}
        >
          <InfoCard
            label="Население"
            value={city.info.population.toLocaleString()}
          />
          <InfoCard label="Тип правления" value={city.info.ruleType} />
          <InfoCard label="Основной ресурс" value={city.info.mainResource} />
          <InfoCard label="Главная религия" value={city.info.mainReligion} />
        </section>

        {/* Ruler Section */}
        <section
          style={{
            background:
              "linear-gradient(135deg, rgba(212,175,55,0.1), rgba(212,175,55,0.05))",
            border: "1px solid rgba(212,175,55,0.3)",
            borderRadius: 12,
            padding: 24,
            marginBottom: 48,
            display: "flex",
            alignItems: "center",
            gap: 24,
          }}
        >
          <img
            src={city.info.ruler.portrait}
            alt={city.info.ruler.name}
            style={{
              width: 100,
              height: 100,
              borderRadius: 12,
              objectFit: "cover",
              border: "2px solid rgba(212,175,55,0.5)",
            }}
          />
          <div>
            <div style={{ fontSize: 14, opacity: 0.7, marginBottom: 4 }}>
              Правитель
            </div>
            <h2 style={{ margin: 0, fontSize: 28, color: "#d4af37" }}>
              {city.info.ruler.name}
            </h2>
          </div>
        </section>

        {/* History */}
        <TextSection title="История города" text={city.history} />

        {/* Description */}
        <TextSection title="Описание" text={city.description} />

        {/* Map */}
        <section style={{ marginBottom: 48 }}>
          <h2 style={{ fontSize: 32, marginBottom: 16 }}>Карта города</h2>
          <div
            style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 24 }}
          >
            <div>
              <h3 style={{ fontSize: 18, marginBottom: 12, opacity: 0.8 }}>
                Расположение
              </h3>
              <img
                src={city.mapSmall}
                alt="map"
                style={{
                  width: "100%",
                  borderRadius: 12,
                  border: "1px solid rgba(255,255,255,0.1)",
                }}
              />
            </div>
            <div>
              <h3 style={{ fontSize: 18, marginBottom: 12, opacity: 0.8 }}>
                Детальная карта
              </h3>
              <img
                src={city.bigMap}
                alt="city map"
                style={{
                  width: "100%",
                  borderRadius: 12,
                  border: "1px solid rgba(255,255,255,0.1)",
                }}
              />
            </div>
          </div>
        </section>

        {/* Districts */}
        {city.districts && city.districts.length > 0 && (
          <section style={{ marginBottom: 48 }}>
            <h2 style={{ fontSize: 32, marginBottom: 16 }}>Районы города</h2>
            <p style={{ lineHeight: 1.7, marginBottom: 24, opacity: 0.9 }}>
              Город разделён на несколько районов, каждый из которых имеет свою
              уникальную атмосферу и назначение.
            </p>
            <div style={{ display: "grid", gap: 16 }}>
              {city.districts.map((d) => (
                <div
                  key={d.name}
                  style={{
                    background: "#0a0a0a",
                    border: "1px solid rgba(255,255,255,0.1)",
                    borderRadius: 12,
                    padding: 20,
                    display: "flex",
                    gap: 16,
                    alignItems: "flex-start",
                  }}
                >
                  <div
                    style={{
                      background: "rgba(212,175,55,0.15)",
                      padding: 12,
                      borderRadius: 8,
                    }}
                  >
                    <img
                      src={d.icon}
                      alt="icon"
                      style={{ width: 32, height: 32, display: "block" }}
                    />
                  </div>
                  <div style={{ flex: 1 }}>
                    <h3 style={{ margin: "0 0 8px", fontSize: 22 }}>
                      {d.name}
                    </h3>
                    <p style={{ margin: 0, lineHeight: 1.6, opacity: 0.9 }}>
                      {d.description}
                    </p>
                  </div>
                </div>
              ))}
            </div>
          </section>
        )}

        {/* Buildings */}
        <section style={{ marginBottom: 48 }}>
          <h2 style={{ fontSize: 32, marginBottom: 16 }}>Важные здания</h2>
          <p style={{ lineHeight: 1.7, marginBottom: 24, opacity: 0.9 }}>
            Эти здания играют ключевую роль в жизни города и его жителей.
          </p>
          <div
            style={{
              display: "grid",
              gridTemplateColumns: "repeat(auto-fill, minmax(280px, 1fr))",
              gap: 16,
            }}
          >
            {city.buildings.map((b) => (
              <figure
                key={b.name}
                style={{
                  margin: 0,
                  position: "relative",
                  overflow: "hidden",
                  borderRadius: 12,
                }}
              >
                <img
                  src={b.image}
                  alt={b.name}
                  style={{
                    width: "100%",
                    height: 180,
                    objectFit: "cover",
                    display: "block",
                  }}
                />
                <figcaption
                  style={{
                    position: "absolute",
                    bottom: 0,
                    left: 0,
                    right: 0,
                    background:
                      "linear-gradient(to top, rgba(0,0,0,0.9), transparent)",
                    padding: "32px 12px 12px",
                    fontWeight: 600,
                    fontSize: 16,
                  }}
                >
                  {b.name}
                </figcaption>
              </figure>
            ))}
          </div>
        </section>

        {/* Places */}
        {city.places && city.places.length > 0 && (
          <section style={{ marginBottom: 48 }}>
            <h2 style={{ fontSize: 32, marginBottom: 16 }}>Интересные места</h2>
            <p style={{ lineHeight: 1.7, marginBottom: 24, opacity: 0.9 }}>
              Эти локации привлекают внимание путешественников и искателей
              приключений.
            </p>
            <ul
              style={{
                listStyle: "none",
                padding: 0,
                display: "grid",
                gap: 12,
              }}
            >
              {city.places.map((place, idx) => (
                <li
                  key={idx}
                  style={{
                    display: "flex",
                    alignItems: "center",
                    gap: 12,
                    background: "#0a0a0a",
                    padding: 16,
                    borderRadius: 8,
                    border: "1px solid rgba(255,255,255,0.08)",
                  }}
                >
                  <span
                    style={{
                      width: 8,
                      height: 8,
                      borderRadius: 99,
                      background: "#d4af37",
                      flexShrink: 0,
                    }}
                  />
                  <span style={{ fontSize: 16 }}>{place}</span>
                </li>
              ))}
            </ul>
          </section>
        )}

        {/* NPCs, Allies, Enemies */}
        <section style={{ marginBottom: 48 }}>
          <h2 style={{ fontSize: 32, marginBottom: 16 }}>Важные персоны</h2>
          <p style={{ lineHeight: 1.7, marginBottom: 24, opacity: 0.9 }}>
            Эти люди влияют на жизнь города и могут помочь или помешать вашим
            планам.
          </p>

          <div style={{ display: "grid", gap: 32 }}>
            {/* NPCs */}
            {city.npcs && city.npcs.length > 0 && (
              <div>
                <h3
                  style={{ fontSize: 24, marginBottom: 16, color: "#d4af37" }}
                >
                  Важные НПС
                </h3>
                <div
                  style={{
                    display: "grid",
                    gridTemplateColumns:
                      "repeat(auto-fill, minmax(280px, 1fr))",
                    gap: 16,
                  }}
                >
                  {city.npcs.map((n) => (
                    <CharacterCard key={n.id} character={n} type="npc" />
                  ))}
                </div>
              </div>
            )}

            {/* Allies */}
            {cityAllies.length > 0 && (
              <div>
                <h3
                  style={{ fontSize: 24, marginBottom: 16, color: "#4da3ff" }}
                >
                  Союзники
                </h3>
                <div
                  style={{
                    display: "grid",
                    gridTemplateColumns:
                      "repeat(auto-fill, minmax(280px, 1fr))",
                    gap: 16,
                  }}
                >
                  {cityAllies.map((ally) => (
                    <CharacterCard key={ally.id} character={ally} type="ally" />
                  ))}
                </div>
              </div>
            )}

            {/* Enemies */}
            {cityEnemies.length > 0 && (
              <div>
                <h3
                  style={{ fontSize: 24, marginBottom: 16, color: "#ff4d4d" }}
                >
                  Противники
                </h3>
                <div
                  style={{
                    display: "grid",
                    gridTemplateColumns:
                      "repeat(auto-fill, minmax(280px, 1fr))",
                    gap: 16,
                  }}
                >
                  {cityEnemies.map((enemy) => (
                    <CharacterCard
                      key={enemy.id}
                      character={enemy}
                      type="enemy"
                    />
                  ))}
                </div>
              </div>
            )}
          </div>
        </section>

        {/* Quests */}
        {city.quests && city.quests.length > 0 && (
          <section
            style={{
              background:
                "linear-gradient(135deg, rgba(212,175,55,0.1), rgba(212,175,55,0.05))",
              border: "1px solid rgba(212,175,55,0.3)",
              borderRadius: 12,
              padding: 24,
              marginBottom: 48,
              display: "flex",
              alignItems: "center",
              gap: 24,
            }}
          >
            <img
              src={city.info.ruler.portrait}
              alt={city.info.ruler.name}
              style={{
                width: 100,
                height: 100,
                borderRadius: 12,
                objectFit: "cover",
                border: "2px solid rgba(212,175,55,0.5)",
              }}
            />
            <div style={{ flex: 1 }}>
              <div style={{ fontSize: 14, opacity: 0.7, marginBottom: 4 }}>
                Правитель
              </div>
              <h2 style={{ margin: 0, fontSize: 28, color: "#d4af37" }}>
                {city.info.ruler.name}
              </h2>
            </div>

            {/* Кнопка перехода */}
            {city.info.ruler.id &&
              (() => {
                const rulerPath = getCharacterPath(city.info.ruler.id);
                return rulerPath ? (
                  <Link
                    to={rulerPath}
                    style={{
                      padding: "12px 24px",
                      background: "rgba(212,175,55,0.2)",
                      border: "1px solid rgba(212,175,55,0.5)",
                      borderRadius: 8,
                      textDecoration: "none",
                      color: "#d4af37",
                      fontWeight: 600,
                      transition: "all 0.2s",
                      whiteSpace: "nowrap",
                      display: "inline-flex",
                      alignItems: "center",
                      gap: 8,
                    }}
                    onMouseEnter={(e) => {
                      e.currentTarget.style.background = "rgba(212,175,55,0.3)";
                      e.currentTarget.style.borderColor =
                        "rgba(212,175,55,0.7)";
                    }}
                    onMouseLeave={(e) => {
                      e.currentTarget.style.background = "rgba(212,175,55,0.2)";
                      e.currentTarget.style.borderColor =
                        "rgba(212,175,55,0.5)";
                    }}
                  >
                    Подробнее
                    <span style={{ fontSize: 18 }}>→</span>
                  </Link>
                ) : null;
              })()}
          </section>
        )}

        {/* News */}
        {city.news && city.news.length > 0 && (
          <section style={{ marginBottom: 48 }}>
            <h2 style={{ fontSize: 32, marginBottom: 16 }}>Слухи и новости</h2>
            <p style={{ lineHeight: 1.7, marginBottom: 24, opacity: 0.9 }}>
              Последние события и разговоры на улицах города.
            </p>
            <ul
              style={{
                listStyle: "none",
                padding: 0,
                display: "grid",
                gap: 12,
              }}
            >
              {city.news.map((item, idx) => (
                <li
                  key={idx}
                  style={{
                    background: "#0a0a0a",
                    padding: 16,
                    borderRadius: 8,
                    border: "1px solid rgba(255,255,255,0.08)",
                    display: "flex",
                    alignItems: "center",
                    gap: 12,
                  }}
                >
                  <span style={{ fontSize: 20 }}>📰</span>
                  <span style={{ fontSize: 16, lineHeight: 1.6 }}>{item}</span>
                </li>
              ))}
            </ul>
          </section>
        )}
      </div>
    </main>
  );
}

// Helper Components

function InfoCard({ label, value }) {
  return (
    <div
      style={{
        background: "#0a0a0a",
        border: "1px solid rgba(255,255,255,0.1)",
        borderRadius: 12,
        padding: 20,
        textAlign: "center",
      }}
    >
      <div style={{ fontSize: 14, opacity: 0.7, marginBottom: 8 }}>{label}</div>
      <div style={{ fontSize: 22, fontWeight: 600, color: "#d4af37" }}>
        {value}
      </div>
    </div>
  );
}

function TextSection({ title, text }) {
  if (!text) return null;
  return (
    <section style={{ marginBottom: 48 }}>
      <h2 style={{ fontSize: 32, marginBottom: 16 }}>{title}</h2>
      <div
        style={{
          lineHeight: 1.8,
          fontSize: 17,
          background: "#0a0a0a",
          padding: 24,
          borderRadius: 12,
          border: "1px solid rgba(255,255,255,0.08)",
        }}
      >
        {parseTextWithLinks(text)}
      </div>
    </section>
  );
}

function CharacterCard({ character, type }) {
  const borderColors = {
    npc: "rgba(212,175,55,0.3)",
    ally: "rgba(77,163,255,0.3)",
    enemy: "rgba(255,77,77,0.3)",
  };

  const bgColors = {
    npc: "rgba(212,175,55,0.05)",
    ally: "rgba(77,163,255,0.05)",
    enemy: "rgba(255,77,77,0.05)",
  };

  const path = character.id?.startsWith("npc-")
    ? `/characters/npcs/${character.id}`
    : character.id?.startsWith("ally-")
      ? `/characters/allies/${character.id}`
      : character.id?.startsWith("enemy-")
        ? `/characters/enemies/${character.id}`
        : null;

  const content = (
    <div
      style={{
        background: `linear-gradient(135deg, ${bgColors[type]}, transparent)`,
        border: `1px solid ${borderColors[type]}`,
        borderRadius: 12,
        padding: 16,
        display: "flex",
        gap: 16,
        alignItems: "center",
        transition: "transform 0.2s",
        cursor: path ? "pointer" : "default",
      }}
      onMouseEnter={(e) => {
        if (path) e.currentTarget.style.transform = "translateY(-2px)";
      }}
      onMouseLeave={(e) => {
        if (path) e.currentTarget.style.transform = "translateY(0)";
      }}
    >
      {character.portrait && (
        <img
          src={character.portrait}
          alt={character.name}
          style={{
            width: 64,
            height: 64,
            borderRadius: 10,
            objectFit: "cover",
            border: `2px solid ${borderColors[type]}`,
          }}
        />
      )}
      <div>
        <div style={{ fontWeight: 700, fontSize: 18, marginBottom: 4 }}>
          {character.name}
        </div>
        <div style={{ opacity: 0.85, fontSize: 14 }}>{character.role}</div>
      </div>
    </div>
  );

  return path ? (
    <Link to={path} style={{ textDecoration: "none", color: "inherit" }}>
      {content}
    </Link>
  ) : (
    content
  );
}

function parseTextWithLinks(text) {
  if (!text) return text;

  const linkRegex = /\[([^\]]+)\]\(([^)]+)\)/g;
  const parts = [];
  let lastIndex = 0;
  let match;
  let keyCounter = 0;

  while ((match = linkRegex.exec(text)) !== null) {
    if (match.index > lastIndex) {
      parts.push(text.substring(lastIndex, match.index));
    }

    const linkText = match[1];
    const linkPath = match[2];
    parts.push(
      <Link
        key={`link-${keyCounter++}`}
        to={linkPath}
        style={{
          color: "#4da3ff",
          textDecoration: "none",
          fontWeight: 600,
          borderBottom: "1px solid rgba(77,163,255,0.3)",
        }}
      >
        {linkText}
      </Link>,
    );

    lastIndex = match.index + match[0].length;
  }

  if (lastIndex < text.length) {
    parts.push(text.substring(lastIndex));
  }

  return parts.length > 0 ? parts : text;
}



# MODULE src/pages/World/Dungeons/DungeonDetail.jsx
import React from "react";
import { useParams } from "react-router-dom";
import { dungeons } from "../../../data/world/dungeons";

export default function DungeonDetail() {
  const { id } = useParams();
  const dun = dungeons.find((d) => d.id === id) || dungeons[0];

  return (
    <main style={{ minHeight: "100%" }}>
      <section
        style={{
          position: "relative",
          height: "40vh",
          background: `url(${dun.headerImage}) center/cover no-repeat`,
          filter: "brightness(0.9)",
        }}
      >
        <div
          style={{
            position: "absolute",
            inset: 0,
            background: "rgba(0,0,0,0.45)",
          }}
        />
        <div
          style={{
            position: "absolute",
            bottom: 16,
            left: 24,
            right: 24,
            display: "flex",
            alignItems: "center",
            justifyContent: "space-between",
          }}
        >
          <h1 style={{ margin: 0 }}>{dun.name}</h1>
          <Danger level={dun.danger} />
        </div>
      </section>

      <section
        style={{
          display: "grid",
          gridTemplateColumns: "minmax(0,1fr) 380px",
          gap: 24,
          padding: 24,
        }}
      >
        <div>
          <div>
            <div style={{ fontWeight: 700, marginBottom: 8 }}>
              Карта подземелья
            </div>
            <img
              src={dun.map}
              alt="map"
              style={{
                width: "100%",
                borderRadius: 12,
                border: "1px solid rgba(255,255,255,0.1)",
              }}
            />
          </div>
          <Block title="История" text={dun.history} />
          <Block title="Описание" text={dun.description} />
          <div style={{ marginTop: 16 }}>
            <h3 style={{ margin: "0 0 8px" }}>Ключевые комнаты</h3>
            <div style={{ display: "grid", gap: 8 }}>
              {dun.keyRooms.map((r) => (
                <div
                  key={r.num}
                  style={{
                    background: "#111",
                    border: "1px solid rgba(255,255,255,0.08)",
                    borderRadius: 8,
                    padding: 10,
                  }}
                >
                  <div style={{ fontWeight: 700 }}>
                    #{r.num} — {r.name}
                  </div>
                  <div style={{ opacity: 0.9 }}>{r.desc}</div>
                </div>
              ))}
            </div>
          </div>
        </div>

        <aside>
          <IconList title="Обитатели" items={dun.inhabitants} />
          <ListBlock title="Сокровища" items={dun.treasures} />
          <ListBlock title="Ловушки и загадки" items={dun.traps} />
        </aside>
      </section>

      <section style={{ padding: 24 }}>
        <ListBlock title="История прохождений" items={dun.runsHistory} />
      </section>
    </main>
  );
}

function Danger({ level }) {
  const skulls = Array.from({ length: 5 }).map((_, i) => i < level);
  return (
    <div>
      {skulls.map((filled, idx) => (
        <span
          key={idx}
          style={{ color: filled ? "#c0392b" : "#555", marginLeft: 2 }}
        >
          ☠
        </span>
      ))}
    </div>
  );
}

function Block({ title, text }) {
  return (
    <div style={{ marginTop: 16 }}>
      <h3 style={{ margin: "0 0 8px" }}>{title}</h3>
      <p style={{ margin: 0, lineHeight: 1.65 }}>{text}</p>
    </div>
  );
}

function ListBlock({ title, items }) {
  return (
    <div style={{ marginTop: 16 }}>
      <h3 style={{ margin: "0 0 8px" }}>{title}</h3>
      <ul
        style={{
          listStyle: "none",
          padding: 0,
          margin: 0,
          display: "grid",
          gap: 6,
        }}
      >
        {items.map((it, idx) => (
          <li
            key={idx}
            style={{ display: "flex", alignItems: "center", gap: 8 }}
          >
            <span
              style={{
                width: 6,
                height: 6,
                borderRadius: 99,
                background: "#d4af37",
                display: "inline-block",
              }}
            />
            <span>{it}</span>
          </li>
        ))}
      </ul>
    </div>
  );
}

function IconList({ title, items }) {
  return (
    <div style={{ marginTop: 16 }}>
      <h3 style={{ margin: "0 0 8px" }}>{title}</h3>
      <div style={{ display: "grid", gap: 8 }}>
        {items.map((it) => (
          <div
            key={it.name}
            style={{ display: "flex", gap: 8, alignItems: "center" }}
          >
            <img src={it.icon} alt="icon" style={{ width: 18, height: 18 }} />
            <span>{it.name}</span>
          </div>
        ))}
      </div>
    </div>
  );
}



# MODULE src/pages/World/Dungeons/DungeonsPage.jsx
import React from "react";
import { Link } from "react-router-dom";
import { dungeons } from "../../../data/world/dungeons";

export default function DungeonsPage() {
  return (
    <main style={{ padding: 24 }}>
      <h2 style={{ marginBottom: 16 }}>Подземелья</h2>
      <div
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fill, minmax(280px, 1fr))",
          gap: 16,
        }}
      >
        {dungeons.map((d) => (
          <Link
            key={d.id}
            to={`/world/dungeons/${d.id}`}
            style={{
              textDecoration: "none",
              color: "inherit",
              borderRadius: 12,
              overflow: "hidden",
              border: "1px solid rgba(255,255,255,0.1)",
              background: "#121212",
            }}
          >
            <div
              style={{
                position: "relative",
                height: 160,
                background: `url(${d.headerImage}) center/cover no-repeat`,
                filter: "brightness(0.9)",
              }}
            >
              <div
                style={{
                  position: "absolute",
                  inset: 0,
                  background:
                    "linear-gradient(180deg, rgba(0,0,0,0.15) 30%, rgba(0,0,0,0.7) 100%)",
                }}
              />
              <div
                style={{
                  position: "absolute",
                  bottom: 8,
                  left: 12,
                  right: 12,
                  display: "flex",
                  alignItems: "center",
                  justifyContent: "space-between",
                }}
              >
                <div style={{ fontWeight: 700, fontSize: 18 }}>{d.name}</div>
                <Danger level={d.danger} />
              </div>
            </div>
          </Link>
        ))}
      </div>
    </main>
  );
}

function Danger({ level }) {
  const skulls = Array.from({ length: 5 }).map((_, i) => i < level);
  return (
    <div>
      {skulls.map((filled, idx) => (
        <span
          key={idx}
          style={{ color: filled ? "#c0392b" : "#555", marginLeft: 2 }}
        >
          ☠
        </span>
      ))}
    </div>
  );
}



# MODULE src/pages/World/Establishments/EstablishmentDetail.jsx
import React from "react";
import { useParams, Link } from "react-router-dom";
import { establishments } from "../../../data/world/establishments";
import { cities } from "../../../data/world/cities";
import { allies } from "../../../data/characters/allies";
import { npcs } from "../../../data/characters/npcs";
import { getCharacterPath } from "../../../utils/getCharacterPath";

export default function EstablishmentDetail() {
  const { id } = useParams();
  const est = establishments.find((e) => e.id === id) || establishments[0];

  return (
    <main style={{ minHeight: "100%" }}>
      {/* Hero */}
      <section
        style={{
          position: "relative",
          height: "50vh",
          background: est.image
            ? `url(${est.image}) center/cover no-repeat`
            : "linear-gradient(135deg, #3a3a3a, #1f1f1f)",
        }}
      >
        <div
          style={{
            position: "absolute",
            inset: 0,
            background: "rgba(0,0,0,0.45)",
          }}
        />
        <div
          style={{
            position: "absolute",
            bottom: 16,
            left: 24,
            right: 24,
            display: "flex",
            alignItems: "flex-end",
            justifyContent: "space-between",
            gap: 16,
          }}
        >
          <div>
            <h1 style={{ fontSize: 44, margin: 0, color: "#d4af37" }}>
              {est.name}
            </h1>
            <div style={{ opacity: 0.9, marginTop: 8, fontSize: 16 }}>
              {est.type || est.category}
            </div>
            {est.settlement && (
              <div style={{ opacity: 0.85, marginTop: 4, fontSize: 14 }}>
                {est.settlement}
                {est.location && ` • ${est.location}`}
              </div>
            )}
          </div>
          {est.type && (
            <div
              style={{
                padding: "8px 16px",
                borderRadius: 999,
                background: "rgba(0,0,0,0.55)",
                border: "1px solid rgba(255,255,255,0.15)",
                fontSize: 14,
                letterSpacing: "0.08em",
                textTransform: "uppercase",
              }}
            >
              {est.type}
            </div>
          )}
        </div>
      </section>

      {/* Content */}
      <section
        style={{
          display: "grid",
          gridTemplateColumns: "minmax(0,1fr) 340px",
          gap: 24,
          padding: 24,
        }}
      >
        <div>
          {est.description && <Block title="Описание" text={est.description} />}

          {est.specialties && est.specialties.length > 0 && (
            <ListBlock title="Особенности" items={est.specialties} />
          )}

          {est.menu && est.menu.length > 0 && (
            <ListBlock title="Меню" items={est.menu} />
          )}

          {est.services && est.services.length > 0 && (
            <ListBlock title="Услуги" items={est.services} />
          )}

          {est.notableClients && est.notableClients.length > 0 && (
            <ListBlock title="Постоянные гости" items={est.notableClients} />
          )}

          {est.rumor && (
            <div style={{ marginTop: 16 }}>
              <h3 style={{ margin: "0 0 8px" }}>Слухи</h3>
              <p
                style={{
                  margin: 0,
                  lineHeight: 1.65,
                  fontStyle: "italic",
                  opacity: 0.9,
                }}
              >
                {est.rumor}
              </p>
            </div>
          )}
        </div>

        <aside>
          {est.owner && (
            <div>
              <h4 style={{ margin: "0 0 8px" }}>Хозяин</h4>
              <div
                style={{
                  background: "#111",
                  border: "1px solid rgba(255,255,255,0.08)",
                  borderRadius: 8,
                  padding: 12,
                }}
              >
                <div style={{ fontWeight: 700 }}>{est.owner.name}</div>
                {est.owner.title && (
                  <div style={{ opacity: 0.85, fontSize: 13, marginTop: 4 }}>
                    {est.owner.title}
                  </div>
                )}
                {est.owner.id &&
                  (() => {
                    const ownerPath = getCharacterPath(est.owner.id);
                    return ownerPath ? (
                      <Link
                        to={ownerPath}
                        style={{
                          display: "inline-block",
                          marginTop: 8,
                          color: "#4da3ff",
                          textDecoration: "none",
                          fontSize: 13,
                        }}
                      >
                        Подробнее →
                      </Link>
                    ) : null;
                  })()}
              </div>
            </div>
          )}

          {est.settlement && (
            <div style={{ marginTop: 16 }}>
              <h4 style={{ margin: "0 0 8px" }}>Город</h4>
              {(() => {
                const city = cities.find((c) => c.name === est.settlement);
                return city ? (
                  <Link
                    to={`/world/cities/${city.id}`}
                    style={{
                      display: "inline-block",
                      color: "#4da3ff",
                      textDecoration: "none",
                    }}
                  >
                    {est.settlement}
                  </Link>
                ) : (
                  <span>{est.settlement}</span>
                );
              })()}
            </div>
          )}

          {est.location && (
            <div style={{ marginTop: 16 }}>
              <h4 style={{ margin: "0 0 8px" }}>Расположение</h4>
              <div style={{ opacity: 0.9 }}>{est.location}</div>
            </div>
          )}
        </aside>
      </section>
    </main>
  );
}

function Block({ title, text }) {
  if (!text) return null;
  return (
    <div style={{ marginTop: 16 }}>
      <h3 style={{ margin: "0 0 8px" }}>{title}</h3>
      <p style={{ margin: 0, lineHeight: 1.65 }}>{parseTextWithLinks(text)}</p>
    </div>
  );
}

function parseTextWithLinks(text) {
  if (!text) return text;

  // Парсим markdown-ссылки вида [текст](путь)
  const linkRegex = /\[([^\]]+)\]\(([^)]+)\)/g;
  const parts = [];
  let lastIndex = 0;
  let match;
  let keyCounter = 0;

  while ((match = linkRegex.exec(text)) !== null) {
    // Добавляем текст до ссылки
    if (match.index > lastIndex) {
      parts.push(text.substring(lastIndex, match.index));
    }

    // Добавляем ссылку
    const linkText = match[1];
    const linkPath = match[2];
    parts.push(
      <Link
        key={`link-${keyCounter++}`}
        to={linkPath}
        style={{ color: "#4da3ff", textDecoration: "none", fontWeight: 500 }}
      >
        {linkText}
      </Link>,
    );

    lastIndex = match.index + match[0].length;
  }

  // Добавляем оставшийся текст
  if (lastIndex < text.length) {
    parts.push(text.substring(lastIndex));
  }

  return parts.length > 0 ? parts : text;
}

function ListBlock({ title, items }) {
  if (!items || items.length === 0) return null;
  return (
    <div style={{ marginTop: 16 }}>
      <h3 style={{ margin: "0 0 8px" }}>{title}</h3>
      <ul
        style={{
          listStyle: "none",
          padding: 0,
          margin: 0,
          display: "grid",
          gap: 6,
        }}
      >
        {items.map((it, idx) => (
          <li
            key={idx}
            style={{ display: "flex", alignItems: "center", gap: 8 }}
          >
            <span
              style={{
                width: 6,
                height: 6,
                borderRadius: 99,
                background: "#d4af37",
                display: "inline-block",
              }}
            />
            <span>{it}</span>
          </li>
        ))}
      </ul>
    </div>
  );
}



# MODULE src/pages/World/Establishments/EstablishmentsPage.jsx
import React from "react";
import { Link } from "react-router-dom";
import { establishments } from "../../../data/world/establishments";

export default function EstablishmentsPage() {
  const grouped = groupByCategory(establishments);

  return (
    <main style={{ padding: 24 }}>
      <h2 style={{ marginBottom: 8 }}>Заведения</h2>
      <p style={{ marginBottom: 24, maxWidth: 720, lineHeight: 1.6 }}>
        Кузни, таверны, лавки и постоялые дворы, которые определяют облик мира.
        Здесь договариваются о походах, чинят оружие и находят редкие товары.
      </p>

      {grouped.map(([category, items]) => (
        <section key={category} style={{ marginBottom: 32 }}>
          <h3 style={{ marginBottom: 16 }}>{category}</h3>
          <div
            style={{
              display: "grid",
              gridTemplateColumns: "repeat(auto-fill, minmax(320px, 1fr))",
              gap: 16,
            }}
          >
            {items.map((est) => (
              <Link
                key={est.id}
                to={`/world/establishments/${est.id}`}
                style={{
                  textDecoration: "none",
                  color: "inherit",
                  borderRadius: 12,
                  overflow: "hidden",
                  border: "1px solid rgba(255,255,255,0.1)",
                  background: "#121212",
                  display: "flex",
                  flexDirection: "column",
                  minHeight: 360,
                  cursor: "pointer",
                  transition: "border-color 0.2s",
                }}
                onMouseEnter={(e) => {
                  e.currentTarget.style.borderColor = "rgba(255,255,255,0.3)";
                }}
                onMouseLeave={(e) => {
                  e.currentTarget.style.borderColor = "rgba(255,255,255,0.1)";
                }}
              >
                <HeaderImage establishment={est} />
                <div
                  style={{
                    padding: 16,
                    display: "flex",
                    flexDirection: "column",
                    gap: 12,
                    flexGrow: 1,
                  }}
                >
                  <div>
                    <div style={{ fontWeight: 700, fontSize: 18 }}>
                      {est.name}
                    </div>
                    <div style={{ fontSize: 13, opacity: 0.85 }}>
                      {est.settlement}
                    </div>
                    <div style={{ fontSize: 13, opacity: 0.7 }}>
                      {est.location}
                    </div>
                  </div>

                  {est.description && (
                    <p style={{ margin: 0, lineHeight: 1.5 }}>
                      {est.description}
                    </p>
                  )}

                  {est.owner ? (
                    <div style={{ fontSize: 13, opacity: 0.85 }}>
                      <span style={{ opacity: 0.7 }}>Хозяин:</span>{" "}
                      {est.owner.name}
                      {est.owner.title ? `, ${est.owner.title}` : ""}
                    </div>
                  ) : null}

                  {est.specialties?.length ? (
                    <div style={{ fontSize: 13, opacity: 0.8 }}>
                      <span style={{ opacity: 0.7 }}>Особенности:</span>{" "}
                      {est.specialties.length} шт.
                    </div>
                  ) : null}

                  {est.menu?.length ? (
                    <div style={{ fontSize: 13, opacity: 0.8 }}>
                      <span style={{ opacity: 0.7 }}>Меню:</span>{" "}
                      {est.menu.length} позиций
                    </div>
                  ) : null}

                  {est.services?.length ? (
                    <div style={{ fontSize: 13, opacity: 0.8 }}>
                      <span style={{ opacity: 0.7 }}>Услуги:</span>{" "}
                      {est.services.length} шт.
                    </div>
                  ) : null}
                </div>
              </Link>
            ))}
          </div>
        </section>
      ))}
    </main>
  );
}

function groupByCategory(items) {
  const map = new Map();
  items.forEach((est) => {
    const key = est.category || est.type || "Прочее";
    if (!map.has(key)) {
      map.set(key, []);
    }
    map.get(key).push(est);
  });
  return Array.from(map.entries());
}

function HeaderImage({ establishment }) {
  const { image, type } = establishment;
  const hasImage = Boolean(image);
  return (
    <div
      style={{
        position: "relative",
        height: 160,
        background: hasImage
          ? `url(${image}) center/cover no-repeat`
          : "linear-gradient(135deg, #3a3a3a, #1f1f1f)",
        filter: hasImage ? "brightness(0.95)" : "none",
      }}
    >
      <div
        style={{
          position: "absolute",
          inset: 0,
          background:
            "linear-gradient(180deg, rgba(0,0,0,0.0) 30%, rgba(0,0,0,0.6) 100%)",
        }}
      />
      {type ? (
        <div
          style={{
            position: "absolute",
            top: 12,
            right: 12,
            padding: "4px 10px",
            borderRadius: 999,
            background: "rgba(0,0,0,0.55)",
            border: "1px solid rgba(255,255,255,0.15)",
            fontSize: 12,
            letterSpacing: "0.08em",
            textTransform: "uppercase",
          }}
        >
          {type}
        </div>
      ) : null}
    </div>
  );
}



# MODULE src/pages/World/Geography/GeographyPage.jsx
import React from "react";
import { regions } from "../../../data/world/geography";

export default function GeographyPage() {
  return (
    <main style={{ paddingBottom: 24 }}>
      {regions.map((r) => (
        <section key={r.id} style={{ marginBottom: 24 }}>
          <div
            style={{
              position: "relative",
              height: 280,
              background: `url(${r.panorama}) center/cover no-repeat`,
            }}
          >
            <div
              style={{
                position: "absolute",
                inset: 0,
                background: "rgba(0,0,0,0.35)",
              }}
            />
            <div style={{ position: "absolute", bottom: 12, left: 16 }}>
              <h2 style={{ margin: 0 }}>{r.name}</h2>
              <div style={{ opacity: 0.9 }}>{r.type}</div>
            </div>
          </div>
          <div
            style={{
              padding: 16,
              display: "grid",
              gridTemplateColumns: "minmax(0,1fr)",
              gap: 16,
            }}
          >
            <img
              src={r.bigMap}
              alt="region map"
              style={{
                width: "100%",
                borderRadius: 12,
                border: "1px solid rgba(255,255,255,0.1)",
              }}
            />
            <div
              style={{
                display: "grid",
                gridTemplateColumns: "repeat(auto-fit, minmax(260px, 1fr))",
                gap: 16,
              }}
            >
              <Block title="Климат и погода" text={r.climate} />
              <Block title="Флора и фауна" text={r.floraFauna} />
              <Block title="Опасности региона" text={r.dangers} />
              <ListBlock title="Известные локации" items={r.locations} />
              <Block title="Население" text={r.peoples} />
            </div>
            <div style={{ display: "flex", gap: 8, flexWrap: "wrap" }}>
              {r.thumbs.map((t) => (
                <img
                  key={t}
                  src={t}
                  alt="view"
                  style={{
                    width: 200,
                    height: 120,
                    objectFit: "cover",
                    borderRadius: 8,
                  }}
                />
              ))}
            </div>
          </div>
        </section>
      ))}
    </main>
  );
}

function Block({ title, text }) {
  return (
    <div>
      <div style={{ fontWeight: 700, marginBottom: 6 }}>{title}</div>
      <p style={{ margin: 0, lineHeight: 1.65 }}>{text}</p>
    </div>
  );
}

function ListBlock({ title, items }) {
  return (
    <div>
      <div style={{ fontWeight: 700, marginBottom: 6 }}>{title}</div>
      <ul
        style={{
          listStyle: "none",
          padding: 0,
          margin: 0,
          display: "grid",
          gap: 6,
        }}
      >
        {items.map((it, idx) => (
          <li
            key={idx}
            style={{ display: "flex", alignItems: "center", gap: 8 }}
          >
            <span
              style={{
                width: 6,
                height: 6,
                borderRadius: 99,
                background: "#d4af37",
                display: "inline-block",
              }}
            />
            <span>{it}</span>
          </li>
        ))}
      </ul>
    </div>
  );
}



# MODULE src/pages/World/index.jsx
import React from "react";
import { Link } from "react-router-dom";

export default function WorldIndex() {
  return (
    <main style={{ padding: 24 }}>
      <h2 style={{ marginBottom: 16 }}>Мир</h2>
      <div
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fill, minmax(240px, 1fr))",
          gap: 16,
        }}
      >
        {[
          {
            label: "Города",
            to: "/world/cities",
            img: "/assets/images/world/cities/verdis_panorama.jpg",
          },
          {
            label: "География",
            to: "/world/geography",
            img: "/assets/images/world/regions/northrange_panorama.jpg",
          },
          {
            label: "Подземелья",
            to: "/world/dungeons",
            img: "/assets/images/world/dungeons/black_keep_entrance.jpg",
          },
          {
            label: "Заведения",
            to: "/world/establishments",
            img: "/assets/images/world/cities/verdis_tavern.jpg",
          },
          {
            label: "Карты",
            to: "/world/maps",
            img: "/assets/images/world/maps/world.jpg",
          },
        ].map((x) => (
          <Link
            key={x.to}
            to={x.to}
            style={{
              textDecoration: "none",
              color: "inherit",
              borderRadius: 12,
              overflow: "hidden",
              border: "1px solid rgba(255,255,255,0.1)",
              background: "#121212",
            }}
          >
            <div
              style={{
                height: 140,
                background: `url(${x.img}) center/cover no-repeat`,
              }}
            />
            <div style={{ padding: 12, fontWeight: 700 }}>{x.label}</div>
          </Link>
        ))}
      </div>
    </main>
  );
}



# MODULE src/pages/World/Maps/MapsPage.jsx
import React from "react";
import { maps } from "../../../data/world/maps";

export default function MapsPage() {
  return (
    <main style={{ padding: 24, display: "grid", gap: 16 }}>
      <h2>Карты</h2>
      {maps.map((m) => (
        <section
          key={m.id}
          style={{
            background: "#121212",
            border: "1px solid rgba(255,255,255,0.1)",
            borderRadius: 12,
            overflow: "hidden",
          }}
        >
          <div style={{ position: "relative" }}>
            <img
              src={m.image}
              alt={m.title}
              style={{ width: "100%", display: "block" }}
            />
            <div
              style={{
                position: "absolute",
                top: 8,
                left: 8,
                padding: "6px 10px",
                background: "rgba(0,0,0,0.6)",
                borderRadius: 8,
                fontWeight: 700,
              }}
            >
              {m.title}
            </div>
          </div>
          <div
            style={{
              padding: 12,
              display: "flex",
              alignItems: "center",
              justifyContent: "space-between",
              flexWrap: "wrap",
              gap: 8,
            }}
          >
            <div style={{ display: "flex", gap: 12, flexWrap: "wrap" }}>
              {m.legend.map((l, idx) => (
                <span
                  key={idx}
                  style={{
                    fontSize: 13,
                    opacity: 0.9,
                    background: "#1a1a1a",
                    border: "1px solid rgba(255,255,255,0.08)",
                    padding: "4px 8px",
                    borderRadius: 999,
                  }}
                >
                  {l}
                </span>
              ))}
            </div>
            <a
              href={m.download}
              download
              style={{
                textDecoration: "none",
                color: "#fff",
                background: "#2c3e50",
                padding: "6px 10px",
                borderRadius: 8,
              }}
            >
              Скачать в полном размере
            </a>
          </div>
        </section>
      ))}
    </main>
  );
}



# MODULE src/routes/routes.jsx
import React from "react";
import { Routes, Route, Navigate } from "react-router-dom";
import HomePage from "../pages/Home/HomePage.jsx";
// Characters
import CharactersIndex from "../pages/Characters/index.jsx";
import PlayerCharactersPage from "../pages/Characters/PlayerCharacters/PlayerCharactersPage.jsx";
import PlayerCharacterDetail from "../pages/Characters/PlayerCharacters/PlayerCharacterDetail.jsx";
import NPCsPage from "../pages/Characters/NPCs/NPCsPage.jsx";
import NPCDetail from "../pages/Characters/NPCs/NPCDetail.jsx";
import AlliesPage from "../pages/Characters/Allies/AlliesPage.jsx";
import EnemiesPage from "../pages/Characters/Enemies/EnemiesPage.jsx";
import DeceasedPage from "../pages/Characters/Deceased/DeceasedPage.jsx";
// World
import WorldIndex from "../pages/World/index.jsx";
import CitiesPage from "../pages/World/Cities/CitiesPage.jsx";
import CityDetail from "../pages/World/Cities/CityDetail.jsx";
import GeographyPage from "../pages/World/Geography/GeographyPage.jsx";
import DungeonsPage from "../pages/World/Dungeons/DungeonsPage.jsx";
import DungeonDetail from "../pages/World/Dungeons/DungeonDetail.jsx";
import EstablishmentsPage from "../pages/World/Establishments/EstablishmentsPage.jsx";
import EstablishmentDetail from "../pages/World/Establishments/EstablishmentDetail.jsx";
import MapsPage from "../pages/World/Maps/MapsPage.jsx";
// Chronicles
import ChroniclesIndex from "../pages/Chronicles/index.jsx";
import SessionsPage from "../pages/Chronicles/AllSessions/SessionsPage.jsx";
import SessionDetail from "../pages/Chronicles/AllSessions/SessionDetail.jsx";
import KeyEventsPage from "../pages/Chronicles/KeyEvents/KeyEventsPage.jsx";
import TimelinePage from "../pages/Chronicles/Timeline/TimelinePage.jsx";
import QuotesPage from "../pages/Chronicles/Quotes/QuotesPage.jsx";
// Lore
import LoreIndex from "../pages/Lore/index.jsx";
import FractionsPage from "../pages/Lore/Fractions/FractionsPage.jsx";
import FractionDetail from "../pages/Lore/Fractions/FractionDetail.jsx";
import GodsPage from "../pages/Lore/Gods/GodsPage.jsx";
import GodDetail from "../pages/Lore/Gods/GodDetail.jsx";
import HistoryPage from "../pages/Lore/History/HistoryPage.jsx";
import LegendsPage from "../pages/Lore/Legends/LegendsPage.jsx";
// Rules
import RulesIndex from "../pages/Rules/index.jsx";
import HomebrewPage from "../pages/Rules/Homebrew/HomebrewPage.jsx";
import MechanicsPage from "../pages/Rules/Mechanics/MechanicsPage.jsx";
// Media
import MediaIndex from "../pages/Media/index.jsx";
import GalleryPage from "../pages/Media/Gallery/GalleryPage.jsx";
import MusicPage from "../pages/Media/Music/MusicPage.jsx";
// Search
import SearchResultsPage from "../pages/Search/SearchResultsPage.jsx";

export default function RoutesRoot() {
  return (
    <Routes>
      <Route path="/" element={<HomePage />} />

      <Route path="/characters" element={<CharactersIndex />} />
      <Route path="/characters/players" element={<PlayerCharactersPage />} />
      <Route
        path="/characters/players/:id"
        element={<PlayerCharacterDetail />}
      />
      <Route path="/characters/npcs" element={<NPCsPage />} />
      <Route path="/characters/npcs/:id" element={<NPCDetail />} />
      <Route path="/characters/allies" element={<AlliesPage />} />
      <Route path="/characters/enemies" element={<EnemiesPage />} />
      <Route path="/characters/deceased" element={<DeceasedPage />} />

      <Route path="/world" element={<WorldIndex />} />
      <Route path="/world/cities" element={<CitiesPage />} />
      <Route path="/world/cities/:id" element={<CityDetail />} />
      <Route path="/world/geography" element={<GeographyPage />} />
      <Route path="/world/dungeons" element={<DungeonsPage />} />
      <Route path="/world/dungeons/:id" element={<DungeonDetail />} />
      <Route path="/world/establishments" element={<EstablishmentsPage />} />
      <Route
        path="/world/establishments/:id"
        element={<EstablishmentDetail />}
      />
      <Route path="/world/maps" element={<MapsPage />} />

      <Route path="/chronicles" element={<ChroniclesIndex />} />
      <Route path="/chronicles/sessions" element={<SessionsPage />} />
      <Route path="/chronicles/sessions/:id" element={<SessionDetail />} />
      <Route path="/chronicles/key-events" element={<KeyEventsPage />} />
      <Route path="/chronicles/timeline" element={<TimelinePage />} />
      <Route path="/chronicles/quotes" element={<QuotesPage />} />

      <Route path="/lore" element={<LoreIndex />} />
      <Route path="/lore/fractions" element={<FractionsPage />} />
      <Route path="/lore/fractions/:id" element={<FractionDetail />} />
      <Route path="/lore/gods" element={<GodsPage />} />
      <Route path="/lore/gods/:id" element={<GodDetail />} />
      <Route path="/lore/history" element={<HistoryPage />} />
      <Route path="/lore/legends" element={<LegendsPage />} />

      <Route path="/rules" element={<RulesIndex />} />
      <Route path="/rules/homebrew" element={<HomebrewPage />} />
      <Route path="/rules/mechanics" element={<MechanicsPage />} />

      <Route path="/media" element={<MediaIndex />} />
      <Route path="/media/gallery" element={<GalleryPage />} />
      <Route path="/media/music" element={<MusicPage />} />

      <Route path="/search" element={<SearchResultsPage />} />

      <Route path="*" element={<Navigate to="/" />} />
    </Routes>
  );
}



# MODULE src/search/index.js
export function normalizeText(text) {
  return String(text || "")
    .replace(/\s+/g, " ")
    .trim();
}

export function buildSnippet(text, query, opts = {}) {
  const source = normalizeText(text).toString();
  const q = String(query || "").trim();
  const radius = opts.radius ?? 80;
  if (!q) return source.slice(0, radius * 2);
  const idx = source.toLowerCase().indexOf(q.toLowerCase());
  if (idx === -1) return source.slice(0, radius * 2);
  const start = Math.max(0, idx - radius);
  const end = Math.min(source.length, idx + q.length + radius);
  const prefix = start > 0 ? "…" : "";
  const suffix = end < source.length ? "…" : "";
  return prefix + source.slice(start, end) + suffix;
}

export function searchDocuments(documents, query) {
  const q = String(query || "")
    .toLowerCase()
    .trim();
  if (!q) return documents;
  const scored = documents
    .map((doc) => {
      const hay = [doc.title, doc.description, doc.text]
        .filter(Boolean)
        .map((x) => String(x).toLowerCase())
        .join(" \n ");
      const idx = hay.indexOf(q);
      if (idx === -1) return null;
      const score = 10000 - idx; // simple ranking: earlier match ranks higher
      return { doc, score };
    })
    .filter(Boolean)
    .sort((a, b) => b.score - a.score)
    .map((x) => x.doc);
  return scored;
}



# MODULE src/search/sources.js
// Aggregate searchable documents from data modules and static pages.
// A document has: { id, route, title, description?, text? }

// Characters
import { npcs } from "../data/characters/npcs.js";
import { allies } from "../data/characters/allies.js";
import { enemies } from "../data/characters/enemies.js";
import { playerCharacters } from "../data/characters/playerCharacters.js";

// World
import { cities } from "../data/world/cities.js";
import { dungeons } from "../data/world/dungeons.js";
import { geography } from "../data/world/geography.js";

// Chronicles
import { keyEvents } from "../data/chronicles/keyEvents.js";
import { sessions } from "../data/chronicles/sessions.js";

// Lore
import { fractions } from "../data/lore/fractions.js";
import { gods } from "../data/lore/gods.js";
import { history } from "../data/lore/history.js";

function safeArray(x) {
  return Array.isArray(x) ? x : [];
}

export function getDocuments() {
  const docs = [];

  // Characters
  safeArray(playerCharacters).forEach((p) =>
    docs.push({
      id: `pc-${p.id ?? p.name}`,
      route: `/characters/players/${p.id ?? encodeURIComponent(p.name)}`,
      title: p.name || "Игрок-персонаж",
      description: p.class || p.race || p.title,
      text: p.bio || p.description || "",
    }),
  );
  safeArray(npcs).forEach((n) =>
    docs.push({
      id: `npc-${n.id ?? n.name}`,
      route: `/characters/npcs/${n.id ?? encodeURIComponent(n.name)}`,
      title: n.name || "NPC",
      description: n.role || n.fraction,
      text: n.bio || n.description || "",
    }),
  );
  safeArray(allies).forEach((a) =>
    docs.push({
      id: `ally-${a.id ?? a.name}`,
      route: `/characters/allies`,
      title: a.name || "Союзник",
      description: a.role || a.fraction,
      text: a.bio || a.description || "",
    }),
  );
  safeArray(enemies).forEach((e) =>
    docs.push({
      id: `enemy-${e.id ?? e.name}`,
      route: `/characters/enemies`,
      title: e.name || "Враг",
      description: e.role || e.fraction,
      text: e.bio || e.description || "",
    }),
  );

  // World
  safeArray(cities).forEach((c) =>
    docs.push({
      id: `city-${c.id ?? c.name}`,
      route: `/world/cities/${c.id ?? encodeURIComponent(c.name)}`,
      title: c.name || "Город",
      description: c.region,
      text: c.description || c.history || "",
    }),
  );
  safeArray(dungeons).forEach((d) =>
    docs.push({
      id: `dungeon-${d.id ?? d.name}`,
      route: `/world/dungeons/${d.id ?? encodeURIComponent(d.name)}`,
      title: d.name || "Подземелье",
      description: d.region,
      text: d.description || d.legend || "",
    }),
  );
  safeArray(geography).forEach((g) =>
    docs.push({
      id: `geo-${g.id ?? g.name}`,
      route: `/world/geography`,
      title: g.name || "Локация",
      description: g.type,
      text: g.description || "",
    }),
  );

  // Chronicles
  safeArray(sessions).forEach((s) =>
    docs.push({
      id: `session-${s.id ?? s.title}`,
      route: `/chronicles/sessions/${s.id ?? encodeURIComponent(s.title)}`,
      title: s.title || "Сессия",
      description: s.date,
      text: s.summary || s.notes || "",
    }),
  );
  safeArray(keyEvents).forEach((e) =>
    docs.push({
      id: `event-${e.id ?? e.title}`,
      route: `/chronicles/key-events`,
      title: e.title || "Событие",
      description: e.date,
      text: e.description || e.details || "",
    }),
  );

  // Lore
  safeArray(fractions).forEach((f) =>
    docs.push({
      id: `fraction-${f.id ?? f.name}`,
      route: `/lore/fractions/${f.id ?? encodeURIComponent(f.name)}`,
      title: f.name || "Фракция",
      description: f.alignment,
      text: f.description || f.history || "",
    }),
  );
  safeArray(gods).forEach((g) =>
    docs.push({
      id: `god-${g.id ?? g.name}`,
      route: `/lore/gods/${g.id ?? encodeURIComponent(g.name)}`,
      title: g.name || "Божество",
      description: g.domain,
      text: g.description || g.myth || "",
    }),
  );
  safeArray(history).forEach((h) =>
    docs.push({
      id: `history-${h.id ?? h.title}`,
      route: `/lore/history`,
      title: h.title || "История",
      description: h.period,
      text: h.text || h.description || "",
    }),
  );

  return docs;
}



# MODULE src/utils/constants.js
export const APP_NAME = "Govnary Gang";



# MODULE src/utils/dataLoader.js
// Базовая функция для загрузки JSON
async function loadJSON(path) {
  try {
    const response = await fetch(path);
    if (!response.ok) throw new Error(`Failed to load ${path}`);
    return await response.json();
  } catch (error) {
    console.error(`Error loading ${path}:`, error);
    return null;
  }
}

// Загрузка индекса категории
async function loadIndex(category) {
  return loadJSON(`/data/${category}/index.json`);
}

// Загрузка одного элемента
export async function loadItem(category, id) {
  return loadJSON(`/data/${category}/${id}.json`);
}

// Загрузка всех элементов категории
export async function loadAll(category) {
  const index = await loadIndex(category);
  if (!index || !Array.isArray(index)) return [];

  const items = await Promise.all(index.map((id) => loadItem(category, id)));

  return items.filter(Boolean);
}

// Специфичные загрузчики для каждой категории
export const dataLoaders = {
  // Characters
  playerCharacters: () => loadAll("characters/players"),
  playerCharacter: (id) => loadItem("characters/players", id),

  npcs: () => loadAll("characters/npcs"),
  npc: (id) => loadItem("characters/npcs", id),

  allies: () => loadAll("characters/allies"),
  ally: (id) => loadItem("characters/allies", id),

  enemies: () => loadAll("characters/enemies"),
  enemy: (id) => loadItem("characters/enemies", id),

  deceased: () => loadAll("characters/deceased"),

  // World
  cities: () => loadAll("world/cities"),
  city: (id) => loadItem("world/cities", id),

  dungeons: () => loadAll("world/dungeons"),
  dungeon: (id) => loadItem("world/dungeons", id),

  establishments: () => loadAll("world/establishments"),
  establishment: (id) => loadItem("world/establishments", id),

  geography: () => loadAll("world/geography"),

  // Chronicles
  sessions: () => loadAll("chronicles/sessions"),
  session: (id) => loadItem("chronicles/sessions", id),

  quotes: () => loadAll("chronicles/quotes"),

  // Lore
  fractions: () => loadAll("lore/fractions"),
  fraction: (id) => loadItem("lore/fractions", id),

  gods: () => loadAll("lore/gods"),
  god: (id) => loadItem("lore/gods", id),
};



# MODULE src/utils/formatDate.js
export function formatDate(dateStr) {
  const date = new Date(dateStr);
  return date.toLocaleDateString("ru-RU", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });
}



# MODULE src/utils/getCharacterPath.js
/**
 * Возвращает путь к странице персонажа на основе его ID
 * @param {string} id - ID персонажа (например, "pc-dr-granzh", "npc-darion-eyson")
 * @returns {string|null} - Путь к странице или null
 */
export function getCharacterPath(id) {
  if (!id) return null;
  if (id.startsWith("pc-")) return `/characters/players/${id}`;
  if (id.startsWith("npc-")) return `/characters/npcs/${id}`;
  if (id.startsWith("ally-")) return `/characters/allies/${id}`;
  if (id.startsWith("enemy-")) return `/characters/enemies/${id}`;
  return null;
}



# MODULE src/utils/searchHelper.js
export function searchHelper(items, query, fields = []) {
  const q = String(query || "")
    .toLowerCase()
    .trim();
  if (!q) return items;
  return items.filter((it) =>
    fields.some((f) =>
      String(it[f] ?? "")
        .toLowerCase()
        .includes(q),
    ),
  );
}



